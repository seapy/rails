<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Active Record Query Interface — Ruby on Rails Guides</title>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

<link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div>
    <img src="images/edge_badge.png" alt="edge-badge" id="edge-badge" />
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">More at <a href="http://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        More Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://rubyonrails.org/">개요</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/download">다운로드</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/deploy">배포</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">코드</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/screencasts">스크린캐스트</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/documentation">도큐먼트</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/ecosystem">생태계</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/community">커뮤니티</a></li>
        <li class="more-info"><a href="http://weblog.rubyonrails.org/">블로그</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Return to home page">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">홈</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" onclick="guideMenu(); return false;" id="guidesMenu" class="guides-index-item nav-item">가이드 인덱스</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>Start Here</dt>
                <dd><a href="getting_started.html">Getting Started with Rails</a></dd>
                <dt>Models</dt>
                <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                <dd><a href="association_basics.html">Active Record Associations</a></dd>
                <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                <dt>Views</dt>
                <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                <dt>Controllers</dt>
                <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
              </dl>
              <dl class="R">
                <dt>Digging Deeper</dt>
                <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                <dd><a href="i18n.html">Rails Internationalization API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                <dd><a href="active_job_basics.html">Active Job Basics</a></dd>
                <dd><a href="security.html">Securing Rails Applications</a></dd>
                <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                <dd><a href="command_line.html">Rails Command Line Tools and Rake Tasks</a></dd>
                <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants</a></dd>
                <dt>Extending Rails</dt>
                <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                <dd><a href="generators.html">Creating and Customizing Rails Generators</a></dd>
                <dt>Contributing to Ruby on Rails</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a></dd>
                <dt>Maintenance Policy</dt>
                <dd><a href="maintenance_policy.html">Maintenance Policy</a></dd>
                <dt>Release Notes</dt>
                <dd><a href="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</a></dd>
                <dd><a href="4_2_release_notes.html">Ruby on Rails 4.2 Release Notes</a></dd>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 Release Notes</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 Release Notes</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">기여하기</a></li>
        <li><a class="nav-item" href="credits.html">크레딧</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">가이드 인덱스</option>
              <optgroup label="Start Here">
                  <option value="getting_started.html">Getting Started with Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Digging Deeper">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="i18n.html">Rails Internationalization API</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="active_job_basics.html">Active Job Basics</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">Rails Command Line Tools and Rake Tasks</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants</option>
              </optgroup>
              <optgroup label="Extending Rails">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators</option>
              </optgroup>
              <optgroup label="Contributing to Ruby on Rails">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</option>
              </optgroup>
              <optgroup label="Maintenance Policy">
                  <option value="maintenance_policy.html">Maintenance Policy</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</option>
                  <option value="4_2_release_notes.html">Ruby on Rails 4.2 Release Notes</option>
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 Release Notes</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 Release Notes</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Active Record Query Interface</h2><p>This guide covers different ways to retrieve data from the database using Active Record.</p><p>After reading this guide, you will know:</p>
<ul>
<li>How to find records using a variety of methods and conditions.</li>
<li>How to specify the order, retrieved attributes, grouping, and other properties of the found records.</li>
<li>How to use eager loading to reduce the number of database queries needed for data retrieval.</li>
<li>How to use dynamic finders methods.</li>
<li>How to check for the existence of particular records.</li>
<li>How to perform various calculations on Active Record models.</li>
<li>How to run EXPLAIN on relations.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li>
<a href="#retrieving-objects-from-the-database">Retrieving Objects from the Database</a>

<ul>
<li><a href="#retrieving-a-single-object">Retrieving a Single Object</a></li>
<li><a href="#retrieving-multiple-objects">Retrieving Multiple Objects</a></li>
<li><a href="#retrieving-multiple-objects-in-batches">Retrieving Multiple Objects in Batches</a></li>
</ul>
</li>
<li>
<a href="#conditions">Conditions</a>

<ul>
<li><a href="#pure-string-conditions">Pure String Conditions</a></li>
<li><a href="#array-conditions">Array Conditions</a></li>
<li><a href="#hash-conditions">Hash Conditions</a></li>
<li><a href="#not-conditions">NOT Conditions</a></li>
</ul>
</li>
<li><a href="#ordering">Ordering</a></li>
<li><a href="#selecting-specific-fields">Selecting Specific Fields</a></li>
<li><a href="#limit-and-offset">Limit and Offset</a></li>
<li><a href="#group">Group</a></li>
<li><a href="#having">Having</a></li>
<li>
<a href="#overriding-conditions">Overriding Conditions</a>

<ul>
<li><a href="#except"><code>except</code></a></li>
<li><a href="#unscope"><code>unscope</code></a></li>
<li><a href="#only"><code>only</code></a></li>
<li><a href="#reorder"><code>reorder</code></a></li>
<li><a href="#reverse-order"><code>reverse_order</code></a></li>
</ul>
</li>
<li><a href="#null-relation">Null Relation</a></li>
<li><a href="#readonly-objects">Readonly Objects</a></li>
<li>
<a href="#locking-records-for-update">Locking Records for Update</a>

<ul>
<li><a href="#optimistic-locking">Optimistic Locking</a></li>
<li><a href="#pessimistic-locking">Pessimistic Locking</a></li>
</ul>
</li>
<li>
<a href="#joining-tables">Joining Tables</a>

<ul>
<li><a href="#using-a-string-sql-fragment">Using a String SQL Fragment</a></li>
<li><a href="#using-array-hash-of-named-associations">Using Array/Hash of Named Associations</a></li>
<li><a href="#specifying-conditions-on-the-joined-tables">Specifying Conditions on the Joined Tables</a></li>
</ul>
</li>
<li>
<a href="#eager-loading-associations">Eager Loading Associations</a>

<ul>
<li><a href="#eager-loading-multiple-associations">Eager Loading Multiple Associations</a></li>
<li><a href="#specifying-conditions-on-eager-loaded-associations">Specifying Conditions on Eager Loaded Associations</a></li>
</ul>
</li>
<li>
<a href="#scopes">Scopes</a>

<ul>
<li><a href="#passing-in-arguments">Passing in arguments</a></li>
<li><a href="#merging-of-scopes">Merging of scopes</a></li>
<li><a href="#applying-a-default-scope">Applying a default scope</a></li>
<li><a href="#removing-all-scoping">Removing All Scoping</a></li>
</ul>
</li>
<li><a href="#%EB%8F%99%EC%A0%81-%EC%A1%B0%ED%9A%8C-dynamic-finders-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">동적 조회<span class="original-text-h">(Dynamic Finders)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
<li>
<a href="#%EA%B0%9D%EC%B2%B4%EB%A5%BC-%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B1%B0%EB%82%98-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0-find-or-build-a-new-object-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">객체를 조회하거나 생성하기<span class="original-text-h">(Find or Build a New Object)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a>

<ul>
<li><a href="#find-or-create-by"><code>find_or_create_by</code></a></li>
<li><a href="#find-or-create-by-bang"><code>find_or_create_by!</code></a></li>
<li><a href="#find-or-initialize-by"><code>find_or_initialize_by</code></a></li>
</ul>
</li>
<li>
<a href="#sql-%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%A1%B0%ED%9A%8C-finding-by-sql-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">SQL 을 이용한 조회<span class="original-text-h">(Finding by SQL)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a>

<ul>
<li><a href="#select-all"><code>select_all</code></a></li>
<li><a href="#pluck"><code>pluck</code></a></li>
<li><a href="#ids"><code>ids</code></a></li>
</ul>
</li>
<li><a href="#%EA%B0%9D%EC%B2%B4%EC%9D%98-%EC%A1%B4%EC%9E%AC-%ED%99%95%EC%9D%B8-existence-of-objects-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">객체의 존재 확인<span class="original-text-h">(Existence of Objects)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
<li>
<a href="#%EA%B3%84%EC%82%B0-calculations-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">계산<span class="original-text-h">(Calculations)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a>

<ul>
<li><a href="#%EA%B0%AF%EC%88%98-count-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">갯수<span class="original-text-h">(Count)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
<li><a href="#%ED%8F%89%EA%B7%A0-average-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">평균<span class="original-text-h">(Average)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
<li><a href="#%EC%B5%9C%EC%86%8C-minimum-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">최소<span class="original-text-h">(Minimum)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
<li><a href="#%EC%B5%9C%EB%8C%80-maximum-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">최대<span class="original-text-h">(Maximum)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
<li><a href="#%ED%95%A9-sum-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">합<span class="original-text-h">(Sum)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
</ul>
</li>
<li>
<a href="#explain-%EC%8B%A4%ED%96%89-running-explain-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">EXPLAIN 실행<span class="original-text-h">(Running EXPLAIN)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a>

<ul>
<li><a href="#explain-%ED%95%B4%EC%84%9D-interpreting-explain-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">EXPLAIN 해석<span class="original-text-h">(Interpreting EXPLAIN)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
</ul>
</li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <p>If you're used to using raw SQL to find database records, then you will generally find that there are better ways to carry out the same operations in Rails. Active Record insulates you from the need to use SQL in most cases.</p><p>Code examples throughout this guide will refer to one or more of the following models:</p><div class="info"><p> All of the following models use <code>id</code> as the primary key, unless specified otherwise.</p></div><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Client &lt; ActiveRecord::Base
  has_one :address
  has_many :orders
  has_and_belongs_to_many :roles
end

</pre>
</div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Address &lt; ActiveRecord::Base
  belongs_to :client
end

</pre>
</div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :client, counter_cache: true
end

</pre>
</div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Role &lt; ActiveRecord::Base
  has_and_belongs_to_many :clients
end

</pre>
</div>
<p>Active Record will perform queries on the database for you and is compatible with most database systems (MySQL, PostgreSQL and SQLite to name a few). Regardless of which database system you're using, the Active Record method format will always be the same.</p><h3 id="retrieving-objects-from-the-database">1 Retrieving Objects from the Database</h3><p>To retrieve objects from the database, Active Record provides several finder methods. Each finder method allows you to pass arguments into it to perform certain queries on your database without writing raw SQL.</p><p>The methods are:</p>
<ul>
<li><code>bind</code></li>
<li><code>create_with</code></li>
<li><code>eager_load</code></li>
<li><code>extending</code></li>
<li><code>from</code></li>
<li><code>group</code></li>
<li><code>having</code></li>
<li><code>includes</code></li>
<li><code>joins</code></li>
<li><code>limit</code></li>
<li><code>lock</code></li>
<li><code>none</code></li>
<li><code>offset</code></li>
<li><code>order</code></li>
<li><code>preload</code></li>
<li><code>readonly</code></li>
<li><code>references</code></li>
<li><code>reorder</code></li>
<li><code>reverse_order</code></li>
<li><code>select</code></li>
<li><code>distinct</code></li>
<li><code>uniq</code></li>
<li><code>where</code></li>
</ul>
<p>All of the above methods return an instance of <code>ActiveRecord::Relation</code>.</p><p>The primary operation of <code>Model.find(options)</code> can be summarized as:</p>
<ul>
<li>Convert the supplied options to an equivalent SQL query.</li>
<li>Fire the SQL query and retrieve the corresponding results from the database.</li>
<li>Instantiate the equivalent Ruby object of the appropriate model for every resulting row.</li>
<li>Run <code>after_find</code> callbacks, if any.</li>
</ul>
<h4 id="retrieving-a-single-object">1.1 Retrieving a Single Object</h4><p>Active Record provides five different ways of retrieving a single object.</p><h5 id="using-a-primary-key">1.1.1 Using a Primary Key</h5><p>Using <code>Model.find(primary_key)</code>, you can retrieve the object corresponding to the specified <em>primary key</em> that matches any supplied options. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# Find the client with primary key (id) 10.
client = Client.find(10)
# =&gt; #&lt;Client id: 10, first_name: "Ryan"&gt;

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients WHERE (clients.id = 10) LIMIT 1

</pre>
</div>
<p><code>Model.find(primary_key)</code> will raise an <code>ActiveRecord::RecordNotFound</code> exception if no matching record is found.</p><h5 id="retrieving-a-single-object-take">1.1.2 <code>take</code>
</h5><p><code>Model.take</code> retrieves a record without any implicit ordering. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
client = Client.take
# =&gt; #&lt;Client id: 1, first_name: "Lifo"&gt;

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients LIMIT 1

</pre>
</div>
<p><code>Model.take</code> returns <code>nil</code> if no record is found and no exception will be raised.</p><div class="info"><p> The retrieved record may vary depending on the database engine.</p></div><h5 id="retrieving-a-single-object-first">1.1.3 <code>first</code>
</h5><p><code>Model.first</code> finds the first record ordered by the primary key. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
client = Client.first
# =&gt; #&lt;Client id: 1, first_name: "Lifo"&gt;

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients ORDER BY clients.id ASC LIMIT 1

</pre>
</div>
<p><code>Model.first</code> returns <code>nil</code> if no matching record is found and no exception will be raised.</p><h5 id="retrieving-a-single-object-last">1.1.4 <code>last</code>
</h5><p><code>Model.last</code> finds the last record ordered by the primary key. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
client = Client.last
# =&gt; #&lt;Client id: 221, first_name: "Russel"&gt;

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients ORDER BY clients.id DESC LIMIT 1

</pre>
</div>
<p><code>Model.last</code> returns <code>nil</code> if no matching record is found and no exception will be raised.</p><h5 id="find-by">1.1.5 <code>find_by</code>
</h5><p><code>Model.find_by</code> finds the first record matching some conditions. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.find_by first_name: 'Lifo'
# =&gt; #&lt;Client id: 1, first_name: "Lifo"&gt;

Client.find_by first_name: 'Jon'
# =&gt; nil

</pre>
</div>
<p>It is equivalent to writing:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where(first_name: 'Lifo').take

</pre>
</div>
<h5 id="take-bang">1.1.6 <code>take!</code>
</h5><p><code>Model.take!</code> retrieves a record without any implicit ordering. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
client = Client.take!
# =&gt; #&lt;Client id: 1, first_name: "Lifo"&gt;

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients LIMIT 1

</pre>
</div>
<p><code>Model.take!</code> raises <code>ActiveRecord::RecordNotFound</code> if no matching record is found.</p><h5 id="first-bang">1.1.7 <code>first!</code>
</h5><p><code>Model.first!</code> finds the first record ordered by the primary key. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
client = Client.first!
# =&gt; #&lt;Client id: 1, first_name: "Lifo"&gt;

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients ORDER BY clients.id ASC LIMIT 1

</pre>
</div>
<p><code>Model.first!</code> raises <code>ActiveRecord::RecordNotFound</code> if no matching record is found.</p><h5 id="last-bang">1.1.8 <code>last!</code>
</h5><p><code>Model.last!</code> finds the last record ordered by the primary key. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
client = Client.last!
# =&gt; #&lt;Client id: 221, first_name: "Russel"&gt;

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients ORDER BY clients.id DESC LIMIT 1

</pre>
</div>
<p><code>Model.last!</code> raises <code>ActiveRecord::RecordNotFound</code> if no matching record is found.</p><h5 id="find-by-bang">1.1.9 <code>find_by!</code>
</h5><p><code>Model.find_by!</code> finds the first record matching some conditions. It raises <code>ActiveRecord::RecordNotFound</code> if no matching record is found. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.find_by! first_name: 'Lifo'
# =&gt; #&lt;Client id: 1, first_name: "Lifo"&gt;

Client.find_by! first_name: 'Jon'
# =&gt; ActiveRecord::RecordNotFound

</pre>
</div>
<p>It is equivalent to writing:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where(first_name: 'Lifo').take!

</pre>
</div>
<h4 id="retrieving-multiple-objects">1.2 Retrieving Multiple Objects</h4><h5 id="using-multiple-primary-keys">1.2.1 Using Multiple Primary Keys</h5><p><code>Model.find(array_of_primary_key)</code> accepts an array of <em>primary keys</em>, returning an array containing all of the matching records for the supplied <em>primary keys</em>. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# Find the clients with primary keys 1 and 10.
client = Client.find([1, 10]) # Or even Client.find(1, 10)
# =&gt; [#&lt;Client id: 1, first_name: "Lifo"&gt;, #&lt;Client id: 10, first_name: "Ryan"&gt;]

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients WHERE (clients.id IN (1,10))

</pre>
</div>
<div class="warning"><p> <code>Model.find(array_of_primary_key)</code> will raise an <code>ActiveRecord::RecordNotFound</code> exception unless a matching record is found for <strong>all</strong> of the supplied primary keys.</p></div><h5 id="retrieving-multiple-objects-take">1.2.2 take</h5><p><code>Model.take(limit)</code> retrieves the first number of records specified by <code>limit</code> without any explicit ordering:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.take(2)
# =&gt; [#&lt;Client id: 1, first_name: "Lifo"&gt;,
      #&lt;Client id: 2, first_name: "Raf"&gt;]

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients LIMIT 2

</pre>
</div>
<h5 id="retrieving-multiple-objects-first">1.2.3 first</h5><p><code>Model.first(limit)</code> finds the first number of records specified by <code>limit</code> ordered by primary key:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.first(2)
# =&gt; [#&lt;Client id: 1, first_name: "Lifo"&gt;,
      #&lt;Client id: 2, first_name: "Raf"&gt;]

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients ORDER BY id ASC LIMIT 2

</pre>
</div>
<h5 id="retrieving-multiple-objects-last">1.2.4 last</h5><p><code>Model.last(limit)</code> finds the number of records specified by <code>limit</code> ordered by primary key in descending order:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.last(2)
# =&gt; [#&lt;Client id: 10, first_name: "Ryan"&gt;,
      #&lt;Client id: 9, first_name: "John"&gt;]

</pre>
</div>
<p>The SQL equivalent of the above is:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients ORDER BY id DESC LIMIT 2

</pre>
</div>
<h4 id="retrieving-multiple-objects-in-batches">1.3 Retrieving Multiple Objects in Batches</h4><p>We often need to iterate over a large set of records, as when we send a newsletter to a large set of users, or when we export data.</p><p>This may appear straightforward:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# This is very inefficient when the users table has thousands of rows.
User.all.each do |user|
  NewsLetter.weekly_deliver(user)
end

</pre>
</div>
<p>But this approach becomes increasingly impractical as the table size increases, since <code>User.all.each</code> instructs Active Record to fetch <em>the entire table</em> in a single pass, build a model object per row, and then keep the entire array of model objects in memory. Indeed, if we have a large number of records, the entire collection may exceed the amount of memory available.</p><p>Rails provides two methods that address this problem by dividing records into memory-friendly batches for processing. The first method, <code>find_each</code>, retrieves a batch of records and then yields <em>each</em> record to the block individually as a model. The second method, <code>find_in_batches</code>, retrieves a batch of records and then yields <em>the entire batch</em> to the block as an array of models.</p><div class="info"><p> The <code>find_each</code> and <code>find_in_batches</code> methods are intended for use in the batch processing of a large number of records that wouldn't fit in memory all at once. If you just need to loop over a thousand records the regular find methods are the preferred option.</p></div><h5 id="find-each">1.3.1 <code>find_each</code>
</h5><p>The <code>find_each</code> method retrieves a batch of records and then yields <em>each</em> record to the block individually as a model. In the following example, <code>find_each</code> will retrieve 1000 records (the current default for both <code>find_each</code> and <code>find_in_batches</code>) and then yield each record individually to the block as a model. This process is repeated until all of the records have been processed:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
User.find_each do |user|
  NewsLetter.weekly_deliver(user)
end

</pre>
</div>
<h6 id="options-for-find-each">1.3.1.1 Options for <code>find_each</code>
</h6><p>The <code>find_each</code> method accepts most of the options allowed by the regular <code>find</code> method, except for <code>:order</code> and <code>:limit</code>, which are reserved for internal use by <code>find_each</code>.</p><p>Two additional options, <code>:batch_size</code> and <code>:start</code>, are available as well.</p><p><strong><code>:batch_size</code></strong></p><p>The <code>:batch_size</code> option allows you to specify the number of records to be retrieved in each batch, before being passed individually to the block. For example, to retrieve records in batches of 5000:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
User.find_each(batch_size: 5000) do |user|
  NewsLetter.weekly_deliver(user)
end

</pre>
</div>
<p><strong><code>:start</code></strong></p><p>By default, records are fetched in ascending order of the primary key, which must be an integer. The <code>:start</code> option allows you to configure the first ID of the sequence whenever the lowest ID is not the one you need. This would be useful, for example, if you wanted to resume an interrupted batch process, provided you saved the last processed ID as a checkpoint.</p><p>For example, to send newsletters only to users with the primary key starting from 2000, and to retrieve them in batches of 5000:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
User.find_each(start: 2000, batch_size: 5000) do |user|
  NewsLetter.weekly_deliver(user)
end

</pre>
</div>
<p>Another example would be if you wanted multiple workers handling the same processing queue. You could have each worker handle 10000 records by setting the appropriate <code>:start</code> option on each worker.</p><h5 id="find-in-batches">1.3.2 <code>find_in_batches</code>
</h5><p>The <code>find_in_batches</code> method is similar to <code>find_each</code>, since both retrieve batches of records. The difference is that <code>find_in_batches</code> yields <em>batches</em> to the block as an array of models, instead of individually. The following example will yield to the supplied block an array of up to 1000 invoices at a time, with the final block containing any remaining invoices:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# Give add_invoices an array of 1000 invoices at a time
Invoice.find_in_batches(include: :invoice_lines) do |invoices|
  export.add_invoices(invoices)
end

</pre>
</div>
<div class="note"><p> The <code>:include</code> option allows you to name associations that should be loaded alongside with the models.</p></div><h6 id="options-for-find-in-batches">1.3.2.1 Options for <code>find_in_batches</code>
</h6><p>The <code>find_in_batches</code> method accepts the same <code>:batch_size</code> and <code>:start</code> options as <code>find_each</code>, as well as most of the options allowed by the regular <code>find</code> method, except for <code>:order</code> and <code>:limit</code>, which are reserved for internal use by <code>find_in_batches</code>.</p><h3 id="conditions">2 Conditions</h3><p>The <code>where</code> method allows you to specify conditions to limit the records returned, representing the <code>WHERE</code>-part of the SQL statement. Conditions can either be specified as a string, array, or hash.</p><h4 id="pure-string-conditions">2.1 Pure String Conditions</h4><p>If you'd like to add conditions to your find, you could just specify them in there, just like <code>Client.where("orders_count = '2'")</code>. This will find all clients where the <code>orders_count</code> field's value is 2.</p><div class="warning"><p> Building your own conditions as pure strings can leave you vulnerable to SQL injection exploits. For example, <code>Client.where("first_name LIKE '%#{params[:first_name]}%'")</code> is not safe. See the next section for the preferred way to handle conditions using an array.</p></div><h4 id="array-conditions">2.2 Array Conditions</h4><p>Now what if that number could vary, say as an argument from somewhere? The find would then take the form:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where("orders_count = ?", params[:orders])

</pre>
</div>
<p>Active Record will go through the first element in the conditions value and any additional elements will replace the question marks <code>(?)</code> in the first element.</p><p>If you want to specify multiple conditions:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where("orders_count = ? AND locked = ?", params[:orders], false)

</pre>
</div>
<p>In this example, the first question mark will be replaced with the value in <code>params[:orders]</code> and the second will be replaced with the SQL representation of <code>false</code>, which depends on the adapter.</p><p>This code is highly preferable:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where("orders_count = ?", params[:orders])

</pre>
</div>
<p>to this code:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where("orders_count = #{params[:orders]}")

</pre>
</div>
<p>because of argument safety. Putting the variable directly into the conditions string will pass the variable to the database <strong>as-is</strong>. This means that it will be an unescaped variable directly from a user who may have malicious intent. If you do this, you put your entire database at risk because once a user finds out he or she can exploit your database they can do just about anything to it. Never ever put your arguments directly inside the conditions string.</p><div class="info"><p> For more information on the dangers of SQL injection, see the <a href="security.html#sql-injection">Ruby on Rails Security Guide</a>.</p></div><h5 id="placeholder-conditions">2.2.1 Placeholder Conditions</h5><p>Similar to the <code>(?)</code> replacement style of params, you can also specify keys/values hash in your array conditions:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where("created_at &gt;= :start_date AND created_at &lt;= :end_date",
  {start_date: params[:start_date], end_date: params[:end_date]})

</pre>
</div>
<p>This makes for clearer readability if you have a large number of variable conditions.</p><h4 id="hash-conditions">2.3 Hash Conditions</h4><p>Active Record also allows you to pass in hash conditions which can increase the readability of your conditions syntax. With hash conditions, you pass in a hash with keys of the fields you want conditionalised and the values of how you want to conditionalise them:</p><div class="note"><p> Only equality, range and subset checking are possible with Hash conditions.</p></div><h5 id="equality-conditions">2.3.1 Equality Conditions</h5><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where(locked: true)

</pre>
</div>
<p>The field name can also be a string:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where('locked' =&gt; true)

</pre>
</div>
<p>In the case of a belongs_to relationship, an association key can be used to specify the model if an Active Record object is used as the value. This method works with polymorphic relationships as well.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.where(author: author)
Author.joins(:posts).where(posts: {author: author})

</pre>
</div>
<div class="note"><p> The values cannot be symbols. For example, you cannot do <code>Client.where(status: :active)</code>.</p></div><h5 id="range-conditions">2.3.2 Range Conditions</h5><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where(created_at: (Time.now.midnight - 1.day)..Time.now.midnight)

</pre>
</div>
<p>This will find all clients created yesterday by using a <code>BETWEEN</code> SQL statement:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients WHERE (clients.created_at BETWEEN '2008-12-21 00:00:00' AND '2008-12-22 00:00:00')

</pre>
</div>
<p>This demonstrates a shorter syntax for the examples in <a href="#array-conditions">Array Conditions</a></p><h5 id="subset-conditions">2.3.3 Subset Conditions</h5><p>If you want to find records using the <code>IN</code> expression you can pass an array to the conditions hash:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where(orders_count: [1,3,5])

</pre>
</div>
<p>This code will generate SQL like this:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients WHERE (clients.orders_count IN (1,3,5))

</pre>
</div>
<h4 id="not-conditions">2.4 NOT Conditions</h4><p><code>NOT</code> SQL queries can be built by <code>where.not</code>.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.where.not(author: author)

</pre>
</div>
<p>In other words, this query can be generated by calling <code>where</code> with no argument, then immediately chain with <code>not</code> passing <code>where</code> conditions.</p><h3 id="ordering">3 Ordering</h3><p>To retrieve records from the database in a specific order, you can use the <code>order</code> method.</p><p>For example, if you're getting a set of records and want to order them in ascending order by the <code>created_at</code> field in your table:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.order("created_at")

</pre>
</div>
<p>You could specify <code>ASC</code> or <code>DESC</code> as well:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.order("created_at DESC")
# OR
Client.order("created_at ASC")

</pre>
</div>
<p>Or ordering by multiple fields:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.order("orders_count ASC, created_at DESC")
# OR
Client.order("orders_count ASC", "created_at DESC")

</pre>
</div>
<p>If you want to call <code>order</code> multiple times e.g. in different context, new order will prepend previous one</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.order("orders_count ASC").order("created_at DESC")
# SELECT * FROM clients ORDER BY created_at DESC, orders_count ASC

</pre>
</div>
<h3 id="selecting-specific-fields">4 Selecting Specific Fields</h3><p>By default, <code>Model.find</code> selects all the fields from the result set using <code>select *</code>.</p><p>To select only a subset of fields from the result set, you can specify the subset via the <code>select</code> method.</p><p>For example, to select only <code>viewable_by</code> and <code>locked</code> columns:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.select("viewable_by, locked")

</pre>
</div>
<p>The SQL query used by this find call will be somewhat like:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT viewable_by, locked FROM clients

</pre>
</div>
<p>Be careful because this also means you're initializing a model object with only the fields that you've selected. If you attempt to access a field that is not in the initialized record you'll receive:</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
ActiveModel::MissingAttributeError: missing attribute: &lt;attribute&gt;

</pre>
</div>
<p>Where <code>&lt;attribute&gt;</code> is the attribute you asked for. The <code>id</code> method will not raise the <code>ActiveRecord::MissingAttributeError</code>, so just be careful when working with associations because they need the <code>id</code> method to function properly.</p><p>If you would like to only grab a single record per unique value in a certain field, you can use <code>distinct</code>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.select(:name).distinct

</pre>
</div>
<p>This would generate SQL like:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT DISTINCT name FROM clients

</pre>
</div>
<p>You can also remove the uniqueness constraint:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
query = Client.select(:name).distinct
# =&gt; Returns unique names

query.distinct(false)
# =&gt; Returns all names, even if there are duplicates

</pre>
</div>
<h3 id="limit-and-offset">5 Limit and Offset</h3><p>To apply <code>LIMIT</code> to the SQL fired by the <code>Model.find</code>, you can specify the <code>LIMIT</code> using <code>limit</code> and <code>offset</code> methods on the relation.</p><p>You can use <code>limit</code> to specify the number of records to be retrieved, and use <code>offset</code> to specify the number of records to skip before starting to return the records. For example</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.limit(5)

</pre>
</div>
<p>will return a maximum of 5 clients and because it specifies no offset it will return the first 5 in the table. The SQL it executes looks like this:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients LIMIT 5

</pre>
</div>
<p>Adding <code>offset</code> to that</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.limit(5).offset(30)

</pre>
</div>
<p>will return instead a maximum of 5 clients beginning with the 31st. The SQL looks like:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients LIMIT 5 OFFSET 30

</pre>
</div>
<h3 id="group">6 Group</h3><p>To apply a <code>GROUP BY</code> clause to the SQL fired by the finder, you can specify the <code>group</code> method on the find.</p><p>For example, if you want to find a collection of the dates orders were created on:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Order.select("date(created_at) as ordered_date, sum(price) as total_price").group("date(created_at)")

</pre>
</div>
<p>And this will give you a single <code>Order</code> object for each date where there are orders in the database.</p><p>The SQL that would be executed would be something like this:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT date(created_at) as ordered_date, sum(price) as total_price
FROM orders
GROUP BY date(created_at)

</pre>
</div>
<h3 id="having">7 Having</h3><p>SQL uses the <code>HAVING</code> clause to specify conditions on the <code>GROUP BY</code> fields. You can add the <code>HAVING</code> clause to the SQL fired by the <code>Model.find</code> by adding the <code>:having</code> option to the find.</p><p>For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Order.select("date(created_at) as ordered_date, sum(price) as total_price").
  group("date(created_at)").having("sum(price) &gt; ?", 100)

</pre>
</div>
<p>The SQL that would be executed would be something like this:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT date(created_at) as ordered_date, sum(price) as total_price
FROM orders
GROUP BY date(created_at)
HAVING sum(price) &gt; 100

</pre>
</div>
<p>This will return single order objects for each day, but only those that are ordered more than $100 in a day.</p><h3 id="overriding-conditions">8 Overriding Conditions</h3><h4 id="except">8.1 <code>except</code>
</h4><p>You can specify certain conditions to be excepted by using the <code>except</code> method. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.where('id &gt; 10').limit(20).order('id asc').except(:order)

</pre>
</div>
<p>The SQL that would be executed:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM posts WHERE id &gt; 10 LIMIT 20

</pre>
</div>
<h4 id="unscope">8.2 <code>unscope</code>
</h4><p>The <code>except</code> method does not work when the relation is merged. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.comments.except(:order)

</pre>
</div>
<p>will still have an order if the order comes from a default scope on Comment. In order to remove all ordering, even from relations which are merged in, use unscope as follows:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.order('id DESC').limit(20).unscope(:order) = Post.limit(20)
Post.order('id DESC').limit(20).unscope(:order, :limit) = Post.all

</pre>
</div>
<p>You can additionally unscope specific where clauses. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.where(:id =&gt; 10).limit(1).unscope(where: :id, :limit).order('id DESC') = Post.order('id DESC')

</pre>
</div>
<h4 id="only">8.3 <code>only</code>
</h4><p>You can also override conditions using the <code>only</code> method. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.where('id &gt; 10').limit(20).order('id desc').only(:order, :where)

</pre>
</div>
<p>The SQL that would be executed:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM posts WHERE id &gt; 10 ORDER BY id DESC

</pre>
</div>
<h4 id="reorder">8.4 <code>reorder</code>
</h4><p>The <code>reorder</code> method overrides the default scope order. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Post &lt; ActiveRecord::Base
  ..
  ..
  has_many :comments, order: 'posted_at DESC'
end

Post.find(10).comments.reorder('name')

</pre>
</div>
<p>The SQL that would be executed:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM posts WHERE id = 10 ORDER BY name

</pre>
</div>
<p>In case the <code>reorder</code> clause is not used, the SQL executed would be:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM posts WHERE id = 10 ORDER BY posted_at DESC

</pre>
</div>
<h4 id="reverse-order">8.5 <code>reverse_order</code>
</h4><p>The <code>reverse_order</code> method reverses the ordering clause if specified.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where("orders_count &gt; 10").order(:name).reverse_order

</pre>
</div>
<p>The SQL that would be executed:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients WHERE orders_count &gt; 10 ORDER BY name DESC

</pre>
</div>
<p>If no ordering clause is specified in the query, the <code>reverse_order</code> orders by the primary key in reverse order.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where("orders_count &gt; 10").reverse_order

</pre>
</div>
<p>The SQL that would be executed:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients WHERE orders_count &gt; 10 ORDER BY clients.id DESC

</pre>
</div>
<p>This method accepts <strong>no</strong> arguments.</p><h3 id="null-relation">9 Null Relation</h3><p>The <code>none</code> method returns a chainable relation with no records. Any subsequent conditions chained to the returned relation will continue generating empty relations. This is useful in scenarios where you need a chainable response to a method or a scope that could return zero results.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.none # returns an empty Relation and fires no queries.

</pre>
</div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# The visible_posts method below is expected to return a Relation.
@posts = current_user.visible_posts.where(name: params[:name])

def visible_posts
  case role
  when 'Country Manager'
    Post.where(country: country)
  when 'Reviewer'
    Post.published
  when 'Bad User'
    Post.none # =&gt; returning [] or nil breaks the caller code in this case
  end
end

</pre>
</div>
<h3 id="readonly-objects">10 Readonly Objects</h3><p>Active Record provides <code>readonly</code> method on a relation to explicitly disallow modification of any of the returned objects. Any attempt to alter a readonly record will not succeed, raising an <code>ActiveRecord::ReadOnlyRecord</code> exception.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
client = Client.readonly.first
client.visits += 1
client.save

</pre>
</div>
<p>As <code>client</code> is explicitly set to be a readonly object, the above code will raise an <code>ActiveRecord::ReadOnlyRecord</code> exception when calling <code>client.save</code> with an updated value of <em>visits</em>.</p><h3 id="locking-records-for-update">11 Locking Records for Update</h3><p>Locking is helpful for preventing race conditions when updating records in the database and ensuring atomic updates.</p><p>Active Record provides two locking mechanisms:</p>
<ul>
<li>Optimistic Locking</li>
<li>Pessimistic Locking</li>
</ul>
<h4 id="optimistic-locking">11.1 Optimistic Locking</h4><p>Optimistic locking allows multiple users to access the same record for edits, and assumes a minimum of conflicts with the data. It does this by checking whether another process has made changes to a record since it was opened. An <code>ActiveRecord::StaleObjectError</code> exception is thrown if that has occurred and the update is ignored.</p><p><strong>Optimistic locking column</strong></p><p>In order to use optimistic locking, the table needs to have a column called <code>lock_version</code> of type integer. Each time the record is updated, Active Record increments the <code>lock_version</code> column. If an update request is made with a lower value in the <code>lock_version</code> field than is currently in the <code>lock_version</code> column in the database, the update request will fail with an <code>ActiveRecord::StaleObjectError</code>. Example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
c1 = Client.find(1)
c2 = Client.find(1)

c1.first_name = "Michael"
c1.save

c2.name = "should fail"
c2.save # Raises an ActiveRecord::StaleObjectError

</pre>
</div>
<p>You're then responsible for dealing with the conflict by rescuing the exception and either rolling back, merging, or otherwise apply the business logic needed to resolve the conflict.</p><p>This behavior can be turned off by setting <code>ActiveRecord::Base.lock_optimistically = false</code>.</p><p>To override the name of the <code>lock_version</code> column, <code>ActiveRecord::Base</code> provides a class attribute called <code>locking_column</code>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Client &lt; ActiveRecord::Base
  self.locking_column = :lock_client_column
end

</pre>
</div>
<h4 id="pessimistic-locking">11.2 Pessimistic Locking</h4><p>Pessimistic locking uses a locking mechanism provided by the underlying database. Using <code>lock</code> when building a relation obtains an exclusive lock on the selected rows. Relations using <code>lock</code> are usually wrapped inside a transaction for preventing deadlock conditions.</p><p>For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Item.transaction do
  i = Item.lock.first
  i.name = 'Jones'
  i.save
end

</pre>
</div>
<p>The above session produces the following SQL for a MySQL backend:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SQL (0.2ms)   BEGIN
Item Load (0.3ms)   SELECT * FROM `items` LIMIT 1 FOR UPDATE
Item Update (0.4ms)   UPDATE `items` SET `updated_at` = '2009-02-07 18:05:56', `name` = 'Jones' WHERE `id` = 1
SQL (0.8ms)   COMMIT

</pre>
</div>
<p>You can also pass raw SQL to the <code>lock</code> method for allowing different types of locks. For example, MySQL has an expression called <code>LOCK IN SHARE MODE</code> where you can lock a record but still allow other queries to read it. To specify this expression just pass it in as the lock option:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Item.transaction do
  i = Item.lock("LOCK IN SHARE MODE").find(1)
  i.increment!(:views)
end

</pre>
</div>
<p>If you already have an instance of your model, you can start a transaction and acquire the lock in one go using the following code:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
item = Item.first
item.with_lock do
  # This block is called within a transaction,
  # item is already locked.
  item.increment!(:views)
end

</pre>
</div>
<h3 id="joining-tables">12 Joining Tables</h3><p>Active Record provides a finder method called <code>joins</code> for specifying <code>JOIN</code> clauses on the resulting SQL. There are multiple ways to use the <code>joins</code> method.</p><h4 id="using-a-string-sql-fragment">12.1 Using a String SQL Fragment</h4><p>You can just supply the raw SQL specifying the <code>JOIN</code> clause to <code>joins</code>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.joins('LEFT OUTER JOIN addresses ON addresses.client_id = clients.id')

</pre>
</div>
<p>This will result in the following SQL:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT clients.* FROM clients LEFT OUTER JOIN addresses ON addresses.client_id = clients.id

</pre>
</div>
<h4 id="using-array-hash-of-named-associations">12.2 Using Array/Hash of Named Associations</h4><div class="warning"><p> This method only works with <code>INNER JOIN</code>.</p></div><p>Active Record lets you use the names of the <a href="association_basics.html">associations</a> defined on the model as a shortcut for specifying <code>JOIN</code> clause for those associations when using the <code>joins</code> method.</p><p>For example, consider the following <code>Category</code>, <code>Post</code>, <code>Comments</code> and <code>Guest</code> models:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Category &lt; ActiveRecord::Base
  has_many :posts
end

class Post &lt; ActiveRecord::Base
  belongs_to :category
  has_many :comments
  has_many :tags
end

class Comment &lt; ActiveRecord::Base
  belongs_to :post
  has_one :guest
end

class Guest &lt; ActiveRecord::Base
  belongs_to :comment
end

class Tag &lt; ActiveRecord::Base
  belongs_to :post
end

</pre>
</div>
<p>Now all of the following will produce the expected join queries using <code>INNER JOIN</code>:</p><h5 id="joining-a-single-association">12.2.1 Joining a Single Association</h5><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Category.joins(:posts)

</pre>
</div>
<p>This produces:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT categories.* FROM categories
  INNER JOIN posts ON posts.category_id = categories.id

</pre>
</div>
<p>Or, in English: "return a Category object for all categories with posts". Note that you will see duplicate categories if more than one post has the same category. If you want unique categories, you can use <code>Category.joins(:posts).uniq</code>.</p><h5 id="joining-multiple-associations">12.2.2 Joining Multiple Associations</h5><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.joins(:category, :comments)

</pre>
</div>
<p>This produces:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT posts.* FROM posts
  INNER JOIN categories ON posts.category_id = categories.id
  INNER JOIN comments ON comments.post_id = posts.id

</pre>
</div>
<p>Or, in English: "return all posts that have a category and at least one comment". Note again that posts with multiple comments will show up multiple times.</p><h5 id="joining-nested-associations-single-level">12.2.3 Joining Nested Associations (Single Level)</h5><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.joins(comments: :guest)

</pre>
</div>
<p>This produces:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT posts.* FROM posts
  INNER JOIN comments ON comments.post_id = posts.id
  INNER JOIN guests ON guests.comment_id = comments.id

</pre>
</div>
<p>Or, in English: "return all posts that have a comment made by a guest."</p><h5 id="joining-nested-associations-multiple-level">12.2.4 Joining Nested Associations (Multiple Level)</h5><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Category.joins(posts: [{comments: :guest}, :tags])

</pre>
</div>
<p>This produces:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT categories.* FROM categories
  INNER JOIN posts ON posts.category_id = categories.id
  INNER JOIN comments ON comments.post_id = posts.id
  INNER JOIN guests ON guests.comment_id = comments.id
  INNER JOIN tags ON tags.post_id = posts.id

</pre>
</div>
<h4 id="specifying-conditions-on-the-joined-tables">12.3 Specifying Conditions on the Joined Tables</h4><p>You can specify conditions on the joined tables using the regular <a href="#array-conditions">Array</a> and <a href="#pure-string-conditions">String</a> conditions. <a href="#hash-conditions">Hash conditions</a> provides a special syntax for specifying conditions for the joined tables:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
time_range = (Time.now.midnight - 1.day)..Time.now.midnight
Client.joins(:orders).where('orders.created_at' =&gt; time_range)

</pre>
</div>
<p>An alternative and cleaner syntax is to nest the hash conditions:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
time_range = (Time.now.midnight - 1.day)..Time.now.midnight
Client.joins(:orders).where(orders: {created_at: time_range})

</pre>
</div>
<p>This will find all clients who have orders that were created yesterday, again using a <code>BETWEEN</code> SQL expression.</p><h3 id="eager-loading-associations">13 Eager Loading Associations</h3><p>Eager loading is the mechanism for loading the associated records of the objects returned by <code>Model.find</code> using as few queries as possible.</p><p><strong>N + 1 queries problem</strong></p><p>Consider the following code, which finds 10 clients and prints their postcodes:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
clients = Client.limit(10)

clients.each do |client|
  puts client.address.postcode
end

</pre>
</div>
<p>This code looks fine at the first sight. But the problem lies within the total number of queries executed. The above code executes 1 (to find 10 clients) + 10 (one per each client to load the address) = <strong>11</strong> queries in total.</p><p><strong>Solution to N + 1 queries problem</strong></p><p>Active Record lets you specify in advance all the associations that are going to be loaded. This is possible by specifying the <code>includes</code> method of the <code>Model.find</code> call. With <code>includes</code>, Active Record ensures that all of the specified associations are loaded using the minimum possible number of queries.</p><p>Revisiting the above case, we could rewrite <code>Client.limit(10)</code> to use eager load addresses:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
clients = Client.includes(:address).limit(10)

clients.each do |client|
  puts client.address.postcode
end

</pre>
</div>
<p>The above code will execute just <strong>2</strong> queries, as opposed to <strong>11</strong> queries in the previous case:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients LIMIT 10
SELECT addresses.* FROM addresses
  WHERE (addresses.client_id IN (1,2,3,4,5,6,7,8,9,10))

</pre>
</div>
<h4 id="eager-loading-multiple-associations">13.1 Eager Loading Multiple Associations</h4><p>Active Record lets you eager load any number of associations with a single <code>Model.find</code> call by using an array, hash, or a nested hash of array/hash with the <code>includes</code> method.</p><h5 id="array-of-multiple-associations">13.1.1 Array of Multiple Associations</h5><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.includes(:category, :comments)

</pre>
</div>
<p>This loads all the posts and the associated category and comments for each post.</p><h5 id="nested-associations-hash">13.1.2 Nested Associations Hash</h5><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Category.includes(posts: [{comments: :guest}, :tags]).find(1)

</pre>
</div>
<p>This will find the category with id 1 and eager load all of the associated posts, the associated posts' tags and comments, and every comment's guest association.</p><h4 id="specifying-conditions-on-eager-loaded-associations">13.2 Specifying Conditions on Eager Loaded Associations</h4><p>Even though Active Record lets you specify conditions on the eager loaded associations just like <code>joins</code>, the recommended way is to use <a href="#joining-tables">joins</a> instead.</p><p>However if you must do this, you may use <code>where</code> as you would normally.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.includes(:comments).where("comments.visible" =&gt; true)

</pre>
</div>
<p>This would generate a query which contains a <code>LEFT OUTER JOIN</code> whereas the <code>joins</code> method would generate one using the <code>INNER JOIN</code> function instead.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
  SELECT "posts"."id" AS t0_r0, ... "comments"."updated_at" AS t1_r5 FROM "posts" LEFT OUTER JOIN "comments" ON "comments"."post_id" = "posts"."id" WHERE (comments.visible = 1)

</pre>
</div>
<p>If there was no <code>where</code> condition, this would generate the normal set of two queries.</p><p>If, in the case of this <code>includes</code> query, there were no comments for any posts, all the posts would still be loaded. By using <code>joins</code> (an INNER JOIN), the join conditions <strong>must</strong> match, otherwise no records will be returned.</p><h3 id="scopes">14 Scopes</h3><p>Scoping allows you to specify commonly-used queries which can be referenced as method calls on the association objects or models. With these scopes, you can use every method previously covered such as <code>where</code>, <code>joins</code> and <code>includes</code>. All scope methods will return an <code>ActiveRecord::Relation</code> object which will allow for further methods (such as other scopes) to be called on it.</p><p>To define a simple scope, we use the <code>scope</code> method inside the class, passing the query that we'd like to run when this scope is called:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Post &lt; ActiveRecord::Base
  scope :published, -&gt; { where(published: true) }
end

</pre>
</div>
<p>This is exactly the same as defining a class method, and which you use is a matter of personal preference:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Post &lt; ActiveRecord::Base
  def self.published
    where(published: true)
  end
end

</pre>
</div>
<p>Scopes are also chainable within scopes:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Post &lt; ActiveRecord::Base
  scope :published,               -&gt; { where(published: true) }
  scope :published_and_commented, -&gt; { published.where("comments_count &gt; 0") }
end

</pre>
</div>
<p>To call this <code>published</code> scope we can call it on either the class:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.published # =&gt; [published posts]

</pre>
</div>
<p>Or on an association consisting of <code>Post</code> objects:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
category = Category.first
category.posts.published # =&gt; [published posts belonging to this category]

</pre>
</div>
<h4 id="passing-in-arguments">14.1 Passing in arguments</h4><p>Your scope can take arguments:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Post &lt; ActiveRecord::Base
  scope :created_before, -&gt;(time) { where("created_at &lt; ?", time) }
end

</pre>
</div>
<p>This may then be called using this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Post.created_before(Time.zone.now)

</pre>
</div>
<p>However, this is just duplicating the functionality that would be provided to you by a class method.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Post &lt; ActiveRecord::Base
  def self.created_before(time)
    where("created_at &lt; ?", time)
  end
end

</pre>
</div>
<p>Using a class method is the preferred way to accept arguments for scopes. These methods will still be accessible on the association objects:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
category.posts.created_before(time)

</pre>
</div>
<h4 id="merging-of-scopes">14.2 Merging of scopes</h4><p>Just like <code>where</code> clauses scopes are merged using <code>AND</code> conditions.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ActiveRecord::Base
  scope :active, -&gt; { where state: 'active' }
  scope :inactive, -&gt; { where state: 'inactive' }
end

```ruby
User.active.inactive
# =&gt; SELECT "users".* FROM "users" WHERE "users"."state" = 'active' AND "users"."state" = 'inactive'

</pre>
</div>
<p>We can mix and match <code>scope</code> and <code>where</code> conditions and the final sql
will have all conditions joined with <code>AND</code> .</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
User.active.where(state: 'finished')
# =&gt; SELECT "users".* FROM "users" WHERE "users"."state" = 'active' AND "users"."state" = 'finished'

</pre>
</div>
<p>If we do want the <code>last where clause</code> to win then <code>Relation#merge</code> can
be used .</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
User.active.merge(User.inactive)
# =&gt; SELECT "users".* FROM "users" WHERE "users"."state" = 'inactive'

</pre>
</div>
<p>One important caveat is that <code>default_scope</code> will be overridden by
<code>scope</code> and <code>where</code> conditions.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ActiveRecord::Base
  default_scope  { where state: 'pending' }
  scope :active, -&gt; { where state: 'active' }
  scope :inactive, -&gt; { where state: 'inactive' }
end

User.all
# =&gt; SELECT "users".* FROM "users" WHERE "users"."state" = 'pending'

User.active
# =&gt; SELECT "users".* FROM "users" WHERE "users"."state" = 'active'

User.where(state: 'inactive')
# =&gt; SELECT "users".* FROM "users" WHERE "users"."state" = 'inactive'

</pre>
</div>
<p>As you can see above the <code>default_scope</code> is being overridden by both
<code>scope</code> and <code>where</code> conditions.</p><h4 id="applying-a-default-scope">14.3 Applying a default scope</h4><p>If we wish for a scope to be applied across all queries to the model we can use the
<code>default_scope</code> method within the model itself.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Client &lt; ActiveRecord::Base
  default_scope { where("removed_at IS NULL") }
end

</pre>
</div>
<p>When queries are executed on this model, the SQL query will now look something like
this:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients WHERE removed_at IS NULL

</pre>
</div>
<p>If you need to do more complex things with a default scope, you can alternatively
define it as a class method:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Client &lt; ActiveRecord::Base
  def self.default_scope
    # Should return an ActiveRecord::Relation.
  end
end

</pre>
</div>
<h4 id="removing-all-scoping">14.4 Removing All Scoping</h4><p>If we wish to remove scoping for any reason we can use the <code>unscoped</code> method. This is
especially useful if a <code>default_scope</code> is specified in the model and should not be
applied for this particular query.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.unscoped.all

</pre>
</div>
<p>This method removes all scoping and will do a normal query on the table.</p><p>Note that chaining <code>unscoped</code> with a <code>scope</code> does not work. In these cases, it is
recommended that you use the block form of <code>unscoped</code>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.unscoped {
  Client.created_before(Time.zone.now)
}

</pre>
</div>
<h3 id="동적-조회-dynamic-finders-원문·전체">15 동적 조회<span class="original-text-h">(Dynamic Finders)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h3><div class="note"><p> 동적 탐색은 Rails 4.0 에서 deprecated 되었고 Rails 4.1 에서 제거될 예정입니다. 대신 엑티브 레코드 scopes 를 사용하는것이 좋은 방법입니다. deprecation gem 에 대해서는 <a href="https://github.com/rails/activerecord-deprecated_finders">https://github.com/rails/activerecord-deprecated_finders</a> 에서 찾을수 있습니다. [[[Dynamic finders have been deprecated in Rails 4.0 and will be removed in Rails 4.1. The best practice is to use ActiveRecord scopes instead. You can find the deprecation gem at <a href="https://github.com/rails/activerecord-deprecated_finders%5D%5D">https://github.com/rails/activerecord-deprecated_finders]]</a>]</p></div><p>액티브 레코드는 테이블에서 정의하는 모든 필드에(속성이라고 불리우는) 대해서 finder 메소드를 제공합니다. 예를 들어 Client 모델에 first_name 필드가 있다면, 엑티브 레코드가 공짜로 생성해주는 find_by_first_name 메서드를 가지게됩니다. Client 모델에 locked 필드가 있다면 마찬가지로 find_by_locked 메소드를 가지게됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">For every field (also known as an attribute) you define in your table, Active Record provides a finder method. If you have a field called <code>first_name</code> on your <code>Client</code> model for example, you get <code>find_by_first_name</code> for free from Active Record. If you have a <code>locked</code> field on the <code>Client</code> model, you also get <code>find_by_locked</code> and methods.</p><p>Client.find_by_name!("Ryan") 처럼 느낌표 (!)를 동적 finder 뒤에 명시하면 메소드에서 반환되는 레코드가 없을경우 ActiveRecord::RecordNotFound 에러가 발생됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can specify an exclamation point (<code>!</code>) on the end of the dynamic finders to get them to raise an <code>ActiveRecord::RecordNotFound</code> error if they do not return any records, like <code>Client.find_by_name!("Ryan")</code></p><p>name, locked 두개의 필드에 대해서 조회 하고자 하는경우, 필드이름들 사이에 "and" 를 추가하여 연결되게 할 수 있습니다. 예를들어 Client.find_by_first_name_and_locked("Ryan", true) 처럼 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you want to find both by name and locked, you can chain these finders together by simply typing "<code>and</code>" between the fields. For example, <code>Client.find_by_first_name_and_locked("Ryan", true)</code>.</p><h3 id="객체를-조회하거나-생성하기-find-or-build-a-new-object-원문·전체">16 객체를 조회하거나 생성하기<span class="original-text-h">(Find or Build a New Object)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h3><p>레코드를 조회해서 없는 경우 새로 만들어야 할 경우가 흔히 있습니다. 이러한 경우 <code>find_or_create</code> 와 <code>find_or_create!</code> 메소드를 이용하여 해결할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">It's common that you need to find a record or create it if it doesn't exist. You can do that with the <code>find_or_create_by</code> and <code>find_or_create_by!</code> methods.</p><h4 id="find-or-create-by">16.1 <code>find_or_create_by</code>
</h4><p><code>find_or_create_by</code> 메소드는 속성값에 해당하는 레코드가 있는지 검사하고 없는경우 <code>create</code> 를 호출합니다. 예제를 살펴보겠습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>find_or_create_by</code> method checks whether a record with the attributes exists. If it doesn't, then <code>create</code> is called. Let's see an example.</p><p>가령 'Andy' 라는 이름을 가진 client 를 조회해서 존재하지 않는경우 생성하는것은 다음과 같이 실행할 수 있습니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Suppose you want to find a client named 'Andy', and if there's none, create one. You can do so by running:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.find_or_create_by(first_name: 'Andy')
# =&gt; #&lt;Client id: 1, first_name: "Andy", orders_count: 0, locked: true, created_at: "2011-08-30 06:09:27", updated_at: "2011-08-30 06:09:27"&gt;

</pre>
</div>
<p>메소드에 의해 생성된 SQL 은 다음과 같습니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The SQL generated by this method looks like this:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients WHERE (clients.first_name = 'Andy') LIMIT 1
BEGIN
INSERT INTO clients (created_at, first_name, locked, orders_count, updated_at) VALUES ('2011-08-30 05:22:57', 'Andy', 1, NULL, '2011-08-30 05:22:57')
COMMIT

</pre>
</div>
<p><code>find_or_create_by</code> 메소드는 이미 존재하는 레코드나 새로추가한 레코드중 하나를 반환합니다. 위의 예제에서 우리는 client 이름이 Andy 인 레코드가 없으므로 생성된후 반환됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text"><code>find_or_create_by</code> returns either the record that already exists or the new record. In our case, we didn't already have a client named Andy so the record is created and returned.</p><p>새로운 레코드는 데이터베이스에 저장되지 않았을수도 있습니다. 이는 유효성 검증을 통과했느냐 여부에 따라 다릅니다.(이는 <code>create</code> 메소드와 동일합니다.) <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The new record might not be saved to the database; that depends on whether validations passed or not (just like <code>create</code>).</p><p>'locked' 속성을 true 로 레코드를 생성하는데 이 속성이 쿼리에는 포함되지 않게 하고 싶은경우를 가정해보겠습니다. client 의 name 이 "Andy" 인 레코드를 조회하고 없는경우 name 속성을 "Andy", locked 속성은 false 로 하려고합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Suppose we want to set the 'locked' attribute to true if we're creating a new record, but we don't want to include it in the query. So we want to find the client named "Andy", or if that client doesn't exist, create a client named "Andy" which is not locked.</p><p>우리는 2가지 방법으로 해결할 수 있습니다. 첫번째 방법은 <code>create_with</code>를 이용하는것입니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">We can achieve this in two ways. The first is to use <code>create_with</code>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.create_with(locked: false).find_or_create_by(first_name: 'Andy')

</pre>
</div>
<p>두번째 방법은 블럭을 이용하는것입니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The second way is using a block:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.find_or_create_by(first_name: 'Andy') do |c|
  c.locked = false
end

</pre>
</div>
<p>블럭은 client 레코드가 생성될때만 실행됩니다. 이 코드를 두번째 실행하는경우 블럭의 내용은 무시됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The block will only be executed if the client is being created. The second time we run this code, the block will be ignored.</p><h4 id="find-or-create-by-bang">16.2 <code>find_or_create_by!</code>
</h4><p>새로운 레코드가 유효하지 않을때 <code>find_or_create_by!</code> 메소드는 예외를 발생합니다. 유효성에 대해서는 이 부분에서 다루는 내용이 아니지만 다음과 같이 추가한다고 가정해보겠습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can also use <code>find_or_create_by!</code> to raise an exception if the new record is invalid. Validations are not covered on this guide, but let's assume for a moment that you temporarily add</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
validates :orders_count, presence: true

</pre>
</div>
<p><code>orders_count</code> 속성이 없이 <code>Client</code> 모델을 생성하는경우 레코드는 유효하지 않기 때문에 예외가 발생합니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">to your <code>Client</code> model. If you try to create a new <code>Client</code> without passing an <code>orders_count</code>, the record will be invalid and an exception will be raised:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.find_or_create_by!(first_name: 'Andy')
# =&gt; ActiveRecord::RecordInvalid: Validation failed: Orders count can't be blank

</pre>
</div>
<h4 id="find-or-initialize-by">16.3 <code>find_or_initialize_by</code>
</h4><p><code>find_or_initialize_by</code> 메소드는 <code>find_or_create_by</code> 메소드와 거의 동일하지만 레코드 생성시 <code>create</code> 메소드 대신 <code>new</code> 메소드를 호출합니다. 이는 곧 새로운 레코드가 메모리에만 존재하고 데이터베이스에 저장되지 않음을 의미합니다. <code>find_or_create_by</code> 예제에 이어서 'Nick' 라는 이름을 가진 Client 를 원할때 동작은 다음과 같습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>find_or_initialize_by</code> method will work just like <code>find_or_create_by</code> but it will call <code>new</code> instead of <code>create</code>. This means that a new model instance will be created in memory but won't be saved to the database. Continuing with the <code>find_or_create_by</code> example, we now want the client named 'Nick':</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
nick = Client.find_or_initialize_by(first_name: 'Nick')
# =&gt; &lt;Client id: nil, first_name: "Nick", orders_count: 0, locked: true, created_at: "2011-08-30 06:09:27", updated_at: "2011-08-30 06:09:27"&gt;

nick.persisted?
# =&gt; false

nick.new_record?
# =&gt; true

</pre>
</div>
<p>위와 같이 동작하는 이유는 데이터베이스에 객체가 저장되지 않았기 때문입니다. SQL은 다음과 같습니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Because the object is not yet stored in the database, the SQL generated looks like this:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT * FROM clients WHERE (clients.first_name = 'Nick') LIMIT 1

</pre>
</div>
<p>데이터베이스에 저장하고 싶다면 <code>save</code> 메소드를 실행합니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">When you want to save it to the database, just call <code>save</code>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
nick.save
# =&gt; true

</pre>
</div>
<h3 id="sql-을-이용한-조회-finding-by-sql-원문·전체">17 SQL 을 이용한 조회<span class="original-text-h">(Finding by SQL)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h3><p>테이블에서 레코드를 조회할때 당신만의 SQL 을 이용하려면 <code>find_by_sql</code> 메소드를 사용하면된다. <code>find_by_sql</code> 메소드는 객체의 결과가 하나일지라도 배열을 반환한다. 다음과 같은 쿼리를 실행하는 예제를 보자 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you'd like to use your own SQL to find records in a table you can use <code>find_by_sql</code>. The <code>find_by_sql</code> method will return an array of objects even if the underlying query returns just a single record. For example you could run this query:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.find_by_sql("SELECT * FROM clients
  INNER JOIN orders ON clients.id = orders.client_id
  ORDER clients.created_at desc")

</pre>
</div>
<p><code>find_by_sql</code>은 데이터베이스에 인스턴스화된 객체를 조회하는 간단한 방법을 제공한다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text"><code>find_by_sql</code> provides you with a simple way of making custom calls to the database and retrieving instantiated objects.</p><h4 id="select-all">17.1 <code>select_all</code>
</h4><p><code>find_by_sql</code> 메소드는 <code>connection#select_all</code> 와 밀접한 연관이 있다. <code>select_all</code> 메소드는 <code>find_by_sql</code> 와 비슷하게 데이터베이스로부터 커스텀 SQL을 이용해 객체를 조회하지만 인스턴스화 하지는 않고 해쉬(해쉬가 레코드 하나)로 이루어진 배열을 반환한다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text"><code>find_by_sql</code> has a close relative called <code>connection#select_all</code>. <code>select_all</code> will retrieve objects from the database using custom SQL just like <code>find_by_sql</code> but will not instantiate them. Instead, you will get an array of hashes where each hash indicates a record.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.connection.select_all("SELECT * FROM clients WHERE id = '1'")

</pre>
</div>
<h4 id="pluck">17.2 <code>pluck</code>
</h4><p><code>pluck</code>은 모델의 하나 또는 여러개의 컬럼(속성)을 조회하고자 할때 사용한다. 여러개의 컬럼이름을 인자로 받는경우 주어진 컬럼이름에 대한 데이터로 이루어진 배열을 반환한다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text"><code>pluck</code> can be used to query a single or multiple columns from the underlying table of a model. It accepts a list of column names as argument and returns an array of values of the specified columns with the corresponding data type.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where(active: true).pluck(:id)
# SELECT id FROM clients WHERE active = 1
# =&gt; [1, 2, 3]

Client.distinct.pluck(:role)
# SELECT DISTINCT role FROM clients
# =&gt; ['admin', 'member', 'guest']

Client.pluck(:id, :name)
# SELECT clients.id, clients.name FROM clients
# =&gt; [[1, 'David'], [2, 'Jeremy'], [3, 'Jose']]

</pre>
</div>
<p><code>pluck</code> 메소드를 이용해 다음과 같은 코드를 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text"><code>pluck</code> makes it possible to replace code like</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.select(:id).map { |c| c.id }
# or
Client.select(:id).map(&amp;:id)
# or
Client.select(:id, :name).map { |c| [c.id, c.name] }

</pre>
</div>
<p>이렇게 변경할 수 있습니 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">with</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.pluck(:id)
# or
Client.pluck(:id, :name)

</pre>
</div>
<h4 id="ids">17.3 <code>ids</code>
</h4><p><code>ids</code> 메소드는 <code>pluck</code> 메소드에 테이블의 primary key 를 인자로 준것처럼 동작 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text"><code>ids</code> can be used to pluck all the IDs for the relation using the table's primary key.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Person.ids
# SELECT id FROM people

</pre>
</div>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Person &lt; ActiveRecord::Base
  self.primary_key = "person_id"
end

Person.ids
# SELECT person_id FROM people

</pre>
</div>
<h3 id="객체의-존재-확인-existence-of-objects-원문·전체">18 객체의 존재 확인<span class="original-text-h">(Existence of Objects)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h3><p>당신은 객체의 존재 유무를 간단하게 확인하는 <code>exists?</code> 메소드를 원할것입니다. 이 메소드는 <code>find</code> 메소드의 쿼리와 동일하게 데이터베이스에서 조회하지만 객체나 객체의 배열을 반환하는 대신 <code>true</code>, <code>false</code>중 하나를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you simply want to check for the existence of the object there's a method called <code>exists?</code>. This method will query the database using the same query as <code>find</code>, but instead of returning an object or collection of objects it will return either <code>true</code> or <code>false</code>.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.exists?(1)

</pre>
</div>
<p><code>exists?</code> 메소드는 여러개의 id 를 인자로 받을수 있지만 이중 하나라도 레코드가 존재하면 true를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>exists?</code> method also takes multiple ids, but the catch is that it will return true if any one of those records exists.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.exists?(1,2,3)
# or
Client.exists?([1,2,3])

</pre>
</div>
<p>모델이나 관계에 대해서 인자없이 <code>exists?</code>를 사용할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">It's even possible to use <code>exists?</code> without any arguments on a model or a relation.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where(first_name: 'Ryan').exists?

</pre>
</div>
<p>위의 예제는 <code>first_name</code> 속성이 'Ryan'인 client 가 하나라도 있다면 <code>true</code> 없다면 <code>false</code>를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The above returns <code>true</code> if there is at least one client with the <code>first_name</code> 'Ryan' and <code>false</code> otherwise.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.exists?

</pre>
</div>
<p>위의 예제는 <code>clients</code> 테이블이 비어있다면 <code>false</code> 그렇지 않다면 <code>true</code>를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The above returns <code>false</code> if the <code>clients</code> table is empty and <code>true</code> otherwise.</p><p>또한 <code>any?</code> 혹은 <code>many?</code> 메소드를 이용하여 모델이나 관계의 존재 유무를 확인할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can also use <code>any?</code> and <code>many?</code> to check for existence on a model or relation.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
# via a model
Post.any?
Post.many?

# via a named scope
Post.recent.any?
Post.recent.many?

# via a relation
Post.where(published: true).any?
Post.where(published: true).many?

# via an association
Post.first.categories.any?
Post.first.categories.many?

</pre>
</div>
<h3 id="계산-calculations-원문·전체">19 계산<span class="original-text-h">(Calculations)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h3><p>이번 섹션의 아래 예제에서 사용된 count 메소드의 설명은 계산의 모든 하위 섹션에 적용가능합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">This section uses count as an example method in this preamble, but the options described apply to all sub-sections.</p><p>모든 계산 메소드는 모델에 직접 실행합니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">All calculation methods work directly on a model:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.count
# SELECT count(*) AS count_all FROM clients

</pre>
</div>
<p>관계의 경우 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Or on a relation:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.where(first_name: 'Ryan').count
# SELECT count(*) AS count_all FROM clients WHERE (first_name = 'Ryan')

</pre>
</div>
<p>관계의 다양한 finder 메소드의 복잡한 계산도 됩니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can also use various finder methods on a relation for performing complex calculations:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.includes("orders").where(first_name: 'Ryan', orders: {status: 'received'}).count

</pre>
</div>
<p>위의 예제는 다음과 같이 실행됩니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Which will execute:</p><div class="code_container">
<pre class="brush: sql; gutter: false; toolbar: false">
SELECT count(DISTINCT clients.id) AS count_all FROM clients
  LEFT OUTER JOIN orders ON orders.client_id = client.id WHERE
  (clients.first_name = 'Ryan' AND orders.status = 'received')

</pre>
</div>
<h4 id="갯수-count-원문·전체">19.1 갯수<span class="original-text-h">(Count)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h4><p>모델의 테이블에 얼마나 많은 레코드가 존재하는지 확인하려면 <code>Client.count</code> 메소드의 반환값을 확인하면 됩니다. client 의 나이가 존재하는 레코드와 같은 특정한 조건을 지정하려면 다음과 같이 사용합니다 <code>Client.count(:age)</code> <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you want to see how many records are in your model's table you could call <code>Client.count</code> and that will return the number. If you want to be more specific and find all the clients with their age present in the database you can use <code>Client.count(:age)</code>.</p><p>옵션에 대한 설명은 상위 섹션을 참고합니다. <a href="#calculations">Calculations</a> <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">For options, please see the parent section,</p><h4 id="평균-average-원문·전체">19.2 평균<span class="original-text-h">(Average)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h4><p>테이블의 평균값을 확인하려면 <code>average</code> 메소드를 이용합니다. 이 메소드는 다음과 같이 사용합니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you want to see the average of a certain number in one of your tables you can call the <code>average</code> method on the class that relates to the table. This method call will look something like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.average("orders_count")

</pre>
</div>
<p>위의 예제는 반환값(3.14159265와 같이 소수점이 가능합니다)은 속성의 평균값입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">This will return a number (possibly a floating point number such as 3.14159265) representing the average value in the field.</p><p>옵션에 대한 설명은 상위 섹션을 참고합니다. <a href="#calculations">Calculations</a> <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">For options, please see the parent section,</p><h4 id="최소-minimum-원문·전체">19.3 최소<span class="original-text-h">(Minimum)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h4><p>테이블의 최소값을 확인하려면 <code>minimum</code> 메소드를 이용합니다. 이 메소드는 다음과 같이 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you want to find the minimum value of a field in your table you can call the <code>minimum</code> method on the class that relates to the table. This method call will look something like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.minimum("age")

</pre>
</div>
<p>옵션에 대한 설명은 상위 섹션을 참고합니다. <a href="#calculations">Calculations</a> <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">For options, please see the parent section,</p><h4 id="최대-maximum-원문·전체">19.4 최대<span class="original-text-h">(Maximum)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h4><p>테이블의 최대값을 확인하려면 <code>maximum</code> 메소드를 이용합니다. 이 메소드는 다음과 같이 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you want to find the maximum value of a field in your table you can call the <code>maximum</code> method on the class that relates to the table. This method call will look something like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.maximum("age")

</pre>
</div>
<p>옵션에 대한 설명은 상위 섹션을 참고합니다. <a href="#calculations">Calculations</a> <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">For options, please see the parent section,</p><h4 id="합-sum-원문·전체">19.5 합<span class="original-text-h">(Sum)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h4><p>테이블의 모든 레코드의 합계를 확인하려면 <code>sum</code> 메소드를 이용합니다. 이 메소드는 다음과 같이 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you want to find the sum of a field for all records in your table you can call the <code>sum</code> method on the class that relates to the table. This method call will look something like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
Client.sum("orders_count")

</pre>
</div>
<p>옵션에 대한 설명은 상위 섹션을 참고합니다. <a href="#calculations">Calculations</a> <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">For options, please see the parent section,</p><h3 id="explain-실행-running-explain-원문·전체">20 EXPLAIN 실행<span class="original-text-h">(Running EXPLAIN)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h3><p>관계에 대한 쿼리에 EXPLAIN 을 실행할수 있습니다. 예를들어, <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can run EXPLAIN on the queries triggered by relations. For example,</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
User.where(id: 1).joins(:posts).explain

</pre>
</div>
<p>아마도 다음과 같은 결과가 나올겁니다 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">may yield</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
EXPLAIN for: SELECT `users`.* FROM `users` INNER JOIN `posts` ON `posts`.`user_id` = `users`.`id` WHERE `users`.`id` = 1
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+
| id | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra       |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+
|  1 | SIMPLE      | users | const | PRIMARY       | PRIMARY | 4       | const |    1 |             |
|  1 | SIMPLE      | posts | ALL   | NULL          | NULL    | NULL    | NULL  |    1 | Using where |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------------+
2 rows in set (0.00 sec)

</pre>
</div>
<p>MySQL 의 경우. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">under MySQL.</p><p>엑티브 레코드는 데이터베이스쉘의 결과처럼 이쁘게 출력합니다. 같은 쿼리를 PostgreSQL 에서는 다음과 같이 출력합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Active Record performs a pretty printing that emulates the one of the database shells. So, the same query running with the PostgreSQL adapter would yield instead</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
EXPLAIN for: SELECT "users".* FROM "users" INNER JOIN "posts" ON "posts"."user_id" = "users"."id" WHERE "users"."id" = 1
                                  QUERY PLAN
------------------------------------------------------------------------------
 Nested Loop Left Join  (cost=0.00..37.24 rows=8 width=0)
   Join Filter: (posts.user_id = users.id)
   -&gt;  Index Scan using users_pkey on users  (cost=0.00..8.27 rows=1 width=4)
         Index Cond: (id = 1)
   -&gt;  Seq Scan on posts  (cost=0.00..28.88 rows=8 width=4)
         Filter: (posts.user_id = 1)
(6 rows)

</pre>
</div>
<p>Eager loading 은 실제로 하나 이상의 쿼리를 실행하는데 일부 쿼리는 이전 조회 결과에 대한 쿼리들입니다. 그렇기 때문에 <code>explain</code>은 실제 실행되는 쿼리들에 대해 실행계획을 요청하게됩니다. 예를 들어, <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Eager loading may trigger more than one query under the hood, and some queries may need the results of previous ones. Because of that, <code>explain</code> actually executes the query, and then asks for the query plans. For example,</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
User.where(id: 1).includes(:posts).explain

</pre>
</div>
<p>출력 결과 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">yields</p><div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
EXPLAIN for: SELECT `users`.* FROM `users`  WHERE `users`.`id` = 1
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
| id | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
|  1 | SIMPLE      | users | const | PRIMARY       | PRIMARY | 4       | const |    1 |       |
+----+-------------+-------+-------+---------------+---------+---------+-------+------+-------+
1 row in set (0.00 sec)

EXPLAIN for: SELECT `posts`.* FROM `posts`  WHERE `posts`.`user_id` IN (1)
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
| id | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra       |
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
|  1 | SIMPLE      | posts | ALL  | NULL          | NULL | NULL    | NULL |    1 | Using where |
+----+-------------+-------+------+---------------+------+---------+------+------+-------------+
1 row in set (0.00 sec)

</pre>
</div>
<p>MySQL일 경우입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">under MySQL.</p><h4 id="explain-해석-interpreting-explain-원문·전체">20.1 EXPLAIN 해석<span class="original-text-h">(Interpreting EXPLAIN)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h4><p>EXPLAIN 결과의 해석에 대해서는 본 가이드의 범위를 넘어가는것입니다. 다음의 문서들이 도움이 될것입니다 : <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Interpretation of the output of EXPLAIN is beyond the scope of this guide. The following pointers may be helpful:</p>
<ul>
<li><p>SQLite3: <a href="http://www.sqlite.org/eqp.html">EXPLAIN QUERY PLAN</a></p></li>
<li><p>MySQL: <a href="http://dev.mysql.com/doc/refman/5.6/en/explain-output.html">EXPLAIN Output Format</a></p></li>
<li><p>PostgreSQL: <a href="http://www.postgresql.org/docs/current/static/using-explain.html">Using EXPLAIN</a></p></li>
</ul>


        <h3>피드백</h3>
        <p>
          이 가이드의 질을 향상시키기 위한 도움을 기다리고 있습니다.
        </p>
        <p>
          수정이 필요한 오타나 에러를 발견하면 <a href="https://github.com/lifo/docrails">docrails</a>을 클론한 후 직접 변경내용을 push하시기 바랍니다. 레일스의 해당 브랜치는 누구나가 write 권한이 있습니다. 커밋한 내용에 대해서는 검토작업이 이루어질 것이지만 변경내용을 서밋한 이후에 진행됩니다. <a href="https://github.com/lifo/docrails">docrails</a>은 정기적으로 master 브랜치와 클로스 머지됩니다. 
        </p>
        <p>
          미완성된 내용이나 업데이트되지 않은 내용이 있을 수 있습니다. 누락된 문서를 추가해 주시기 바랍니다. 문서작성시 참고해야할 스타일과 규칙은 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a>를 확인하시기 바랍니다. 
        </p>
        <p>
          어떤 이유에서든지, 수정이 필요한 부분을 직접 변경할 수 없는 경우에는 <a href="https://github.com/rails/rails/issues">open an issue</a>로 접속하여 문제점을 제출해 주시기 바랍니다. 
        </p>
        <p>
          마지막으로, 루비온레일스 문서화에 관련된 논의가 필요한 사항은 <a href="http://groups.google.com/group/rubyonrails-docs">rubyonrails-docs mailing list</a>에서 해 주시기 바랍니다. 
        </p>
        <h3>문서생성일</h3>
        <p>최종 생성일 : 2015-01-26 10:55:26 +0900 </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>이 작업은 <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0</a> License 특허권을 가지고 있습니다.</p>
<p>"Rails", "Ruby on Rails", 그리고 레일스 로고는 David Heinemeier Hansson의 등록상표이며, 저작권 보호를 받고 있습니다.</p>


    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all()
    $(guidesIndex.bind);
  </script>
</body>
</html>
