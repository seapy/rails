<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>액티브레코드 Associations(Active Record Associations) {원문·전체} — Ruby on Rails Guides</title>
<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

<link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

<link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div>
    <img src="images/edge_badge.png" alt="edge-badge" id="edge-badge" />
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">More at <a href="http://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        More Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://rubyonrails.org/">개요</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/download">다운로드</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/deploy">배포</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">코드</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/screencasts">스크린캐스트</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/documentation">도큐먼트</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/ecosystem">생태계</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/community">커뮤니티</a></li>
        <li class="more-info"><a href="http://weblog.rubyonrails.org/">블로그</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Return to home page">Guides.rubyonrails.org</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">홈</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" onclick="guideMenu(); return false;" id="guidesMenu" class="guides-index-item nav-item">가이드 인덱스</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>Start Here</dt>
                <dd><a href="getting_started.html">Getting Started with Rails</a></dd>
                <dt>Models</dt>
                <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                <dd><a href="association_basics.html">Active Record Associations</a></dd>
                <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                <dt>Views</dt>
                <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                <dt>Controllers</dt>
                <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
              </dl>
              <dl class="R">
                <dt>Digging Deeper</dt>
                <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                <dd><a href="i18n.html">Rails Internationalization API</a></dd>
                <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                <dd><a href="active_job_basics.html">Active Job Basics</a></dd>
                <dd><a href="security.html">Securing Rails Applications</a></dd>
                <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                <dd><a href="command_line.html">Rails Command Line Tools and Rake Tasks</a></dd>
                <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants</a></dd>
                <dt>Extending Rails</dt>
                <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                <dd><a href="generators.html">Creating and Customizing Rails Generators</a></dd>
                <dt>Contributing to Ruby on Rails</dt>
                <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a></dd>
                <dt>Maintenance Policy</dt>
                <dd><a href="maintenance_policy.html">Maintenance Policy</a></dd>
                <dt>Release Notes</dt>
                <dd><a href="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</a></dd>
                <dd><a href="4_2_release_notes.html">Ruby on Rails 4.2 Release Notes</a></dd>
                <dd><a href="4_1_release_notes.html">Ruby on Rails 4.1 Release Notes</a></dd>
                <dd><a href="4_0_release_notes.html">Ruby on Rails 4.0 Release Notes</a></dd>
                <dd><a href="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes</a></dd>
                <dd><a href="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes</a></dd>
                <dd><a href="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes</a></dd>
                <dd><a href="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes</a></dd>
                <dd><a href="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">기여하기</a></li>
        <li><a class="nav-item" href="credits.html">크레딧</a></li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">가이드 인덱스</option>
              <optgroup label="Start Here">
                  <option value="getting_started.html">Getting Started with Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Digging Deeper">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="i18n.html">Rails Internationalization API</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="active_job_basics.html">Active Job Basics</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">Rails Command Line Tools and Rake Tasks</option>
                  <option value="asset_pipeline.html">Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants</option>
              </optgroup>
              <optgroup label="Extending Rails">
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators</option>
              </optgroup>
              <optgroup label="Contributing to Ruby on Rails">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</option>
              </optgroup>
              <optgroup label="Maintenance Policy">
                  <option value="maintenance_policy.html">Maintenance Policy</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</option>
                  <option value="4_2_release_notes.html">Ruby on Rails 4.2 Release Notes</option>
                  <option value="4_1_release_notes.html">Ruby on Rails 4.1 Release Notes</option>
                  <option value="4_0_release_notes.html">Ruby on Rails 4.0 Release Notes</option>
                  <option value="3_2_release_notes.html">Ruby on Rails 3.2 Release Notes</option>
                  <option value="3_1_release_notes.html">Ruby on Rails 3.1 Release Notes</option>
                  <option value="3_0_release_notes.html">Ruby on Rails 3.0 Release Notes</option>
                  <option value="2_3_release_notes.html">Ruby on Rails 2.3 Release Notes</option>
                  <option value="2_2_release_notes.html">Ruby on Rails 2.2 Release Notes</option>
              </optgroup>
          </select>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>액티브레코드 Associations<span class="original-text-h">(Active Record Associations)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href='#' class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></h2><p>본 가이드에서는 액티브레코드의 Association(관계) 에 관해 다룹니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href='#' class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">This guide covers the association features of Active Record.</p><p>본 가이드를 읽고나면 아래 사항을 알게 될것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href='#' class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">After reading this guide, you will know:</p>
<ul>
<li><p>액티브레코드 모델간의 Association 설정하는 방법 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href='#' class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">How to declare associations between Active Record models.</p></li>
<li><p>액티브레코드 Association의 다양한 종류에 대한 이해 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href='#' class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">How to understand the various types of Active Record associations.</p></li>
<li><p>Association 모델에 메서드를 추가하는 방법 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href='#' class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">How to use the methods added to your models by creating associations.</p></li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#associations%EC%9D%80-%EC%99%9C-%ED%95%84%EC%9A%94%ED%95%9C%EA%B0%80-questionmark-why-associations-questionmark-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">Associations은 왜 필요한가?<span class="original-text-h">(Why Associations?)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
<li>
<a href="#associations%EC%9D%98-%EC%A2%85%EB%A5%98-the-types-of-associations-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">Associations의 종류<span class="original-text-h">(The Types of Associations)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a>

<ul>
<li><a href="#the-belongs-to-association">The <code>belongs_to</code> Association</a></li>
<li><a href="#the-has-one-association">The <code>has_one</code> Association</a></li>
<li><a href="#the-has-many-association">The <code>has_many</code> Association</a></li>
<li><a href="#the-has-many-through-association">The <code>has_many :through</code> Association</a></li>
<li><a href="#the-has-one-through-association">The <code>has_one :through</code> Association</a></li>
<li><a href="#the-has-and-belongs-to-many-association">The <code>has_and_belongs_to_many</code> Association</a></li>
<li><a href="#choosing-between-belongs-to-and-has-one">Choosing Between <code>belongs_to</code> and <code>has_one</code></a></li>
<li><a href="#choosing-between-has-many-through-and-has-and-belongs-to-many">Choosing Between <code>has_many :through</code> and <code>has_and_belongs_to_many</code></a></li>
<li><a href="#polymorphic-associations">Polymorphic Associations</a></li>
<li><a href="#self-joins">Self Joins</a></li>
</ul>
</li>
<li>
<a href="#%ED%8C%81-%EC%86%8D%EC%9E%84%EC%88%98-%EC%A3%BC%EC%9D%98-tips-tricks-and-warnings-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">팁, 속임수, 주의<span class="original-text-h">(Tips, Tricks, and Warnings)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a>

<ul>
<li><a href="#controlling-caching">Controlling Caching</a></li>
<li><a href="#avoiding-name-collisions">Avoiding Name Collisions</a></li>
<li><a href="#updating-the-schema">Updating the Schema</a></li>
<li><a href="#controlling-association-scope">Controlling Association Scope</a></li>
<li><a href="#bi-directional-associations">Bi-directional Associations</a></li>
</ul>
</li>
<li>
<a href="#association%EC%97%90-%EB%8C%80%ED%95%9C-%EC%9E%90%EC%84%B8%ED%95%9C-%EC%B0%B8%EC%A1%B0-detailed-association-reference-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">Association에 대한 자세한 참조<span class="original-text-h">(Detailed Association Reference)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a>

<ul>
<li><a href="#belongs-to-association-reference"><code>belongs_to</code> Association Reference</a></li>
<li><a href="#has-one-association-reference"><code>has_one</code> Association Reference</a></li>
<li><a href="#has-many-association-reference"><code>has_many</code> Association Reference</a></li>
<li><a href="#has-and-belongs-to-many-association-reference"><code>has_and_belongs_to_many</code> Association Reference</a></li>
<li><a href="#%EA%B4%80%EA%B3%84-%EC%BD%9C%EB%B0%B1-association-callbacks-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">관계 콜백<span class="original-text-h">(Association Callbacks)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
<li><a href="#%EA%B4%80%EA%B3%84-%ED%99%95%EC%9E%A5-association-extensions-%EC%9B%90%EB%AC%B8%C2%B7%EC%A0%84%EC%B2%B4">관계 확장<span class="original-text-h">(Association Extensions)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup></a></li>
</ul>
</li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="associations은-왜-필요한가-questionmark-why-associations-questionmark-원문·전체">1 Associations은 왜 필요한가?<span class="original-text-h">(Why Associations?)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h3><p>Why do we need associations between models? Because they make common operations simpler and easier in your code. For example, consider a simple Rails application that includes a model for customers and a model for orders. Each customer can have many orders. Without associations, the model declarations would look like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
end

class Order &lt; ActiveRecord::Base
end

</pre>
</div>
<p>Now, suppose we wanted to add a new order for an existing customer. We'd need to do something like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@order = Order.create(order_date: Time.now, customer_id: @customer.id)

</pre>
</div>
<p>Or consider deleting a customer, and ensuring that all of its orders get deleted as well:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@orders = Order.where(customer_id: @customer.id)
@orders.each do |order|
  order.destroy
end
@customer.destroy

</pre>
</div>
<p>With Active Record associations, we can streamline these — and other — operations by declaratively telling Rails that there is a connection between the two models. Here's the revised code for setting up customers and orders:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, dependent: :destroy
end

class Order &lt; ActiveRecord::Base
  belongs_to :customer
end

</pre>
</div>
<p>With this change, creating a new order for a particular customer is easier:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@order = @customer.orders.create(order_date: Time.now)

</pre>
</div>
<p>Deleting a customer and all of its orders is <em>much</em> easier:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@customer.destroy

</pre>
</div>
<p>To learn more about the different types of associations, read the next section of this guide. That's followed by some tips and tricks for working with associations, and then by a complete reference to the methods and options for associations in Rails.</p><h3 id="associations의-종류-the-types-of-associations-원문·전체">2 Associations의 종류<span class="original-text-h">(The Types of Associations)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h3><p>In Rails, an <em>association</em> is a connection between two Active Record models. Associations are implemented using macro-style calls, so that you can declaratively add features to your models. For example, by declaring that one model <code>belongs_to</code> another, you instruct Rails to maintain Primary Key–Foreign Key information between instances of the two models, and you also get a number of utility methods added to your model. Rails supports six types of associations:</p>
<ul>
<li><code>belongs_to</code></li>
<li><code>has_one</code></li>
<li><code>has_many</code></li>
<li><code>has_many :through</code></li>
<li><code>has_one :through</code></li>
<li><code>has_and_belongs_to_many</code></li>
</ul>
<p>In the remainder of this guide, you'll learn how to declare and use the various forms of associations. But first, a quick introduction to the situations where each association type is appropriate.</p><h4 id="the-belongs-to-association">2.1 The <code>belongs_to</code> Association</h4><p>A <code>belongs_to</code> association sets up a one-to-one connection with another model, such that each instance of the declaring model "belongs to" one instance of the other model. For example, if your application includes customers and orders, and each order can be assigned to exactly one customer, you'd declare the order model this way:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer
end

</pre>
</div>
<p><img src="images/belongs_to.png" alt="belongs_to Association Diagram"></p><div class="note"><p> <code>belongs_to</code> associations <em>must</em> use the singular term. If you used the pluralized form in the above example for the <code>customer</code> association in the <code>Order</code> model, you would be told that there was an "uninitialized constant Order::Customers". This is because Rails automatically infers the class name from the association name. If the association name is wrongly pluralized, then the inferred class will be wrongly pluralized too.</p></div><p>The corresponding migration might look like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreateOrders &lt; ActiveRecord::Migration
  def change
    create_table :customers do |t|
      t.string :name
      t.timestamps
    end

    create_table :orders do |t|
      t.belongs_to :customer
      t.datetime :order_date
      t.timestamps
    end
  end
end

</pre>
</div>
<h4 id="the-has-one-association">2.2 The <code>has_one</code> Association</h4><p>A <code>has_one</code> association also sets up a one-to-one connection with another model, but with somewhat different semantics (and consequences). This association indicates that each instance of a model contains or possesses one instance of another model. For example, if each supplier in your application has only one account, you'd declare the supplier model like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account
end

</pre>
</div>
<p><img src="images/has_one.png" alt="has_one Association Diagram"></p><p>The corresponding migration might look like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreateSuppliers &lt; ActiveRecord::Migration
  def change
    create_table :suppliers do |t|
      t.string :name
      t.timestamps
    end

    create_table :accounts do |t|
      t.belongs_to :supplier
      t.string :account_number
      t.timestamps
    end
  end
end

</pre>
</div>
<h4 id="the-has-many-association">2.3 The <code>has_many</code> Association</h4><p>A <code>has_many</code> association indicates a one-to-many connection with another model. You'll often find this association on the "other side" of a <code>belongs_to</code> association. This association indicates that each instance of the model has zero or more instances of another model. For example, in an application containing customers and orders, the customer model could be declared like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders
end

</pre>
</div>
<div class="note"><p> The name of the other model is pluralized when declaring a <code>has_many</code> association.</p></div><p><img src="images/has_many.png" alt="has_many Association Diagram"></p><p>The corresponding migration might look like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreateCustomers &lt; ActiveRecord::Migration
  def change
    create_table :customers do |t|
      t.string :name
      t.timestamps
    end

    create_table :orders do |t|
      t.belongs_to :customer
      t.datetime :order_date
      t.timestamps
    end
  end
end

</pre>
</div>
<h4 id="the-has-many-through-association">2.4 The <code>has_many :through</code> Association</h4><p>A <code>has_many :through</code> association is often used to set up a many-to-many connection with another model. This association indicates that the declaring model can be matched with zero or more instances of another model by proceeding <em>through</em> a third model. For example, consider a medical practice where patients make appointments to see physicians. The relevant association declarations could look like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Physician &lt; ActiveRecord::Base
  has_many :appointments
  has_many :patients, through: :appointments
end

class Appointment &lt; ActiveRecord::Base
  belongs_to :physician
  belongs_to :patient
end

class Patient &lt; ActiveRecord::Base
  has_many :appointments
  has_many :physicians, through: :appointments
end

</pre>
</div>
<p><img src="images/has_many_through.png" alt="has_many :through Association Diagram"></p><p>The corresponding migration might look like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreateAppointments &lt; ActiveRecord::Migration
  def change
    create_table :physicians do |t|
      t.string :name
      t.timestamps
    end

    create_table :patients do |t|
      t.string :name
      t.timestamps
    end

    create_table :appointments do |t|
      t.belongs_to :physician
      t.belongs_to :patient
      t.datetime :appointment_date
      t.timestamps
    end
  end
end

</pre>
</div>
<p>The collection of join models can be managed via the API. For example, if you assign</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
physician.patients = patients

</pre>
</div>
<p>new join models are created for newly associated objects, and if some are gone their rows are deleted.</p><div class="warning"><p> Automatic deletion of join models is direct, no destroy callbacks are triggered.</p></div><p>The <code>has_many :through</code> association is also useful for setting up "shortcuts" through nested <code>has_many</code> associations. For example, if a document has many sections, and a section has many paragraphs, you may sometimes want to get a simple collection of all paragraphs in the document. You could set that up this way:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Document &lt; ActiveRecord::Base
  has_many :sections
  has_many :paragraphs, through: :sections
end

class Section &lt; ActiveRecord::Base
  belongs_to :document
  has_many :paragraphs
end

class Paragraph &lt; ActiveRecord::Base
  belongs_to :section
end

</pre>
</div>
<p>With <code>through: :sections</code> specified, Rails will now understand:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@document.paragraphs

</pre>
</div>
<h4 id="the-has-one-through-association">2.5 The <code>has_one :through</code> Association</h4><p>A <code>has_one :through</code> association sets up a one-to-one connection with another model. This association indicates that the declaring model can be matched with one instance of another model by proceeding <em>through</em> a third model. For example, if each supplier has one account, and each account is associated with one account history, then the customer model could look like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account
  has_one :account_history, through: :account
end

class Account &lt; ActiveRecord::Base
  belongs_to :supplier
  has_one :account_history
end

class AccountHistory &lt; ActiveRecord::Base
  belongs_to :account
end

</pre>
</div>
<p><img src="images/has_one_through.png" alt="has_one :through Association Diagram"></p><p>The corresponding migration might look like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreateAccountHistories &lt; ActiveRecord::Migration
  def change
    create_table :suppliers do |t|
      t.string :name
      t.timestamps
    end

    create_table :accounts do |t|
      t.belongs_to :supplier
      t.string :account_number
      t.timestamps
    end

    create_table :account_histories do |t|
      t.belongs_to :account
      t.integer :credit_rating
      t.timestamps
    end
  end
end

</pre>
</div>
<h4 id="the-has-and-belongs-to-many-association">2.6 The <code>has_and_belongs_to_many</code> Association</h4><p>A <code>has_and_belongs_to_many</code> association creates a direct many-to-many connection with another model, with no intervening model. For example, if your application includes assemblies and parts, with each assembly having many parts and each part appearing in many assemblies, you could declare the models this way:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Assembly &lt; ActiveRecord::Base
  has_and_belongs_to_many :parts
end

class Part &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies
end

</pre>
</div>
<p><img src="images/habtm.png" alt="has_and_belongs_to_many Association Diagram"></p><p>The corresponding migration might look like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreateAssembliesAndParts &lt; ActiveRecord::Migration
  def change
    create_table :assemblies do |t|
      t.string :name
      t.timestamps
    end

    create_table :parts do |t|
      t.string :part_number
      t.timestamps
    end

    create_table :assemblies_parts do |t|
      t.belongs_to :assembly
      t.belongs_to :part
    end
  end
end

</pre>
</div>
<h4 id="choosing-between-belongs-to-and-has-one">2.7 Choosing Between <code>belongs_to</code> and <code>has_one</code>
</h4><p>If you want to set up a one-to-one relationship between two models, you'll need to add <code>belongs_to</code> to one, and <code>has_one</code> to the other. How do you know which is which?</p><p>The distinction is in where you place the foreign key (it goes on the table for the class declaring the <code>belongs_to</code> association), but you should give some thought to the actual meaning of the data as well. The <code>has_one</code> relationship says that one of something is yours - that is, that something points back to you. For example, it makes more sense to say that a supplier owns an account than that an account owns a supplier. This suggests that the correct relationships are like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account
end

class Account &lt; ActiveRecord::Base
  belongs_to :supplier
end

</pre>
</div>
<p>The corresponding migration might look like this:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreateSuppliers &lt; ActiveRecord::Migration
  def change
    create_table :suppliers do |t|
      t.string  :name
      t.timestamps
    end

    create_table :accounts do |t|
      t.integer :supplier_id
      t.string  :account_number
      t.timestamps
    end
  end
end

</pre>
</div>
<div class="note"><p> Using <code>t.integer :supplier_id</code> makes the foreign key naming obvious and explicit. In current versions of Rails, you can abstract away this implementation detail by using <code>t.references :supplier</code> instead.</p></div><h4 id="choosing-between-has-many-through-and-has-and-belongs-to-many">2.8 Choosing Between <code>has_many :through</code> and <code>has_and_belongs_to_many</code>
</h4><p>Rails offers two different ways to declare a many-to-many relationship between models. The simpler way is to use <code>has_and_belongs_to_many</code>, which allows you to make the association directly:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Assembly &lt; ActiveRecord::Base
  has_and_belongs_to_many :parts
end

class Part &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies
end

</pre>
</div>
<p>The second way to declare a many-to-many relationship is to use <code>has_many :through</code>. This makes the association indirectly, through a join model:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Assembly &lt; ActiveRecord::Base
  has_many :manifests
  has_many :parts, through: :manifests
end

class Manifest &lt; ActiveRecord::Base
  belongs_to :assembly
  belongs_to :part
end

class Part &lt; ActiveRecord::Base
  has_many :manifests
  has_many :assemblies, through: :manifests
end

</pre>
</div>
<p>The simplest rule of thumb is that you should set up a <code>has_many :through</code> relationship if you need to work with the relationship model as an independent entity. If you don't need to do anything with the relationship model, it may be simpler to set up a <code>has_and_belongs_to_many</code> relationship (though you'll need to remember to create the joining table in the database).</p><p>You should use <code>has_many :through</code> if you need validations, callbacks, or extra attributes on the join model.</p><h4 id="polymorphic-associations">2.9 Polymorphic Associations</h4><p>A slightly more advanced twist on associations is the <em>polymorphic association</em>. With polymorphic associations, a model can belong to more than one other model, on a single association. For example, you might have a picture model that belongs to either an employee model or a product model. Here's how this could be declared:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Picture &lt; ActiveRecord::Base
  belongs_to :imageable, polymorphic: true
end

class Employee &lt; ActiveRecord::Base
  has_many :pictures, as: :imageable
end

class Product &lt; ActiveRecord::Base
  has_many :pictures, as: :imageable
end

</pre>
</div>
<p>You can think of a polymorphic <code>belongs_to</code> declaration as setting up an interface that any other model can use. From an instance of the <code>Employee</code> model, you can retrieve a collection of pictures: <code>@employee.pictures</code>.</p><p>Similarly, you can retrieve <code>@product.pictures</code>.</p><p>If you have an instance of the <code>Picture</code> model, you can get to its parent via <code>@picture.imageable</code>. To make this work, you need to declare both a foreign key column and a type column in the model that declares the polymorphic interface:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreatePictures &lt; ActiveRecord::Migration
  def change
    create_table :pictures do |t|
      t.string  :name
      t.integer :imageable_id
      t.string  :imageable_type
      t.timestamps
    end
  end
end

</pre>
</div>
<p>This migration can be simplified by using the <code>t.references</code> form:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreatePictures &lt; ActiveRecord::Migration
  def change
    create_table :pictures do |t|
      t.string :name
      t.references :imageable, polymorphic: true
      t.timestamps
    end
  end
end

</pre>
</div>
<p><img src="images/polymorphic.png" alt="Polymorphic Association Diagram"></p><h4 id="self-joins">2.10 Self Joins</h4><p>In designing a data model, you will sometimes find a model that should have a relation to itself. For example, you may want to store all employees in a single database model, but be able to trace relationships such as between manager and subordinates. This situation can be modeled with self-joining associations:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Employee &lt; ActiveRecord::Base
  has_many :subordinates, class_name: "Employee",
                          foreign_key: "manager_id"

  belongs_to :manager, class_name: "Employee"
end

</pre>
</div>
<p>With this setup, you can retrieve <code>@employee.subordinates</code> and <code>@employee.manager</code>.</p><h3 id="팁-속임수-주의-tips-tricks-and-warnings-원문·전체">3 팁, 속임수, 주의<span class="original-text-h">(Tips, Tricks, and Warnings)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h3><p>Here are a few things you should know to make efficient use of Active Record associations in your Rails applications:</p>
<ul>
<li>Controlling caching</li>
<li>Avoiding name collisions</li>
<li>Updating the schema</li>
<li>Controlling association scope</li>
<li>Bi-directional associations</li>
</ul>
<h4 id="controlling-caching">3.1 Controlling Caching</h4><p>All of the association methods are built around caching, which keeps the result of the most recent query available for further operations. The cache is even shared across methods. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
customer.orders                 # retrieves orders from the database
customer.orders.size            # uses the cached copy of orders
customer.orders.empty?          # uses the cached copy of orders

</pre>
</div>
<p>But what if you want to reload the cache, because data might have been changed by some other part of the application? Just pass <code>true</code> to the association call:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
customer.orders                 # retrieves orders from the database
customer.orders.size            # uses the cached copy of orders
customer.orders(true).empty?    # discards the cached copy of orders
                                # and goes back to the database

</pre>
</div>
<h4 id="avoiding-name-collisions">3.2 Avoiding Name Collisions</h4><p>You are not free to use just any name for your associations. Because creating an association adds a method with that name to the model, it is a bad idea to give an association a name that is already used for an instance method of <code>ActiveRecord::Base</code>. The association method would override the base method and break things. For instance, <code>attributes</code> or <code>connection</code> are bad names for associations.</p><h4 id="updating-the-schema">3.3 Updating the Schema</h4><p>Associations are extremely useful, but they are not magic. You are responsible for maintaining your database schema to match your associations. In practice, this means two things, depending on what sort of associations you are creating. For <code>belongs_to</code> associations you need to create foreign keys, and for <code>has_and_belongs_to_many</code> associations you need to create the appropriate join table.</p><h5 id="creating-foreign-keys-for-belongs-to-associations">3.3.1 Creating Foreign Keys for <code>belongs_to</code> Associations</h5><p>When you declare a <code>belongs_to</code> association, you need to create foreign keys as appropriate. For example, consider this model:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer
end

</pre>
</div>
<p>This declaration needs to be backed up by the proper foreign key declaration on the orders table:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreateOrders &lt; ActiveRecord::Migration
  def change
    create_table :orders do |t|
      t.datetime :order_date
      t.string   :order_number
      t.integer  :customer_id
    end
  end
end

</pre>
</div>
<p>If you create an association some time after you build the underlying model, you need to remember to create an <code>add_column</code> migration to provide the necessary foreign key.</p><h5 id="creating-join-tables-for-has-and-belongs-to-many-associations">3.3.2 Creating Join Tables for <code>has_and_belongs_to_many</code> Associations</h5><p>If you create a <code>has_and_belongs_to_many</code> association, you need to explicitly create the joining table. Unless the name of the join table is explicitly specified by using the <code>:join_table</code> option, Active Record creates the name by using the lexical order of the class names. So a join between customer and order models will give the default join table name of "customers_orders" because "c" outranks "o" in lexical ordering.</p><div class="warning"><p> The precedence between model names is calculated using the <code>&lt;</code> operator for <code>String</code>. This means that if the strings are of different lengths, and the strings are equal when compared up to the shortest length, then the longer string is considered of higher lexical precedence than the shorter one. For example, one would expect the tables "paper_boxes" and "papers" to generate a join table name of "papers_paper_boxes" because of the length of the name "paper_boxes", but it in fact generates a join table name of "paper_boxes_papers" (because the underscore '_' is lexicographically <em>less</em> than 's' in common encodings).</p></div><p>Whatever the name, you must manually generate the join table with an appropriate migration. For example, consider these associations:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Assembly &lt; ActiveRecord::Base
  has_and_belongs_to_many :parts
end

class Part &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies
end

</pre>
</div>
<p>These need to be backed up by a migration to create the <code>assemblies_parts</code> table. This table should be created without a primary key:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class CreateAssembliesPartsJoinTable &lt; ActiveRecord::Migration
  def change
    create_table :assemblies_parts, id: false do |t|
      t.integer :assembly_id
      t.integer :part_id
    end
  end
end

</pre>
</div>
<p>We pass <code>id: false</code> to <code>create_table</code> because that table does not represent a model. That's required for the association to work properly. If you observe any strange behavior in a <code>has_and_belongs_to_many</code> association like mangled models IDs, or exceptions about conflicting IDs, chances are you forgot that bit.</p><h4 id="controlling-association-scope">3.4 Controlling Association Scope</h4><p>By default, associations look for objects only within the current module's scope. This can be important when you declare Active Record models within a module. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module MyApplication
  module Business
    class Supplier &lt; ActiveRecord::Base
       has_one :account
    end

    class Account &lt; ActiveRecord::Base
       belongs_to :supplier
    end
  end
end

</pre>
</div>
<p>This will work fine, because both the <code>Supplier</code> and the <code>Account</code> class are defined within the same scope. But the following will <em>not</em> work, because <code>Supplier</code> and <code>Account</code> are defined in different scopes:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module MyApplication
  module Business
    class Supplier &lt; ActiveRecord::Base
       has_one :account
    end
  end

  module Billing
    class Account &lt; ActiveRecord::Base
       belongs_to :supplier
    end
  end
end

</pre>
</div>
<p>To associate a model with a model in a different namespace, you must specify the complete class name in your association declaration:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module MyApplication
  module Business
    class Supplier &lt; ActiveRecord::Base
       has_one :account,
        class_name: "MyApplication::Billing::Account"
    end
  end

  module Billing
    class Account &lt; ActiveRecord::Base
       belongs_to :supplier,
        class_name: "MyApplication::Business::Supplier"
    end
  end
end

</pre>
</div>
<h4 id="bi-directional-associations">3.5 Bi-directional Associations</h4><p>It's normal for associations to work in two directions, requiring declaration on two different models:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders
end

class Order &lt; ActiveRecord::Base
  belongs_to :customer
end

</pre>
</div>
<p>By default, Active Record doesn't know about the connection between these associations. This can lead to two copies of an object getting out of sync:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
c = Customer.first
o = c.orders.first
c.first_name == o.customer.first_name # =&gt; true
c.first_name = 'Manny'
c.first_name == o.customer.first_name # =&gt; false

</pre>
</div>
<p>This happens because c and o.customer are two different in-memory representations of the same data, and neither one is automatically refreshed from changes to the other. Active Record provides the <code>:inverse_of</code> option so that you can inform it of these relations:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, inverse_of: :customer
end

class Order &lt; ActiveRecord::Base
  belongs_to :customer, inverse_of: :orders
end

</pre>
</div>
<p>With these changes, Active Record will only load one copy of the customer object, preventing inconsistencies and making your application more efficient:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
c = Customer.first
o = c.orders.first
c.first_name == o.customer.first_name # =&gt; true
c.first_name = 'Manny'
c.first_name == o.customer.first_name # =&gt; true

</pre>
</div>
<p>There are a few limitations to <code>inverse_of</code> support:</p>
<ul>
<li>They do not work with <code>:through</code> associations.</li>
<li>They do not work with <code>:polymorphic</code> associations.</li>
<li>They do not work with <code>:as</code> associations.</li>
<li>For <code>belongs_to</code> associations, <code>has_many</code> inverse associations are ignored.</li>
</ul>
<h3 id="association에-대한-자세한-참조-detailed-association-reference-원문·전체">4 Association에 대한 자세한 참조<span class="original-text-h">(Detailed Association Reference)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h3><p>이제부터 association 종류별로 association을 사용할때 추가할수 있는 메서드, 옵션에 대해서 자세하게 이야기합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The following sections give the details of each type of association, including the methods that they add and the options that you can use when declaring an association.</p><h4 id="belongs-to-association-reference">4.1 <code>belongs_to</code> Association Reference</h4><p><code>belongs_to</code> 관계형은 다른 모델과 일대일 연결을 만들어 줍니다. 데이터베이스 용어로는, 해당 클래스가 foreign key 를 가지게 된다고 말합니다. 다른 클래스가 foreign key 를 가지게 되면, has_one 관계형을 사용해야 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>belongs_to</code> association creates a one-to-one match with another model. In database terms, this association says that this class contains the foreign key. If the other class contains the foreign key, then you should use <code>has_one</code> instead.</p><h5 id="belongs-to에-의해-추가된-메소드-methods-added-by-belongs-to-원문·전체">4.1.1 <code>belongs_to</code>에 의해 추가된 메소드<span class="original-text-h">(Methods Added by <code>belongs_to</code>)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p><code>belongs_to</code> 관계선언을 하게 되면, 선언하는 클래스는 자동으로 다음의 4가지 메소드를 사용할 수 있게 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">When you declare a <code>belongs_to</code> association, the declaring class automatically gains four methods related to the association:</p>
<ul>
<li><code>association(force_reload = false)</code></li>
<li><code>association=(associate)</code></li>
<li><code>build_association(attributes = {})</code></li>
<li><code>create_association(attributes = {})</code></li>
</ul>
<p>위의 모든 메소드에서 <code>association</code> 을 <code>belongs_to</code> 의 첫번째 인수로 받은 심볼로 바꾸면 됩니다. 예를 들어, 다음과 같이 선언하면, <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">In all of these methods, <code>association</code> is replaced with the symbol passed as the first argument to <code>belongs_to</code>. For example, given the declaration:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer
end

</pre>
</div>
<p>Order 모델의 각 인스턴스는 다음과 같은 메소드를 가지게 될 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Each instance of the order model will have these methods:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
customer
customer=
build_customer
create_customer

</pre>
</div>
<div class="note">
<p> <code>has_one</code> 또는 <code>belongs_to</code> 관계형을 새로 생성해서 초기화할 때는, <code>has_many</code> 또는 <code>has_and_belongs_to_many</code> 관계형에 대해서 사용되는 <code>association.build</code> 메소드보다는, 관계형을 만들 때 선언시 넘겨주는 첫번째 인수에 <code>build_</code> 를 붙여서 사용해야 합니다. 초기화가 아니라 생성할 때는 create_ 를 붙여서 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">When initializing a new <code>has_one</code> or <code>belongs_to</code> association you must use the <code>build_</code> prefix to build the association, rather than the <code>association.build</code> method that would be used for <code>has_many</code> or <code>has_and_belongs_to_many</code> associations. To create one, use the <code>create_</code> prefix.</p>
</div><h6 id="belongs-to에-의해-추가된-메소드-methods-added-by-belongs-to-원문·전체-association-force-reload-false">4.1.1.1 <code>association(force_reload = false)</code>
</h6><p><code>association</code> 메소드는 연결된 객체가 있을 경우 그것을 반환합니다. 연결된 객체가 없는 경우에는, nil 값을 반환하게 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>association</code> method returns the associated object, if any. If no associated object is found, it returns <code>nil</code>.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@customer = @order.customer

</pre>
</div>
<p>연관된 객체가 이미 이 객체에 대해서 데이터베이스로부터 데이터를 가져온 상태라면 캐시된 버전이 반환될 것입니다. 이 때 강제로 데이터베이스로부터 데이터를 다시 불러오고자 할 경우에는, <code>force_reload</code> 값으로 <code>true</code> 값을 넘겨주어야 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If the associated object has already been retrieved from the database for this object, the cached version will be returned. To override this behavior (and force a database read), pass <code>true</code> as the <code>force_reload</code> argument.</p><h6 id="belongs-to에-의해-추가된-메소드-methods-added-by-belongs-to-원문·전체-association-associate">4.1.1.2 <code>association=(associate)</code>
</h6><p><code>association=</code> 메소드는 이 객체에 연관된 객체를 할당합니다. 보이지 않는곳에서 이루어지는 작업을 살펴보면 연관된 객체로부터 primary key 값을 가져와서 이 객체의 foreign key 로 할당하게 되는 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>association=</code> method assigns an associated object to this object. Behind the scenes, this means extracting the primary key from the associate object and setting this object's foreign key to the same value.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@order.customer = @customer

</pre>
</div>
<h6 id="belongs-to에-의해-추가된-메소드-methods-added-by-belongs-to-원문·전체-build-association-attributes">4.1.1.3 <code>build_association(attributes = {})</code>
</h6><p><code>build_association</code> 메소드는 해당 관계형의 새로운 객체를 반환해 줍니다. 그리고, 이 객체는 매개변수로 넘어온 속성값으로 초기화되며, 이 객체의 foreign key 값은 설정될 것이지만, 연관된 객체는 <em>아직</em> 저장되지 않은 상태입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>build_association</code> method returns a new object of the associated type. This object will be instantiated from the passed attributes, and the link through this object's foreign key will be set, but the associated object will <em>not</em> yet be saved.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@customer = @order.build_customer(customer_number: 123,
                                  customer_name: "John Doe")

</pre>
</div>
<h6 id="belongs-to에-의해-추가된-메소드-methods-added-by-belongs-to-원문·전체-create-association-attributes">4.1.1.4 <code>create_association(attributes = {})</code>
</h6><p><code>create_association</code> 메소드는 해당 관계형의 새로운 객체를 반환해 줍니다. 이 객체는 넘어온 속성으로 초기화되며, 이 객체의 foreign key 값이 설정됩니다. 또한, 연관된 객체의 모든 유효성 검증을 통과하면 저장될 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>create_association</code> method returns a new object of the associated type. This object will be instantiated from the passed attributes, the link through this object's foreign key will be set, and, once it passes all of the validations specified on the associated model, the associated object <em>will</em> be saved.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@customer = @order.create_customer(customer_number: 123,
                                   customer_name: "John Doe")

</pre>
</div>
<h5 id="belongs-to-옵션-options-for-belongs-to-원문·전체">4.1.2 <code>belongs_to</code> 옵션<span class="original-text-h">(Options for <code>belongs_to</code>)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p>대부분의 경우 레일스의 기본설정값은 잘 작동하지만, <code>belongs_to</code> 의 동작을 커스터마이징하고 싶을때가 있을것입니다. association을 설정할때 옵션, scope block 을 추가해서 쉽게 커스터마이제이션 할 수 있습니다. 예를 들어, 몇가지 옵션을 가지는 관계설정은 다음과 같습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">While Rails uses intelligent defaults that will work well in most situations, there may be times when you want to customize the behavior of the <code>belongs_to</code> association reference. Such customizations can easily be accomplished by passing options and scope blocks when you create the association. For example, this association uses two such options:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer, dependent: :destroy,
    counter_cache: true
end

</pre>
</div>
<p><code>belongs_to</code> 메소드는 다음과 같은 옵션을 사용할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>belongs_to</code> association supports these options:</p>
<ul>
<li><code>:autosave</code></li>
<li><code>:class_name</code></li>
<li><code>:counter_cache</code></li>
<li><code>:dependent</code></li>
<li><code>:foreign_key</code></li>
<li><code>:inverse_of</code></li>
<li><code>:polymorphic</code></li>
<li><code>:touch</code></li>
<li><code>:validate</code></li>
</ul>
<h6 id="belongs-to-옵션-options-for-belongs-to-원문·전체-autosave">4.1.2.1 <code>:autosave</code>
</h6><p><code>:autosave</code> 옵션을 <code>true</code> 값으로 설정하면, 레일스는 모객체가 저장될 때마다 모든 로딩된 멤버를 저장하고 삭제표시된 멤버를 삭제할 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you set the <code>:autosave</code> option to <code>true</code>, Rails will save any loaded members and destroy members that are marked for destruction whenever you save the parent object.</p><h6 id="belongs-to-옵션-options-for-belongs-to-원문·전체-class-name">4.1.2.2 <code>:class_name</code>
</h6><p>다른 모델의 이름을 관계선언이름으로부터 알 수 없을 경우에는 <code>:class_name</code> 옵션을 이용해서 모델명을 명시할 수 있습니다. 예를 들면, order 가 customer 모델에 속하지만, customers 를 포함하는 모델의 실제 이름이 <code>Patron</code> 이라면 다음과 같이 설정해야 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If the name of the other model cannot be derived from the association name, you can use the <code>:class_name</code> option to supply the model name. For example, if an order belongs to a customer, but the actual name of the model containing customers is <code>Patron</code>, you'd set things up this way:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer, class_name: "Patron"
end

</pre>
</div>
<h6 id="counter-cache">4.1.2.3 <code>:counter_cache</code>
</h6><p><code>:counter_cache</code> 옵션은 속하는 객체의 숫자를 계산하는 일을 보다 효율적으로 하도록 해 줍니다. 다음 모델을 살펴 보겠습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>:counter_cache</code> option can be used to make finding the number of belonging objects more efficient. Consider these models:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer
end
class Customer &lt; ActiveRecord::Base
  has_many :orders
end

</pre>
</div>
<p>이렇게 선언하면 @customer.orders.size 값을 요청할 때 데이터베이스에서 COUNT(<em>) 쿼리문을 호출하게 됩니다. 이러한 호출을 방지하기 위해서 <em>귀속되는</em> 모델에 counter_cache 옵션을 추가할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></em></p><p class="original-text">With these declarations, asking for the value of <code>@customer.orders.size</code> requires making a call to the database to perform a `COUNT()` query. To avoid this call, you can add a counter cache to the <em>belonging</em> model:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer, counter_cache: true
end
class Customer &lt; ActiveRecord::Base
  has_many :orders
end

</pre>
</div>
<p>이렇게 선언하면, 레일스가 캐시값을 최신값으로 유지하게 되고 size 메소드를 호출할 때 그 값을 반환하게 되는 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">With this declaration, Rails will keep the cache value up to date, and then return that value in response to the <code>size</code> method.</p><p><code>:counter_cache</code> 옵션을 <code>belongs_to</code> 선언을 가지고 있는 모델에 명시했지만 실제 컬럼은 <em>연관된</em> 모델에 추가해 주어야 합니다. 위의 예에서, <code>Customer</code> 모델에 <code>orders_count</code> 컬럼을 추가해 주어야 합니다. 필요하다면 기본 컬럼명을 변경할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Although the <code>:counter_cache</code> option is specified on the model that includes the <code>belongs_to</code> declaration, the actual column must be added to the <em>associated</em> model. In the case above, you would need to add a column named <code>orders_count</code> to the <code>Customer</code> model. You can override the default column name if you need to:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer, counter_cache: :count_of_orders
end
class Customer &lt; ActiveRecord::Base
  has_many :orders
end

</pre>
</div>
<p>Counter cache 컴럼은 <code>attr_readonly</code> 옵션을 이용해서 해당 모델의 읽기전용 속성 목록에 추가됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Counter cache columns are added to the containing model's list of read-only attributes through <code>attr_readonly</code>.</p><h6 id="belongs-to-옵션-options-for-belongs-to-원문·전체-dependent">4.1.2.4 <code>:dependent</code>
</h6><p><code>:dependent</code> 옵션을 <code>:destroy</code> 값으로 설정하면 객체를 삭제할 때 연관된 객체도 삭제하기 위해 <code>destroy</code> 메소드를 호출할 것입니다. <code>:dependent</code> 옵션을 <code>:delete</code> 로 설정하면, <code>destroy</code> 메소드를 호출하지 <em>않고</em> 연관된 객체를 삭제할 것입니다. <code>:dependent</code> 옵션을 <code>:restrict</code> 로 설정하면 객체를 삭제하고자 할때 연관된 객체가 존재하는경우 <code>ActiveRecord::DeleteRestrictionError</code> 에러를 발생합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you set the <code>:dependent</code> option to <code>:destroy</code>, then deleting this object will call the <code>destroy</code> method on the associated object to delete that object. If you set the <code>:dependent</code> option to <code>:delete</code>, then deleting this object will delete the associated object <em>without</em> calling its <code>destroy</code> method. If you set the <code>:dependent</code> option to <code>:restrict</code>, then attempting to delete this object will result in a <code>ActiveRecord::DeleteRestrictionError</code> if there are any associated objects.</p><div class="warning">
<p> <code>belongs_to</code>로 연관된 객체에 <code>has_many</code> 관계형이 설정되어 있는경우 이 옵션을 사용해서는 안됩니다. 사용하게 된다면 데이터베이스에 모 객체가 없이 자 객체만 남는 경우가 생길수있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">You should not specify this option on a <code>belongs_to</code> association that is connected with a <code>has_many</code> association on the other class. Doing so can lead to orphaned records in your database.</p>
</div><h6 id="belongs-to-옵션-options-for-belongs-to-원문·전체-foreign-key">4.1.2.5 <code>:foreign_key</code>
</h6><p>관례에 의해, 레일스는 foreign key 컬럼명을 연관된 모델명에 <code>_id</code> 를 추가한 이름으로 간주합니다. 이 때 <code>:foreign_key</code> 옵션을 이용하여 직접 foreign key 이름을 설정할 수 있게 해 줍니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">By convention, Rails assumes that the column used to hold the foreign key on this model is the name of the association with the suffix <code>_id</code> added. The <code>:foreign_key</code> option lets you set the name of the foreign key directly:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer, class_name: "Patron",
                        foreign_key: "patron_id"
end

</pre>
</div>
<div class="info">
<p> 어떠한 경우에라도, 레일스가 개발자를 대신해서 foreign key 컬럼을 만들어 주지 않습니다. 마이그레이션 파일에 명시적으로 정의해 주어야 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">In any case, Rails will not create foreign key columns for you. You need to explicitly define them as part of your migrations.</p>
</div><h6 id="belongs-to-옵션-options-for-belongs-to-원문·전체-inverse-of">4.1.2.6 <code>:inverse_of</code>
</h6><p><code>:inverse_of</code> 옵션은 <code>has_many</code> 또는 <code>has_one</code> association에 대해 이 객체를 다시 참조하도록 이름을 지정한다.(현재는 <code>:has_many</code> 옵션에 대해 동작하지 않는것으로 되어있다) <code>:polymorphic</code> 옵션이 설정된경우 동작하지 않는다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>:inverse_of</code> option specifies the name of the <code>has_many</code> or <code>has_one</code> association that is the inverse of this association. Does not work in combination with the <code>:polymorphic</code> options.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, inverse_of: :customer
end

class Order &lt; ActiveRecord::Base
  belongs_to :customer, inverse_of: :orders
end

</pre>
</div>
<h6 id="polymorphic">4.1.2.7 <code>:polymorphic</code>
</h6><p><code>:polymorphic</code> 옵션에 <code>true</code> 값을 할당하면, 이 관계는 다형성 관계형을 가지게 됩니다. 이에 대해서는 이미 <a href="#polymorphic-associations">이전</a>에 설명한 바 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Passing <code>true</code> to the <code>:polymorphic</code> option indicates that this is a polymorphic association. Polymorphic associations were discussed in detail <a href="#polymorphic-associations">earlier in this guide</a>.</p><h6 id="touch">4.1.2.8 <code>:touch</code>
</h6><p><code>:touch</code> 옵션을 <code>true</code> 로 설정하면 연관된 객체가 저장되거나 삭제(destroyed)될 때 그 객체의 <code>updated_at</code> 또는 <code>updated_on</code> 타임스탬프 컬럼이 현재의 시간으로 설정됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you set the <code>:touch</code> option to <code>:true</code>, then the <code>updated_at</code> or <code>updated_on</code> timestamp on the associated object will be set to the current time whenever this object is saved or destroyed:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer, touch: true
end

class Customer &lt; ActiveRecord::Base
  has_many :orders
end

</pre>
</div>
<p>이 경우에, order를 저장하거나 삭제할 때 이와 연관된 customer 객체의 타임스탬프가 현재의 시간으로 업데이트될 것입니다. 이 때, 물론 업데이트할 타임스탬프 속성명을 명시해 줄 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">In this case, saving or destroying an order will update the timestamp on the associated customer. You can also specify a particular timestamp attribute to update:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer, touch: :orders_updated_at
end

</pre>
</div>
<h6 id="belongs-to-옵션-options-for-belongs-to-원문·전체-validate">4.1.2.9 <code>:validate</code>
</h6><p><code>:validate</code> 옵션을 <code>true</code> 값으로 설정하면, 이 객체를 저장할 때 마다 연관된 객체의 유효성 검증과정이 수행될 것입니다. 기본값은 <code>false</code> 로 지정되어 있으며 객체가 저장될 때 연관된 객체의 유효성 검증이 수행되지 않을 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you set the <code>:validate</code> option to <code>true</code>, then associated objects will be validated whenever you save this object. By default, this is <code>false</code>: associated objects will not be validated when this object is saved.</p><h5 id="scopes-for-belongs-to">4.1.3 Scopes for <code>belongs_to</code>
</h5><p>쿼리를 이용해 <code>belongs_to</code>를 커스터마이즈할때 scope block을 자주 사용합니다. 예를 들자면 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">There may be times when you wish to customize the query used by <code>belongs_to</code>. Such customizations can be achieved via a scope block. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer, -&gt; { where active: true },
                        dependent: :destroy
end

</pre>
</div>
<p><a href="active_record_querying.html">querying methods</a> 를 scope block 내부에 사용할수 있습니다. 다음과 같은것들은 아래에 설명되어 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can use any of the standard <a href="active_record_querying.html">querying methods</a> inside the scope block. The following ones are discussed below:</p>
<ul>
<li><code>where</code></li>
<li><code>includes</code></li>
<li><code>readonly</code></li>
<li><code>select</code></li>
</ul>
<h6 id="scopes-for-belongs-to-where">4.1.3.1 <code>where</code>
</h6><p><code>where</code> 메서드는 지정된 조건에 해당할때만 객체와 연관되도록 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>where</code> method lets you specify the conditions that the associated object must meet.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Order &lt; ActiveRecord::Base
  belongs_to :customer, -&gt; { where active: true }
end

</pre>
</div>
<h6 id="scopes-for-belongs-to-includes">4.1.3.2 <code>includes</code>
</h6><p>eager-loaded를 사용하고자 할때 <code>includes</code> 메서드를 사용합니다. 예를들어 다음과 같은 모델들이 있다고 가정하고 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can use the <code>includes</code> method let you specify second-order associations that should be eager-loaded when this association is used. For example, consider these models:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class LineItem &lt; ActiveRecord::Base
  belongs_to :order
end

class Order &lt; ActiveRecord::Base
  belongs_to :customer
  has_many :line_items
end

class Customer &lt; ActiveRecord::Base
  has_many :orders
end

</pre>
</div>
<p>line items 모델로부터 customers 를 자주 탐색(<code>@line_item.order.customer</code>) 한다, 코드를 좀더 효율적으로 하기 위해 line item 의 orders 관계설정에 customer를 포함하도록 할수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you frequently retrieve customers directly from line items (<code>@line_item.order.customer</code>), then you can make your code somewhat more efficient by including customers in the association from line items to orders:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class LineItem &lt; ActiveRecord::Base
  belongs_to :order, -&gt; { includes :customer }
end

class Order &lt; ActiveRecord::Base
  belongs_to :customer
  has_many :line_items
end

class Customer &lt; ActiveRecord::Base
  has_many :orders
end

</pre>
</div>
<div class="note">
<p> 직접 관계가 설정되어 있는경우에는 <code>includes</code> 메서드를 사용할 필요가 없습니다. <code>Order belongs_to :customer</code> 관계설정의 경우 Order를 로딩할때 customer 객체는 필요할때 자동으로 eager-loaded 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">There's no need to use <code>includes</code> for immediate associations - that is, if you have <code>Order belongs_to :customer</code>, then the customer is eager-loaded automatically when it's needed.</p>
</div><h6 id="scopes-for-belongs-to-readonly">4.1.3.3 <code>readonly</code>
</h6><p><code>readonly</code>를 사용하면 연관된 객체는 관계를 통해 검색될 때 읽기전용으로 설정됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you use <code>readonly</code>, then the associated object will be read-only when retrieved via the association.</p><h6 id="scopes-for-belongs-to-select">4.1.3.4 <code>select</code>
</h6><p><code>select</code> 메서드는 관계를 통해 데이터를 검색할때 <code>SELECT</code> 구문을 재정의 할 수 있도록 합니다. 레일스 기본설정은 모든 컬럼을 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>select</code> method lets you override the SQL <code>SELECT</code> clause that is used to retrieve data about the associated object. By default, Rails retrieves all columns.</p><div class="info">
<p> <code>belongs_to</code> 관계설정에 <code>select</code>를 사용하는경우 <code>:foreign_key</code> 옵션을 설정해야 정확한 결과를 얻을수 있다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">If you use the <code>select</code> method on a <code>belongs_to</code> association, you should also set the <code>:foreign_key</code> option to guarantee the correct results.</p>
</div><h5 id="연관된-객체의-존재유무를-알-수-있는-방법-do-any-associated-objects-exist-questionmark-원문·전체">4.1.4 연관된 객체의 존재유무를 알 수 있는 방법<span class="original-text-h">(Do Any Associated Objects Exist?)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p>연관된 객체가 존재하는지 알기 위해서는 <code>association.nil?</code> 메서드로 확인하면 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can see if any associated objects exist by using the <code>association.nil?</code> method:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
if @order.customer.nil?
  @msg = "No customer found for this order"
end

</pre>
</div>
<h5 id="belongs-to-association-reference-객체는-언제-저장되는가-questionmark-when-are-objects-saved-questionmark-원문·전체">4.1.5 객체는 언제 저장되는가?<span class="original-text-h">(When are Objects Saved?)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p>특정 객체를 <code>belongs_to</code> 관계형으로 지정한다고 해서 자동으로 그 객체를 저장하지 <em>않습니다.</em> 또한, 연관된 객체도 저장하지 않습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Assigning an object to a <code>belongs_to</code> association does <em>not</em> automatically save the object. It does not save the associated object either.</p><h4 id="has-one-association-reference">4.2 <code>has_one</code> Association Reference</h4><p><code>has_one</code> association은 다른 모델과 일대일관계를 생성합니다. 데이터베이스용어로는 다른 클래스가 foreign key를 가지고 있다고 합니다. 만약 이 클래스가 foreign key를 가지고 있다면 <code>belongs_to</code>를 사용해야합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>has_one</code> association creates a one-to-one match with another model. In database terms, this association says that the other class contains the foreign key. If this class contains the foreign key, then you should use <code>belongs_to</code> instead.</p><h5 id="has-one에-의해-추가된-메소드-methods-added-by-has-one-원문·전체">4.2.1 <code>has_one</code>에 의해 추가된 메소드<span class="original-text-h">(Methods Added by <code>has_one</code>)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p><code>has_one</code> 관계선언을 하게 되면, 선언하는 클래스는 자동으로 다음의 4가지 메소드를 사용할 수 있게 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">When you declare a <code>has_one</code> association, the declaring class automatically gains four methods related to the association:</p>
<ul>
<li><code>association(force_reload = false)</code></li>
<li><code>association=(associate)</code></li>
<li><code>build_association(attributes = {})</code></li>
<li><code>create_association(attributes = {})</code></li>
</ul>
<p>위의 모든 메소드에서 <code>association</code> 을 <code>has_one</code> 의 첫번째 인수로 받은 심볼로 바꾸면 됩니다. 예를 들어, 다음과 같이 선언하면, <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">In all of these methods, <code>association</code> is replaced with the symbol passed as the first argument to <code>has_one</code>. For example, given the declaration:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account
end

</pre>
</div>
<p><code>Supplier</code> 모델의 각 인스턴스는 다음과 같은 메소드를 가지게 될 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Each instance of the <code>Supplier</code> model will have these methods:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
account
account=
build_account
create_account

</pre>
</div>
<div class="note">
<p> <code>has_one</code> 또는 <code>belongs_to</code> 관계형을 새로 생성해서 초기화할 때는, <code>has_many</code> 또는 <code>has_and_belongs_to_many</code> 관계형에 대해서 사용되는 <code>association.build</code> 메소드보다는, 관계형을 만들 때 선언시 넘겨주는 첫번째 인수에 <code>build_</code> 를 붙여서 사용해야 합니다. 초기화가 아니라 생성할 때는 <code>create_</code> 를 붙여서 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">When initializing a new <code>has_one</code> or <code>belongs_to</code> association you must use the <code>build_</code> prefix to build the association, rather than the <code>association.build</code> method that would be used for <code>has_many</code> or <code>has_and_belongs_to_many</code> associations. To create one, use the <code>create_</code> prefix.</p>
</div><h6 id="has-one에-의해-추가된-메소드-methods-added-by-has-one-원문·전체-association-force-reload-false">4.2.1.1 <code>association(force_reload = false)</code>
</h6><p><code>association</code> 메소드는 연결된 객체가 있을 경우 그것을 반환합니다. 연결된 객체가 없는 경우에는, nil 값을 반환하게 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>association</code> method returns the associated object, if any. If no associated object is found, it returns <code>nil</code>.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@account = @supplier.account

</pre>
</div>
<p>연관된 객체가 이미 이 객체에 대해서 데이터베이스로부터 데이터를 가져온 상태라면 캐시된 버전이 반환될 것입니다. 이 때 강제로 데이터베이스로부터 데이터를 다시 불러오고자 할 경우에는, <code>force_reload</code> 값으로 <code>true</code> 값을 넘겨주어야 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If the associated object has already been retrieved from the database for this object, the cached version will be returned. To override this behavior (and force a database read), pass <code>true</code> as the <code>force_reload</code> argument.</p><h6 id="has-one에-의해-추가된-메소드-methods-added-by-has-one-원문·전체-association-associate">4.2.1.2 <code>association=(associate)</code>
</h6><p><code>association=</code> 메소드는 이 객체에 연관된 객체를 할당합니다. 보이지 않는곳에서 이루어지는 작업을 살펴보면 이객체의 primary key 값과 동일한값을 연관된 객체의 foreign key 에 저장합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>association=</code> method assigns an associated object to this object. Behind the scenes, this means extracting the primary key from this object and setting the associate object's foreign key to the same value.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@supplier.account = @account

</pre>
</div>
<h6 id="has-one에-의해-추가된-메소드-methods-added-by-has-one-원문·전체-build-association-attributes">4.2.1.3 <code>build_association(attributes = {})</code>
</h6><p><code>build_association</code> 메소드는 해당 관계형의 새로운 객체를 반환해 줍니다. 그리고, 이 객체는 매개변수로 넘어온 속성값으로 초기화되며, 연관된 객체에 foreign key 값은 설정될 것이지만, 연관된 객체는 아직 저장되지 않은 상태입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>build_association</code> method returns a new object of the associated type. This object will be instantiated from the passed attributes, and the link through its foreign key will be set, but the associated object will <em>not</em> yet be saved.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@account = @supplier.build_account(terms: "Net 30")

</pre>
</div>
<h6 id="has-one에-의해-추가된-메소드-methods-added-by-has-one-원문·전체-create-association-attributes">4.2.1.4 <code>create_association(attributes = {})</code>
</h6><p><code>create_association</code> 메소드는 해당 관계형의 새로운 객체를 반환해 줍니다. 이 객체는 넘어온 속성으로 초기화되며, 연관된 객체에 foreign key 값이 설정됩니다. 또한, 연관된 객체의 모든 유효성 검증을 통과하면 저장될 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>create_association</code> method returns a new object of the associated type. This object will be instantiated from the passed attributes, the link through its foreign key will be set, and, once it passes all of the validations specified on the associated model, the associated object <em>will</em> be saved.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@account = @supplier.create_account(terms: "Net 30")

</pre>
</div>
<h5 id="has-one-옵션-options-for-has-one-원문·전체">4.2.2 <code>has_one</code> 옵션<span class="original-text-h">(Options for <code>has_one</code>)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p>대부분의 경우 레일스의 기본설정값은 잘 작동하지만, <code>has_one</code>의 동작을 커스터마이징하고 싶을때가 있을것입니다. <code>association</code>을 설정할때 옵션을 추가해서 쉽게 커스터마이제이션 할 수 있습니다. 예를 들어, 몇가지 옵션을 가지는 관계설정은 다음과 같습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">While Rails uses intelligent defaults that will work well in most situations, there may be times when you want to customize the behavior of the <code>has_one</code> association reference. Such customizations can easily be accomplished by passing options when you create the association. For example, this association uses two such options:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account, class_name: "Billing", dependent: :nullify
end

</pre>
</div>
<p><code>has_one</code> 메소드는 다음과 같은 옵션을 사용할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>has_one</code> association supports these options:</p>
<ul>
<li><code>:as</code></li>
<li><code>:autosave</code></li>
<li><code>:class_name</code></li>
<li><code>:dependent</code></li>
<li><code>:foreign_key</code></li>
<li><code>:inverse_of</code></li>
<li><code>:primary_key</code></li>
<li><code>:source</code></li>
<li><code>:source_type</code></li>
<li><code>:through</code></li>
<li><code>:validate</code></li>
</ul>
<h6 id="has-one-옵션-options-for-has-one-원문·전체-as">4.2.2.1 <code>:as</code>
</h6><p>Setting the <code>:as</code> option indicates that this is a polymorphic association. Polymorphic associations were discussed in detail <a href="#polymorphic-associations">earlier in this guide</a>.</p><h6 id="has-one-옵션-options-for-has-one-원문·전체-autosave">4.2.2.2 <code>:autosave</code>
</h6><p>If you set the <code>:autosave</code> option to <code>true</code>, Rails will save any loaded members and destroy members that are marked for destruction whenever you save the parent object.</p><h6 id="has-one-옵션-options-for-has-one-원문·전체-class-name">4.2.2.3 <code>:class_name</code>
</h6><p>If the name of the other model cannot be derived from the association name, you can use the <code>:class_name</code> option to supply the model name. For example, if a supplier has an account, but the actual name of the model containing accounts is <code>Billing</code>, you'd set things up this way:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account, class_name: "Billing"
end

</pre>
</div>
<h6 id="has-one-옵션-options-for-has-one-원문·전체-dependent">4.2.2.4 <code>:dependent</code>
</h6><p>Controls what happens to the associated object when its owner is destroyed:</p>
<ul>
<li>
<code>:destroy</code> causes the associated object to also be destroyed</li>
<li>
<code>:delete</code> causes the associated object to be deleted directly from the database (so callbacks will not execute)</li>
<li>
<code>:nullify</code> causes the foreign key to be set to <code>NULL</code>. Callbacks are not executed.</li>
<li>
<code>:restrict_with_exception</code> causes an exception to be raised if there is an associated record</li>
<li>
<code>:restrict_with_error</code> causes an error to be added to the owner if there is an associated object</li>
</ul>
<h6 id="has-one-옵션-options-for-has-one-원문·전체-foreign-key">4.2.2.5 <code>:foreign_key</code>
</h6><p>By convention, Rails assumes that the column used to hold the foreign key on the other model is the name of this model with the suffix <code>_id</code> added. The <code>:foreign_key</code> option lets you set the name of the foreign key directly:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account, foreign_key: "supp_id"
end

</pre>
</div>
<div class="info"><p> In any case, Rails will not create foreign key columns for you. You need to explicitly define them as part of your migrations.</p></div><h6 id="has-one-옵션-options-for-has-one-원문·전체-inverse-of">4.2.2.6 <code>:inverse_of</code>
</h6><p>The <code>:inverse_of</code> option specifies the name of the <code>belongs_to</code> association that is the inverse of this association. Does not work in combination with the <code>:through</code> or <code>:as</code> options.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account, inverse_of: :supplier
end

class Account &lt; ActiveRecord::Base
  belongs_to :supplier, inverse_of: :account
end

</pre>
</div>
<h6 id="has-one-옵션-options-for-has-one-원문·전체-primary-key">4.2.2.7 <code>:primary_key</code>
</h6><p>By convention, Rails assumes that the column used to hold the primary key of this model is <code>id</code>. You can override this and explicitly specify the primary key with the <code>:primary_key</code> option.</p><h6 id="has-one-옵션-options-for-has-one-원문·전체-source">4.2.2.8 <code>:source</code>
</h6><p>The <code>:source</code> option specifies the source association name for a <code>has_one :through</code> association.</p><h6 id="has-one-옵션-options-for-has-one-원문·전체-source-type">4.2.2.9 <code>:source_type</code>
</h6><p>The <code>:source_type</code> option specifies the source association type for a <code>has_one :through</code> association that proceeds through a polymorphic association.</p><h6 id="has-one-옵션-options-for-has-one-원문·전체-through">4.2.2.10 <code>:through</code>
</h6><p>The <code>:through</code> option specifies a join model through which to perform the query. <code>has_one :through</code> associations were discussed in detail <a href="#the-has-one-through-association">earlier in this guide</a>.</p><h6 id="has-one-옵션-options-for-has-one-원문·전체-validate">4.2.2.11 <code>:validate</code>
</h6><p>If you set the <code>:validate</code> option to <code>true</code>, then associated objects will be validated whenever you save this object. By default, this is <code>false</code>: associated objects will not be validated when this object is saved.</p><h5 id="scopes-for-has-one">4.2.3 Scopes for <code>has_one</code>
</h5><p>There may be times when you wish to customize the query used by <code>has_one</code>. Such customizations can be achieved via a scope block. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account, -&gt; { where active: true }
end

</pre>
</div>
<p>You can use any of the standard <a href="active_record_querying.html">querying methods</a> inside the scope block. The following ones are discussed below:</p>
<ul>
<li><code>where</code></li>
<li><code>includes</code></li>
<li><code>readonly</code></li>
<li><code>select</code></li>
</ul>
<h6 id="scopes-for-has-one-where">4.2.3.1 <code>where</code>
</h6><p>The <code>where</code> method lets you specify the conditions that the associated object must meet.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account, -&gt; { where "confirmed = 1" }
end

</pre>
</div>
<h6 id="scopes-for-has-one-includes">4.2.3.2 <code>includes</code>
</h6><p>You can use the <code>includes</code> method to specify second-order associations that should be eager-loaded when this association is used. For example, consider these models:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account
end

class Account &lt; ActiveRecord::Base
  belongs_to :supplier
  belongs_to :representative
end

class Representative &lt; ActiveRecord::Base
  has_many :accounts
end

</pre>
</div>
<p>If you frequently retrieve representatives directly from suppliers (<code>@supplier.account.representative</code>), then you can make your code somewhat more efficient by including representatives in the association from suppliers to accounts:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Supplier &lt; ActiveRecord::Base
  has_one :account, -&gt; { includes :representative }
end

class Account &lt; ActiveRecord::Base
  belongs_to :supplier
  belongs_to :representative
end

class Representative &lt; ActiveRecord::Base
  has_many :accounts
end

</pre>
</div>
<h6 id="scopes-for-has-one-readonly">4.2.3.3 <code>readonly</code>
</h6><p>If you use the <code>readonly</code> method, then the associated object will be read-only when retrieved via the association.</p><h6 id="scopes-for-has-one-select">4.2.3.4 <code>select</code>
</h6><p>The <code>select</code> method lets you override the SQL <code>SELECT</code> clause that is used to retrieve data about the associated object. By default, Rails retrieves all columns.</p><h5 id="do-any-associated-objects-exist-questionmark">4.2.4 Do Any Associated Objects Exist?</h5><p>You can see if any associated objects exist by using the <code>association.nil?</code> method:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
if @supplier.account.nil?
  @msg = "No account found for this supplier"
end

</pre>
</div>
<h5 id="when-are-objects-saved-questionmark">4.2.5 When are Objects Saved?</h5><p>When you assign an object to a <code>has_one</code> association, that object is automatically saved (in order to update its foreign key). In addition, any object being replaced is also automatically saved, because its foreign key will change too.</p><p>If either of these saves fails due to validation errors, then the assignment statement returns <code>false</code> and the assignment itself is cancelled.</p><p>If the parent object (the one declaring the <code>has_one</code> association) is unsaved (that is, <code>new_record?</code> returns <code>true</code>) then the child objects are not saved. They will automatically when the parent object is saved.</p><p>If you want to assign an object to a <code>has_one</code> association without saving the object, use the <code>association.build</code> method.</p><h4 id="has-many-association-reference">4.3 <code>has_many</code> Association Reference</h4><p><code>has_many</code> 관계형은 다른모델과 일대다 연결을 만들어줍니다. 데이터베이스 용어로는, 다른 클래스가 현재 클래스의 인스턴스를 참조하는 foreign key를 가지고 있다고 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>has_many</code> association creates a one-to-many relationship with another model. In database terms, this association says that the other class will have a foreign key that refers to instances of this class.</p><h5 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체">4.3.1 <code>has_many</code>에 의해 추가된 메소드<span class="original-text-h">(Methods Added by <code>has_many</code>)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p><code>has_many</code> 관계선언을 하게 되면, 선언하는 클래스는 자동으로 다음의 13가지 메소드를 사용할 수 있게 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">When you declare a <code>has_many</code> association, the declaring class automatically gains 13 methods related to the association:</p>
<ul>
<li><code>collection(force_reload = false)</code></li>
<li><code>collection&lt;&lt;(object, ...)</code></li>
<li><code>collection.delete(object, ...)</code></li>
<li><code>collection.destroy(object, ...)</code></li>
<li><code>collection=objects</code></li>
<li><code>collection_singular_ids</code></li>
<li><code>collection_singular_ids=ids</code></li>
<li><code>collection.clear</code></li>
<li><code>collection.empty?</code></li>
<li><code>collection.size</code></li>
<li><code>collection.find(...)</code></li>
<li><code>collection.where(...)</code></li>
<li><code>collection.exists?(...)</code></li>
<li><code>collection.build(attributes = {}, ...)</code></li>
<li><code>collection.create(attributes = {})</code></li>
</ul>
<p> 위의 모든 메소드에서 <code>collection</code>는 <code>has_many</code> 의 첫번째 인수로 받은 심볼로 바꾸고, <code>collection_singular</code>는 첫번째 인수의 단수버전의 심볼로 변경하면됩니다. 예를 들어, 다음과 같이 선언하면 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">In all of these methods, <code>collection</code> is replaced with the symbol passed as the first argument to <code>has_many</code>, and <code>collection_singular</code> is replaced with the singularized version of that symbol. For example, given the declaration:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders
end

</pre>
</div>
<p>customer 모델의 각 인스턴스는 다음과 같은 메소드를 가지게 될 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Each instance of the customer model will have these methods:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
orders(force_reload = false)
orders&lt;&lt;(object, ...)
orders.delete(object, ...)
orders.destroy(object, ...)
orders=objects
order_ids
order_ids=ids
orders.clear
orders.empty?
orders.size
orders.find(...)
orders.where(...)
orders.exists?(...)
orders.build(attributes = {}, ...)
orders.create(attributes = {})

</pre>
</div>
<h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-force-reload-false">4.3.1.1 <code>collection(force_reload = false)</code>
</h6><p><code>collection</code> 메소드는 연결된 모든객체의 배열을 반환합니다. 연결된 객체가 없는 경우에는 비어있는 배열을 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection</code> method returns an array of all of the associated objects. If there are no associated objects, it returns an empty array.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@orders = @customer.orders

</pre>
</div>
<h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-object">4.3.1.2 <code>collection&lt;&lt;(object, ...)</code>
</h6><p><code>collection&lt;&lt;</code> 메소드는 호출하는 모델의 primary key를 대상 객체의 foreign key값으로 할당하여 하나 또는 그 이상의 객체를 추가합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection&lt;&lt;</code> method adds one or more objects to the collection by setting their foreign keys to the primary key of the calling model.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@customer.orders &lt;&lt; @order1

</pre>
</div>
<h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-delete-object">4.3.1.3 <code>collection.delete(object, ...)</code>
</h6><p><code>collection.delete</code> 메소드는 대상 객체의 foreign key값을 NULL 값으로 할당해서 collection으로부터 하나 또는 그 이상의 객체를 제거합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.delete</code> method removes one or more objects from the collection by setting their foreign keys to <code>NULL</code>.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@customer.orders.delete(@order1)

</pre>
</div>
<div class="warning">
<p> 추가적으로 객체들이 <code>dependent: :destroy</code> 옵션으로 연결된다면 destroy 되며, <code>dependent: :delete_all</code> 옵션으로 연결된다면 delete 될 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">Additionally, objects will be destroyed if they're associated with <code>dependent: :destroy</code>, and deleted if they're associated with <code>dependent: :delete_all</code>.</p>
</div><h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-destroy-object">4.3.1.4 <code>collection.destroy(object, ...)</code>
</h6><p><code>collection.destroy</code> 메소드는 collection으로부터 하나 또는 그 이상의 객체를 제거하는데 이때 각 객체에 <code>destroy</code> 메소드를 실행합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.destroy</code> method removes one or more objects from the collection by running <code>destroy</code> on each object.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@customer.orders.destroy(@order1)

</pre>
</div>
<div class="warning">
<p> 객체는 <code>:dependent</code> 옵션과 상관없이 <em>항상</em> 데이터베이스에서 삭제됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">Objects will <em>always</em> be removed from the database, ignoring the <code>:dependent</code> option.</p>
</div><h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-objects">4.3.1.5 <code>collection=objects</code>
</h6><p><code>collection=</code> 메소드는 적절하게 추가/삭제 해서 지정된 객체들만 남게 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection=</code> method makes the collection contain only the supplied objects, by adding and deleting as appropriate.</p><h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-singular-ids">4.3.1.6 <code>collection_singular_ids</code>
</h6><p><code>collection_singular_ids</code> 메소드는 collection객체들의 id 배열을 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection_singular_ids</code> method returns an array of the ids of the objects in the collection.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@order_ids = @customer.order_ids

</pre>
</div>
<h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-singular-ids-ids">4.3.1.7 <code>collection_singular_ids=ids</code>
</h6><p><code>collection_singular_ids=ids</code> 메소드는 적절하게 추가/삭제해서 주어진 primary key 값을 가진 객체들만 남게 합니다. [[[The <code>collection_singular_ids=</code> method makes the collection contain only the objects identified by the supplied primary key values, by adding and deleting as appropriate.
]]]</p><h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-clear">4.3.1.8 <code>collection.clear</code>
</h6><p><code>collection.clear</code> 메소드는 collection의 모든 객체를 제거합니다. 여기서 제거는 <code>dependent: :destroy</code> 옵션으로 연결된 경우 각객체의 destroy를 실행하고, <code>dependent: :delete_all</code> 옵션으로 연결된 경우 데이터베이스에 직접 foreign key를 <code>NULL</code>로 할당합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.clear</code> method removes every object from the collection. This destroys the associated objects if they are associated with <code>dependent: :destroy</code>, deletes them directly from the database if <code>dependent: :delete_all</code>, and otherwise sets their foreign keys to <code>NULL</code>.</p><h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-empty-questionmark">4.3.1.9 <code>collection.empty?</code>
</h6><p><code>collection.empty?</code> 메소드는 collection에 연결된 객체가 없는경우 <code>true</code>를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.empty?</code> method returns <code>true</code> if the collection does not contain any associated objects.</p><div class="code_container">
<pre class="brush: ruby; html-script: true; gutter: false; toolbar: false">
&lt;% if @customer.orders.empty? %&gt;
  No Orders Found
&lt;% end %&gt;

</pre>
</div>
<h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-size">4.3.1.10 <code>collection.size</code>
</h6><p><code>collection.size</code> 메소드는 collection의 객체 갯수를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.size</code> method returns the number of objects in the collection.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@order_count = @customer.orders.size

</pre>
</div>
<h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-find">4.3.1.11 <code>collection.find(...)</code>
</h6><p><code>collection.find</code> 메소드는 collection에서 객체들을 찾습니다. <code>ActiveRecord::Base.find</code> 에서 사용하는것과 동일한 문법과 옵션을 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.find</code> method finds objects within the collection. It uses the same syntax and options as <code>ActiveRecord::Base.find</code>.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@open_orders = @customer.orders.find(1)

</pre>
</div>
<h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-where">4.3.1.12 <code>collection.where(...)</code>
</h6><p><code>collection.where</code> 메소드는 collection 객체들 중에서 제공된 조건에 맞는 것들만 찾아주지만 해당 객체에 대한 로드는 필요할 때 발생한다는 것입니다. 이것은 해당 객체들을 접근할 때만 데이터베이스 쿼리가 발생한다는 것을 의미합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.where</code> method finds objects within the collection based on the conditions supplied but the objects are loaded lazily meaning that the database is queried only when the object(s) are accessed.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@open_orders = @customer.orders.where(open: true) # 아직 쿼리가 실행되지 않음 [[[No query yet]]]
@open_order = @open_orders.first # 이제 데이터베이스에 쿼리가 실행됨 [[[Now the database will be queried]]]

</pre>
</div>
<h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-exists-questionmark">4.3.1.13 <code>collection.exists?(...)</code>
</h6><p><code>collection.exists?</code> 메소드는 제공되는 조건을 만족하는 객체가 컬렉션내에 존재하는지를 점검합니다. 이 때 <code>ActiveRecord::Base.exist?</code> 와 같은 문법과 옵션을 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.exists?</code> method checks whether an object meeting the supplied conditions exists in the collection. It uses the same syntax and options as <code>ActiveRecord::Base.exists?</code>.</p><h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-build-attributes">4.3.1.14 <code>collection.build(attributes = {}, ...)</code>
</h6><p><code>collection.build</code> 메소드는 연결된 모델의 하나 또는 그 이상의 새로운 객체를 반환합니다. 반환된 객체는 넘겨온 속성들로 구성되며 이들의 foreign key 값이 호출한 객체의 primary key 값으로 설정됩니다. 그러나 반환된 객체는 아직 저장이 되지 <em>않은</em> 상태입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.build</code> method returns one or more new objects of the associated type. These objects will be instantiated from the passed attributes, and the link through their foreign key will be created, but the associated objects will <em>not</em> yet be saved.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@order = @customer.orders.build(order_date: Time.now,
                                order_number: "A12345")

</pre>
</div>
<h6 id="has-many에-의해-추가된-메소드-methods-added-by-has-many-원문·전체-collection-create-attributes">4.3.1.15 <code>collection.create(attributes = {})</code>
</h6><p><code>collection.create</code> 메소드는 연결된 모델의 하나 또는 그 이상의 새로운 객체를 반환합니다. 반환된 객체는 넘겨온 속성들로 구성되며 이들의 foreign key 값이 호출한 객체의 primary key 값으로 설정됩니다. 검증을 모두 통과한다면 반환된 객체는 저장될것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.create</code> method returns a new object of the associated type. This object will be instantiated from the passed attributes, the link through its foreign key will be created, and, once it passes all of the validations specified on the associated model, the associated object <em>will</em> be saved.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@order = @customer.orders.create(order_date: Time.now,
                                 order_number: "A12345")

</pre>
</div>
<h5 id="has-many-옵션-options-for-has-many-원문·전체">4.3.2 <code>has_many</code> 옵션<span class="original-text-h">(Options for <code>has_many</code>)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p>대부분의 경우 레일스의 기본설정값은 잘 작동하지만, <code>has_many</code>의 동작을 커스터마이징하고 싶을때가 있을것입니다. 관계를 설정할때 옵션을 추가해서 쉽게 커스터마이제이션 할 수 있습니다. 예를 들어, 몇가지 옵션을 가지는 관계설정은 다음과 같습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">While Rails uses intelligent defaults that will work well in most situations, there may be times when you want to customize the behavior of the <code>has_many</code> association reference. Such customizations can easily be accomplished by passing options when you create the association. For example, this association uses two such options:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, dependent: :delete_all, validate: :false
end

</pre>
</div>
<p><code>has_many</code> 관계는 다음과 같은 옵션을 사용할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>has_many</code> association supports these options:</p>
<ul>
<li><code>:as</code></li>
<li><code>:autosave</code></li>
<li><code>:class_name</code></li>
<li><code>:dependent</code></li>
<li><code>:foreign_key</code></li>
<li><code>:inverse_of</code></li>
<li><code>:primary_key</code></li>
<li><code>:source</code></li>
<li><code>:source_type</code></li>
<li><code>:through</code></li>
<li><code>:validate</code></li>
</ul>
<h6 id="has-many-옵션-options-for-has-many-원문·전체-as">4.3.2.1 <code>:as</code>
</h6><p><code>:as</code> 옵션은 polymorphic 관계형을 가진다는 것을 의미합니다. 이것에 대해서는 <a href="#polymorphic-associations">본 가이드의 앞부분</a>을 참조하기 바랍니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Setting the <code>:as</code> option indicates that this is a polymorphic association, as discussed <a href="#polymorphic-associations">earlier in this guide</a>.</p><h6 id="has-many-옵션-options-for-has-many-원문·전체-autosave">4.3.2.2 <code>:autosave</code>
</h6><p><code>:autosave</code> 옵션을 <code>true</code> 값으로 설정하면, 레일스는 모객체가 저장될 때마다 모든 로딩된 멤버를 저장하고 삭제표시된 멤버를 삭제할 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you set the <code>:autosave</code> option to <code>true</code>, Rails will save any loaded members and destroy members that are marked for destruction whenever you save the parent object.</p><h6 id="has-many-옵션-options-for-has-many-원문·전체-class-name">4.3.2.3 <code>:class_name</code>
</h6><p>다른 모델의 이름을 관계선언이름으로부터 알 수 없을 경우에는 <code>:class_name</code> 옵션을 이용해서 모델명을 명시할 수 있습니다. 예를 들면, customser 모델은 여러개의 orders를 가지는데 orders 객체들의 실제 모델이름은 <code>Transaction</code>인경우 다음과 같이 설정합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If the name of the other model cannot be derived from the association name, you can use the <code>:class_name</code> option to supply the model name. For example, if a customer has many orders, but the actual name of the model containing orders is <code>Transaction</code>, you'd set things up this way:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, class_name: "Transaction"
end

</pre>
</div>
<h6 id="dependent">4.3.2.4 <code>:dependent</code>
</h6><p>모객체가 삭제될때 연결된 객체들에 발생하는 현상을 제어할수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Controls what happens to the associated objects when their owner is destroyed:</p>
<ul>
<li>
<p><code>:destroy</code> 옵션은 연결된 객체들도 destory 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text"><code>:destroy</code> causes all the associated objects to also be destroyed</p>
</li>
<li>
<p><code>:delete_all</code> 옵션은 연결된 객체들을 데이터베이스에서 직접 삭제합니다.(따라서 연결된 객체의 어떠한 콜백도 실행되지 않습니다.) <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text"><code>:delete_all</code> causes all the associated objects to be deleted directly from the database (so callbacks will not execute)</p>
</li>
<li>
<p><code>:nullify</code> 옵션은 연결된 객체의 foreign keys를 <code>NULL</code>로 설정합니다. 콜백은 실행되지 않습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text"><code>:nullify</code> causes the foreign keys to be set to <code>NULL</code>. Callbacks are not executed.</p>
</li>
<li>
<p><code>:restrict_with_exception</code> 옵션은 연결된 객체가 있는경우 오류가 발생합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text"><code>:restrict_with_exception</code> causes an exception to be raised if there are any associated records</p>
</li>
<li>
<p><code>:restrict_with_error</code> 옵션은 연결된 객체가 있는경우 모객체에 에러를 추가합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text"><code>:restrict_with_error</code> causes an error to be added to the owner if there are any associated objects</p>
</li>
</ul>
<div class="note">
<p> <code>:through</code> 옵션이 설정되어 있는경우 이 옵션은 무시됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">This option is ignored when you use the <code>:through</code> option on the association.</p>
</div><h6 id="has-many-옵션-options-for-has-many-원문·전체-foreign-key">4.3.2.5 <code>:foreign_key</code>
</h6><p>관례에 의해, 레일스는 foreign key 컬럼명을 연관된 모델명에 <code>_id</code> 를 추가한 이름으로 간주합니다. 이 때 <code>:foreign_key</code> 옵션을 이용하여 직접 foreign key 이름을 설정할 수 있게 해 줍니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">By convention, Rails assumes that the column used to hold the foreign key on the other model is the name of this model with the suffix <code>_id</code> added. The <code>:foreign_key</code> option lets you set the name of the foreign key directly:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, foreign_key: "cust_id"
end

</pre>
</div>
<div class="info">
<p> 어떠한 경우에라도, 레일스가 개발자를 대신해서 foreign key 컬럼을 만들어 주지 않습니다. 마이그레이션 파일에 명시적으로 정의해 주어야 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">In any case, Rails will not create foreign key columns for you. You need to explicitly define them as part of your migrations.</p>
</div><h6 id="inverse-of">4.3.2.6 <code>:inverse_of</code>
</h6><p><code>:inverse_of</code> 옵션에 전달하는 이름은 <code>belongs_to</code> 연관관계 설정시 전달한 이름을 사용한다. <code>:through</code> 또는 <code>:as</code> 옵션을 사용할경우에는 동작하지 않는다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>:inverse_of</code> option specifies the name of the <code>belongs_to</code> association that is the inverse of this association. Does not work in combination with the <code>:through</code> or <code>:as</code> options.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, inverse_of: :customer
end

class Order &lt; ActiveRecord::Base
  belongs_to :customer, inverse_of: :orders
end

</pre>
</div>
<h6 id="has-many-옵션-options-for-has-many-원문·전체-primary-key">4.3.2.7 <code>:primary_key</code>
</h6><p>관례에 의해, 레일스는 primary key 컬럼명을 <code>id</code>로 간주합니다. 이 때 <code>:primary_key</code> 옵션을 이용하여 직접 primary key 이름을 설정할 수 있게 해 줍니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">By convention, Rails assumes that the column used to hold the primary key of the association is <code>id</code>. You can override this and explicitly specify the primary key with the <code>:primary_key</code> option.</p><h6 id="has-many-옵션-options-for-has-many-원문·전체-source">4.3.2.8 <code>:source</code>
</h6><p><code>:source</code> 옵션은 <code>has_many :through</code> 관계선언시 source 명을 명시할수 있게 합니다. 관계명으로부터 소스명을 유추할수 없을때만 이옵션을 사용해야합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>:source</code> option specifies the source association name for a <code>has_many :through</code> association. You only need to use this option if the name of the source association cannot be automatically inferred from the association name.</p><h6 id="has-many-옵션-options-for-has-many-원문·전체-source-type">4.3.2.9 <code>:source_type</code>
</h6><p><code>:source_type</code> 옵션은 <code>has_many :through</code>을 이용한 polymorphic 관계선언시 source 종류를 명시할수 있게 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>:source_type</code> option specifies the source association type for a <code>has_many :through</code> association that proceeds through a polymorphic association.</p><h6 id="has-many-옵션-options-for-has-many-원문·전체-through">4.3.2.10 <code>:through</code>
</h6><p><code>:through</code> 옵션은 쿼리를 실행할때 사용할 조인모델을 명시합니다. <code>has_many :through</code> 관계는 다대다연결 방법을 제공하며 <a href="#the-has-many-through-association">본 가이드의 앞부분에</a> 언급되었습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>:through</code> option specifies a join model through which to perform the query. <code>has_many :through</code> associations provide a way to implement many-to-many relationships, as discussed <a href="#the-has-many-through-association">earlier in this guide</a>.</p><h6 id="has-many-옵션-options-for-has-many-원문·전체-validate">4.3.2.11 <code>:validate</code>
</h6><p><code>:validate</code> 옵션을 <code>false</code>로 설정하면, 이 객체를 저장할때 연관된 객체의 검증이 수행되지 않습니다. 기본값은 <code>true</code>이며 이 객체가 저장될때 검증이 수행됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you set the <code>:validate</code> option to <code>false</code>, then associated objects will not be validated whenever you save this object. By default, this is <code>true</code>: associated objects will be validated when this object is saved.</p><h5 id="scopes-for-has-many">4.3.3 Scopes for <code>has_many</code>
</h5><p>쿼리를 이용해 <code>has_many</code>를 커스터마이즈할때 scope block을 자주 사용합니다. 예를 들면 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">There may be times when you wish to customize the query used by <code>has_many</code>. Such customizations can be achieved via a scope block. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, -&gt; { where processed: true }
end

</pre>
</div>
<p><a href="active_record_querying.html">querying methods</a> 를 scope block 내부에 사용할수 있습니다. 다음과 같은것들은 아래에 설명되어 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can use any of the standard <a href="active_record_querying.html">querying methods</a> inside the scope block. The following ones are discussed below:</p>
<ul>
<li><code>where</code></li>
<li><code>extending</code></li>
<li><code>group</code></li>
<li><code>includes</code></li>
<li><code>limit</code></li>
<li><code>offset</code></li>
<li><code>order</code></li>
<li><code>readonly</code></li>
<li><code>select</code></li>
<li><code>uniq</code></li>
</ul>
<h6 id="scopes-for-has-many-where">4.3.3.1 <code>where</code>
</h6><p><code>where</code> 메서드는 지정된 조건에 해당할때만 객체와 연관되도록 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>where</code> method lets you specify the conditions that the associated object must meet.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :confirmed_orders, -&gt; { where "confirmed = 1" },
    class_name: "Order"
end

</pre>
</div>
<p>hash로 조건을 지정할수도 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can also set conditions via a hash:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :confirmed_orders, -&gt; { where confirmed: true },
                              class_name: "Order"
end

</pre>
</div>
<p>hash-style로 <code>where</code> 옵션을 사용할때, 이 관계로 객체를 생성하는 함수들은 scope에 사용된 해쉬를 사용합니다. 위의 예시에서 <code>@customer.confirmed_orders.create</code> 또는 <code>@customer.confirmed_orders.build</code>는 confirmed 컬럼의 값은 <code>true</code>로 설정된 객체가 생성됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you use a hash-style <code>where</code> option, then record creation via this association will be automatically scoped using the hash. In this case, using <code>@customer.confirmed_orders.create</code> or <code>@customer.confirmed_orders.build</code> will create orders where the confirmed column has the value <code>true</code>.</p><h6 id="scopes-for-has-many-extending">4.3.3.2 <code>extending</code>
</h6><p><code>extending</code> 메서드는 지정된 모듈이름으로 관계를 확장한다. 관계확장에 대한 자세한 내용은 <a href="#association-extensions">본 가이드의 뒷부분에</a> 설명되어 있다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>extending</code> method specifies a named module to extend the association proxy. Association extensions are discussed in detail <a href="#association-extensions">later in this guide</a>.</p><h6 id="scopes-for-has-many-group">4.3.3.3 <code>group</code>
</h6><p><code>group</code> 메서드에 전달된 속성이름으로 SQL에서 <code>GROUP BY</code> 구문을 사용해 결과를 그룹화한다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>group</code> method supplies an attribute name to group the result set by, using a <code>GROUP BY</code> clause in the finder SQL.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :line_items, -&gt; { group 'orders.id' },
                        through: :orders
end

</pre>
</div>
<h6 id="scopes-for-has-many-includes">4.3.3.4 <code>includes</code>
</h6><p>두번째 관계의 객체의 대해 eager-loaded를 사용하고자 할때 <code>includes</code> 메서드를 사용합니다. 예를들어 다음과 같은 모델들이 있다고 가정하고 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can use the <code>includes</code> method to specify second-order associations that should be eager-loaded when this association is used. For example, consider these models:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders
end

class Order &lt; ActiveRecord::Base
  belongs_to :customer
  has_many :line_items
end

class LineItem &lt; ActiveRecord::Base
  belongs_to :order
end

</pre>
</div>
<p>customer 모델로부터 lime items를 자주 탐색(<code>@customer.orders.line_items</code>) 한다면, 코드를 좀더 효율적으로 하기 위해 customer의 orders 관계설정에 line items를 포함하도록 할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you frequently retrieve line items directly from customers (<code>@customer.orders.line_items</code>), then you can make your code somewhat more efficient by including line items in the association from customers to orders:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, -&gt; { includes :line_items }
end

class Order &lt; ActiveRecord::Base
  belongs_to :customer
  has_many :line_items
end

class LineItem &lt; ActiveRecord::Base
  belongs_to :order
end

</pre>
</div>
<h6 id="scopes-for-has-many-limit">4.3.3.5 <code>limit</code>
</h6><p><code>limit</code> 메서드는 관계를통해 조회되는 객체의 총 갯수를 제한합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>limit</code> method lets you restrict the total number of objects that will be fetched through an association.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :recent_orders,
    -&gt; { order('order_date desc').limit(100) },
    class_name: "Order",
end

</pre>
</div>
<h6 id="scopes-for-has-many-offset">4.3.3.6 <code>offset</code>
</h6><p>:offset 메서드는 관계를 통해 객체를 조회할때 시작지점을 명시할 수 있습니다. 예를 들어, <code>-&gt; { offset(11) }</code> 이라고 설정하면 처음 11개의 객체는 건너띕니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>offset</code> method lets you specify the starting offset for fetching objects via an association. For example, <code>-&gt; { offset(11) }</code> will skip the first 11 records.</p><h6 id="scopes-for-has-many-order">4.3.3.7 <code>order</code>
</h6><p><code>order</code> 메서드는 연관 객체를 조회할때 (SQL <code>ORDER BY</code> 구문에서 사용하는 것 처럼) 순서를 지정할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>order</code> method dictates the order in which associated objects will be received (in the syntax used by an SQL <code>ORDER BY</code> clause).</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, -&gt; { order "date_confirmed DESC" }
end

</pre>
</div>
<h6 id="scopes-for-has-many-readonly">4.3.3.8 <code>readonly</code>
</h6><p><code>readonly</code> 메서드는 연관된 객체를 관계메서드를 통해서 조회할때 읽기전용으로 동작하게 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you use the <code>readonly</code> method, then the associated objects will be read-only when retrieved via the association.</p><h6 id="scopes-for-has-many-select">4.3.3.9 <code>select</code>
</h6><p><code>select</code> 메서드는 연관 객체를 조회할때 이용되는 SQL <code>SELECT</code> 구문을 재정의 합니다. 레일스는 기본설정으로 모든 컬럼을 불러옵니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>select</code> method lets you override the SQL <code>SELECT</code> clause that is used to retrieve data about the associated objects. By default, Rails retrieves all columns.</p><div class="warning">
<p> <code>select</code> 메서드를 사용할때 연관 모델의 primary key와 foreign key 컬럼을 반드시 포함시켜야 합니다. 그렇지 않으면 레일스는 에러를 발생시킵니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">If you specify your own <code>select</code>, be sure to include the primary key and foreign key columns of the associated model. If you do not, Rails will throw an error.</p>
</div><h6 id="distinct">4.3.3.10 <code>distinct</code>
</h6><p><code>distinct</code> 메서드는 collection의 중복을 제거합니다. <code>:through</code> 옵션과 함께 사용하면 유용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Use the <code>distinct</code> method to keep the collection free of duplicates. This is mostly useful together with the <code>:through</code> option.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Person &lt; ActiveRecord::Base
  has_many :readings
  has_many :posts, through: :readings
end

person = Person.create(name: 'John')
post   = Post.create(name: 'a1')
person.posts &lt;&lt; post
person.posts &lt;&lt; post
person.posts.inspect # =&gt; [#&lt;Post id: 5, name: "a1"&gt;, #&lt;Post id: 5, name: "a1"&gt;]
Reading.all.inspect  # =&gt; [#&lt;Reading id: 12, person_id: 5, post_id: 5&gt;, #&lt;Reading id: 13, person_id: 5, post_id: 5&gt;]

</pre>
</div>
<p>위의 예제에서 <code>person.posts</code>는 한개의 post를 참조하는 2개의 readings를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">In the above case there are two readings and <code>person.posts</code> brings out both of them even though these records are pointing to the same post.</p><p>이제 <code>distinct</code>를 사용해보겠습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Now let's set <code>distinct</code>:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Person
  has_many :readings
  has_many :posts, -&gt; { distinct }, through: :readings
end

person = Person.create(name: 'Honda')
post   = Post.create(name: 'a1')
person.posts &lt;&lt; post
person.posts &lt;&lt; post
person.posts.inspect # =&gt; [#&lt;Post id: 7, name: "a1"&gt;]
Reading.all.inspect  # =&gt; [#&lt;Reading id: 16, person_id: 7, post_id: 7&gt;, #&lt;Reading id: 17, person_id: 7, post_id: 7&gt;]

</pre>
</div>
<p>위의 예제에서 여전히 2개의 readings를 반환하지만 <code>person.posts</code>는 한개의 post만을 반환하는데 이는 collection이 유일한 한개의 값만을 조회하기 대문입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">In the above case there are still two readings. However <code>person.posts</code> shows only one post because the collection loads only unique records.</p><p>위의 예제에서 추가할때 유일한 데이터만이 저장되게 하려면(이렇게 하면 중복되는 데이터가 조회되는 일은 발생하지 않습니다.), 테이블에 unique 인덱스를 추가합니다. 예를들어 <code>person_posts</code> 테이블이 있을경우 모든 post들을 유일하게 하고자 할때 다음과 같은 마이그레이션을 추가해야합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you want to make sure that, upon insertion, all of the records in the persisted association are distinct (so that you can be sure that when you inspect the association that you will never find duplicate records), you should add a unique index on the table itself. For example, if you have a table named <code>person_posts</code> and you want to make sure all the posts are unique, you could add the following in a migration:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
add_index :person_posts, :post, :unique =&gt; true

</pre>
</div>
<p>유일값을 검증하기 위해 <code>include?</code>를 사용하면 경쟁조건(race conditions)의 대상이 됩니다. 유일값을 검증하는데 <code>include?</code>를 사용해서는 안됩니다. 위의 post 예제에서 아래와 같은코드는 여러유저가 동시에 접근하려 하는경우 문제가 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Note that checking for uniqueness using something like <code>include?</code> is subject to race conditions. Do not attempt to use <code>include?</code> to enforce distinctness in an association. For instance, using the post example from above, the following code would be racy because multiple users could be attempting this at the same time:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
person.posts &lt;&lt; post unless person.posts.include?(post)

</pre>
</div>
<h5 id="has-many-association-reference-객체는-언제-저장되는가-questionmark-when-are-objects-saved-questionmark-원문·전체">4.3.4 객체는 언제 저장되는가?<span class="original-text-h">(When are Objects Saved?)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p>객체를 <code>has_many</code> 관계로 할당할때, 해당 객체는 자동으로 저장됩니다.(foreign key를 변경하기 위해서) 여러개의 객체를 하나의 구문으로 할당할때도 모든 객체는 저장됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">When you assign an object to a <code>has_many</code> association, that object is automatically saved (in order to update its foreign key). If you assign multiple objects in one statement, then they are all saved.</p><p>검증실행중에 에러로인해 저장이 실패하는경우, 할당 구문은 <code>false</code>를 반환하고 해당 할당은 취소됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If any of these saves fails due to validation errors, then the assignment statement returns <code>false</code> and the assignment itself is cancelled.</p><p>모객체(<code>has_many</code> 관계를 선언한)가 저장되지 않은상태(<code>new_record?</code>가 <code>true</code> 반환)일때 자식객체들은 모객체에 추가될때 저장되지 않은상태입니다. 모든 저장되지 않은 연관객체들은 모객체가 저장될때 자동으로 저장됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If the parent object (the one declaring the <code>has_many</code> association) is unsaved (that is, <code>new_record?</code> returns <code>true</code>) then the child objects are not saved when they are added. All unsaved members of the association will automatically be saved when the parent is saved.</p><p><code>has_many</code> 관계에서 객체를 할당할때 저장하지 않고 싶으면 <code>collection.build</code> 메서드를 사용하면됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you want to assign an object to a <code>has_many</code> association without saving the object, use the <code>collection.build</code> method.</p><h4 id="has-and-belongs-to-many-association-reference">4.4 <code>has_and_belongs_to_many</code> Association Reference</h4><p><code>has_and_belongs_to_many</code> 관계형은 다른모델과 다대다 연결을 만들어줍니다. 데이터베이스 용어로는, 이것은 클래스가 서로 참조하기 위해 foreign key들을 포함하는 중간 조인 테이블을 경유해서 두개의 클래스를 연결하게 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>has_and_belongs_to_many</code> association creates a many-to-many relationship with another model. In database terms, this associates two classes via an intermediate join table that includes foreign keys referring to each of the classes.</p><h5 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체">4.4.1 <code>has_and_belongs_to_many</code>에 의해 추가된 메소드<span class="original-text-h">(Methods Added by <code>has_and_belongs_to_many</code>)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p><code>has_and_belongs_to_many</code> 관계선언을 하게 되면, 선언하는 클래스는 자동으로 다음의 13가지 메소드를 사용할 수 있게 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">When you declare a <code>has_and_belongs_to_many</code> association, the declaring class automatically gains 13 methods related to the association:</p>
<ul>
<li><code>collection(force_reload = false)</code></li>
<li><code>collection&lt;&lt;(object, ...)</code></li>
<li><code>collection.delete(object, ...)</code></li>
<li><code>collection.destroy(object, ...)</code></li>
<li><code>collection=objects</code></li>
<li><code>collection_singular_ids</code></li>
<li><code>collection_singular_ids=ids</code></li>
<li><code>collection.clear</code></li>
<li><code>collection.empty?</code></li>
<li><code>collection.size</code></li>
<li><code>collection.find(...)</code></li>
<li><code>collection.where(...)</code></li>
<li><code>collection.exists?(...)</code></li>
<li><code>collection.build(attributes = {})</code></li>
<li><code>collection.create(attributes = {})</code></li>
</ul>
<p>위의 모든 메소드에서 <code>collection</code>는 <code>has_and_belongs_to_many</code> 의 첫번째 인수로 받은 심볼로 바꾸고, <code>collection_singular</code>는 첫번째 인수의 단수버전의 심볼로 변경하면됩니다. 예를 들어, 다음과 같이 선언하면 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">In all of these methods, <code>collection</code> is replaced with the symbol passed as the first argument to <code>has_and_belongs_to_many</code>, and <code>collection_singular</code> is replaced with the singularized version of that symbol. For example, given the declaration:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Part &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies
end

</pre>
</div>
<p>part 모델의 각 인스턴스는 다음과 같은 메소드를 가지게 될 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Each instance of the part model will have these methods:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
assemblies(force_reload = false)
assemblies&lt;&lt;(object, ...)
assemblies.delete(object, ...)
assemblies.destroy(object, ...)
assemblies=objects
assembly_ids
assembly_ids=ids
assemblies.clear
assemblies.empty?
assemblies.size
assemblies.find(...)
assemblies.where(...)
assemblies.exists?(...)
assemblies.build(attributes = {}, ...)
assemblies.create(attributes = {})

</pre>
</div>
<h6 id="추가적인-컬럼-메소드-additional-column-methods-원문·전체">4.4.1.1 추가적인 컬럼 메소드<span class="original-text-h">(Additional Column Methods)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h6><p><code>has_and_belongs_to_many</code> 관계에서 두개의 foreign keys이외에 다른 컬럼을 가지게 되는경우, 관계를 통해서 레코드를 조회할때 이 컬럼은 속성으로 추가될것입니다. 그러나 레코드가 반환하는 추가적인 속성값은 항상 읽기전용이 될것입니다. 이는 레일스에서 추가 속성의 값을 저장할수 없기때문입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If the join table for a <code>has_and_belongs_to_many</code> association has additional columns beyond the two foreign keys, these columns will be added as attributes to records retrieved via that association. Records returned with additional attributes will always be read-only, because Rails cannot save changes to those attributes.</p><div class="warning">
<p> <code>has_and_belongs_to_many</code> 관계에서 조인테이블의 추가 속성에 대한 기능은 없어질 예정입니다. 두 모델간의 다대다 관계설정에서 이와같이 복잡한 기능을 사용할때는 <code>has_and_belongs_to_many</code> 대신 <code>has_many :trough</code> 를 사용해야합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">The use of extra attributes on the join table in a <code>has_and_belongs_to_many</code> association is deprecated. If you require this sort of complex behavior on the table that joins two models in a many-to-many relationship, you should use a <code>has_many :through</code> association instead of <code>has_and_belongs_to_many</code>.</p>
</div><h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-force-reload-false">4.4.1.2 <code>collection(force_reload = false)</code>
</h6><p> <code>collection</code> 메소드는 연결된 모든객체의 배열을 반환합니다. 연결된 객체가 없는 경우에는 비어있는 배열을 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection</code> method returns an array of all of the associated objects. If there are no associated objects, it returns an empty array.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@assemblies = @part.assemblies

</pre>
</div>
<h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-object">4.4.1.3 <code>collection&lt;&lt;(object, ...)</code>
</h6><p><code>collection&lt;&lt;</code> 메소드는 조인테이블에 레코드를 생성하여 하나 또는 그 이상의 객체를 추가합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection&lt;&lt;</code> method adds one or more objects to the collection by creating records in the join table.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@part.assemblies &lt;&lt; @assembly1

</pre>
</div>
<div class="note">
<p> 이 메소드는 <code>collection.concat</code>, <code>collection.push</code>라는 이름으로도 사용할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">This method is aliased as <code>collection.concat</code> and <code>collection.push</code>.</p>
</div><h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-delete-object">4.4.1.4 <code>collection.delete(object, ...)</code>
</h6><p><code>collection.delete</code> 메소드는 조인테이블에서 레코드를 삭제하여 collection으로부터 하나 또는 그 이상의 객체를 제거합니다. 객체를 destroy 하지 않습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.delete</code> method removes one or more objects from the collection by deleting records in the join table. This does not destroy the objects.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@part.assemblies.delete(@assembly1)

</pre>
</div>
<div class="warning">
<p> 이는 조인 레코드의 콜백을 실행시키지 않습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">This does not trigger callbacks on the join records.</p>
</div><h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-destroy-object">4.4.1.5 <code>collection.destroy(object, ...)</code>
</h6><p><code>collection.destroy</code> 메소드는 조인테이블의 각 레코드에 <code>destroy</code> 메소드를 실행하여 collection으로부터 하나 또는 그 이상의 객체를 제거하며 콜백도 실행됩니다. 객체를 destroy 하지 않습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.destroy</code> method removes one or more objects from the collection by running <code>destroy</code> on each record in the join table, including running callbacks. This does not destroy the objects.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@part.assemblies.destroy(@assembly1)

</pre>
</div>
<h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-objects">4.4.1.6 <code>collection=objects</code>
</h6><p><code>collection=</code> 메소드는 적절하게 추가/삭제 해서 지정된 객체들만 남게 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection=</code> method makes the collection contain only the supplied objects, by adding and deleting as appropriate.</p><h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-singular-ids">4.4.1.7 <code>collection_singular_ids</code>
</h6><p><code>collection_singular_ids</code> 메소드는 collection객체들의 id 배열을 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection_singular_ids</code> method returns an array of the ids of the objects in the collection.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@assembly_ids = @part.assembly_ids

</pre>
</div>
<h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-singular-ids-ids">4.4.1.8 <code>collection_singular_ids=ids</code>
</h6><p><code>collection_singular_ids=ids</code> 메소드는 적절하게 추가/삭제해서 주어진 primary key 값을 가진 객체들만 남게 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection_singular_ids=</code> method makes the collection contain only the objects identified by the supplied primary key values, by adding and deleting as appropriate.</p><h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-clear">4.4.1.9 <code>collection.clear</code>
</h6><p><code>collection.clear</code> 메소드는 조인테이블의 모든 collection 데이터를 제거합니다. 연결된 객체를 destroy 하지는 않습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.clear</code> method removes every object from the collection by deleting the rows from the joining table. This does not destroy the associated objects.</p><h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-empty-questionmark">4.4.1.10 <code>collection.empty?</code>
</h6><p><code>collection.empty?</code> 메소드는 collection에 연결된 객체가 없는경우 <code>true</code>를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.empty?</code> method returns <code>true</code> if the collection does not contain any associated objects.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
&lt;% if @part.assemblies.empty? %&gt;
  This part is not used in any assemblies
&lt;% end %&gt;

</pre>
</div>
<h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-size">4.4.1.11 <code>collection.size</code>
</h6><p><code>collection.size</code> 메소드는 collection의 객체 갯수를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.size</code> method returns the number of objects in the collection.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@assembly_count = @part.assemblies.size

</pre>
</div>
<h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-find">4.4.1.12 <code>collection.find(...)</code>
</h6><p><code>collection.find</code> 메소드는 collection에서 객체들을 찾습니다. <code>ActiveRecord::Base.find</code> 에서 사용하는것과 동일한 문법과 옵션을 사용합니다. 또한 추가적인 조건을 명시하여 컬렉션에서 해당 객체들만 불러 올 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.find</code> method finds objects within the collection. It uses the same syntax and options as <code>ActiveRecord::Base.find</code>. It also adds the additional condition that the object must be in the collection.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@assembly = @part.assemblies.find(1)

</pre>
</div>
<h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-where">4.4.1.13 <code>collection.where(...)</code>
</h6><p><code>collection.where</code> 메소드는 collection 객체들 중에서 제공된 조건에 맞는 것들만 찾아주지만 해당 객체에 대한 로드는 필요할 때 발생한다는 것입니다. 이것은 해당 객체들을 접근할 때만 데이터베이스 쿼리가 발생한다는 것을 의미합니다. 또한 추가적인 조건을 명시하여 컬렉션에서 해당 객체들만 불러 올 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.where</code> method finds objects within the collection based on the conditions supplied but the objects are loaded lazily meaning that the database is queried only when the object(s) are accessed. It also adds the additional condition that the object must be in the collection.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@new_assemblies = @part.assemblies.where("created_at &gt; ?", 2.days.ago)

</pre>
</div>
<h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-exists-questionmark">4.4.1.14 <code>collection.exists?(...)</code>
</h6><p><code>collection.exists?</code> 메소드는 제공되는 조건을 만족하는 객체가 컬렉션내에 존재하는지를 점검합니다. 이 때 <code>ActiveRecord::Base.exist?</code> 와 같은 문법과 옵션을 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.exists?</code> method checks whether an object meeting the supplied conditions exists in the collection. It uses the same syntax and options as <code>ActiveRecord::Base.exists?</code>.</p><h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-build-attributes">4.4.1.15 <code>collection.build(attributes = {})</code>
</h6><p><code>collection.build</code> 메소드는 연결된 모델의 새로운 객체를 반환합니다. 반환된 객체는 넘겨진 속성들로 구성되며 조인테이블에 추가 될것입니다. 그러나 추가된 객체는 아직 저장이 되지 <em>않은</em> 상태입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.build</code> method returns a new object of the associated type. This object will be instantiated from the passed attributes, and the link through the join table will be created, but the associated object will <em>not</em> yet be saved.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@assembly = @part.assemblies.build({assembly_name: "Transmission housing"})

</pre>
</div>
<h6 id="has-and-belongs-to-many에-의해-추가된-메소드-methods-added-by-has-and-belongs-to-many-원문·전체-collection-create-attributes">4.4.1.16 <code>collection.create(attributes = {})</code>
</h6><p><code>collection.build</code> 메소드는 연결된 모델의 새로운 객체를 반환합니다. 반환된 객체는 넘겨진 속성들로 구성되며 조인테이블에 추가 될것입니다. 검증을 모두 통과한다면 반환된 객체는 저장 될것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>collection.create</code> method returns a new object of the associated type. This object will be instantiated from the passed attributes, the link through the join table will be created, and, once it passes all of the validations specified on the associated model, the associated object <em>will</em> be saved.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
@assembly = @part.assemblies.create({assembly_name: "Transmission housing"})

</pre>
</div>
<h5 id="has-and-belongs-to-many-옵션-options-for-has-and-belongs-to-many-원문·전체">4.4.2 <code>has_and_belongs_to_many</code> 옵션<span class="original-text-h">(Options for <code>has_and_belongs_to_many</code>)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p>대부분의 경우 레일스의 기본설정값은 잘 작동하지만, <code>has_and_belongs_to_many</code>의 동작을 커스터마이징하고 싶을때가 있을것입니다. 관계를 설정할때 옵션을 추가해서 쉽게 커스터마이제이션 할 수 있습니다. 예를 들어, 몇가지 옵션을 가지는 관계설정은 다음과 같습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">While Rails uses intelligent defaults that will work well in most situations, there may be times when you want to customize the behavior of the <code>has_and_belongs_to_many</code> association reference. Such customizations can easily be accomplished by passing options when you create the association. For example, this association uses two such options:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Parts &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies, uniq: true,
                                       read_only: true
end

</pre>
</div>
<p><code>has_and_belongs_to_many</code> 관계는 다음과 같은 옵션을 사용할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>has_and_belongs_to_many</code> association supports these options:</p>
<ul>
<li><code>:association_foreign_key</code></li>
<li><code>:autosave</code></li>
<li><code>:class_name</code></li>
<li><code>:foreign_key</code></li>
<li><code>:join_table</code></li>
<li><code>:validate</code></li>
</ul>
<h6 id="association-foreign-key">4.4.2.1 <code>:association_foreign_key</code>
</h6><p>관례에 의해, 레일스는 조인테이블의 foreign key 컬럼명을 연관된 모델명에 <code>_id</code> 를 추가한 이름으로 간주합니다. 이 때 <code>:association_foreign_key</code> 옵션을 이용하여 직접 foreign key 이름을 설정할 수 있게 해 줍니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">By convention, Rails assumes that the column in the join table used to hold the foreign key pointing to the other model is the name of that model with the suffix <code>_id</code> added. The <code>:association_foreign_key</code> option lets you set the name of the foreign key directly:</p><div class="info">
<p> <code>:foreign_key</code> 와 <code>:association_foreign_key</code> 옵션을 이용하면 self-join 다대다연결시 유용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text">The <code>:foreign_key</code> and <code>:association_foreign_key</code> options are useful when setting up a many-to-many self-join. For example:</p>
</div><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ActiveRecord::Base
  has_and_belongs_to_many :friends, 
      class_name: "User",
      foreign_key: "this_user_id",
      association_foreign_key: "other_user_id"
end

</pre>
</div>
<h6 id="has-and-belongs-to-many-옵션-options-for-has-and-belongs-to-many-원문·전체-autosave">4.4.2.2 <code>:autosave</code>
</h6><p><code>:autosave</code> 옵션을 <code>true</code> 값으로 설정하면, 레일스는 모객체가 저장될 때마다 모든 로딩된 멤버를 저장하고 삭제표시된 멤버를 삭제할 것입니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you set the <code>:autosave</code> option to <code>true</code>, Rails will save any loaded members and destroy members that are marked for destruction whenever you save the parent object.</p><h6 id="has-and-belongs-to-many-옵션-options-for-has-and-belongs-to-many-원문·전체-class-name">4.4.2.3 <code>:class_name</code>
</h6><p>다른 모델의 이름을 관계선언이름으로부터 알 수 없을 경우에는 <code>:class_name</code> 옵션을 이용해서 모델명을 명시할 수 있습니다. 예를 들면, part 모델은 여러개의 assemblies 가지는데 assemblies 객체들의 실제 모델이름은 <code>Gadget</code>인경우 다음과 같이 설정합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If the name of the other model cannot be derived from the association name, you can use the <code>:class_name</code> option to supply the model name. For example, if a part has many assemblies, but the actual name of the model containing assemblies is <code>Gadget</code>, you'd set things up this way:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Parts &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies, class_name: "Gadget"
end

</pre>
</div>
<h6 id="has-and-belongs-to-many-옵션-options-for-has-and-belongs-to-many-원문·전체-foreign-key">4.4.2.4 <code>:foreign_key</code>
</h6><p>관례에 의해, 레일스는 foreign key 컬럼명을 연관된 모델명에 <code>_id</code> 를 추가한 이름으로 간주합니다. 이 때 <code>:foreign_key</code> 옵션을 이용하여 직접 foreign key 이름을 설정할 수 있게 해 줍니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">By convention, Rails assumes that the column in the join table used to hold the foreign key pointing to this model is the name of this model with the suffix <code>_id</code> added. The <code>:foreign_key</code> option lets you set the name of the foreign key directly:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class User &lt; ActiveRecord::Base
  has_and_belongs_to_many :friends,
      class_name: "User",
      foreign_key: "this_user_id",
      association_foreign_key: "other_user_id"
end

</pre>
</div>
<h6 id="join-table">4.4.2.5 <code>:join_table</code>
</h6><p>조인테이블의 기본이름(lexical ordering 사전 알파벳순)이 사용하고자 하는 이름과 다른경우 <code>:join_table</code> 옵션으로 기본값을 대체합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If the default name of the join table, based on lexical ordering, is not what you want, you can use the <code>:join_table</code> option to override the default.</p><h6 id="has-and-belongs-to-many-옵션-options-for-has-and-belongs-to-many-원문·전체-validate">4.4.2.6 <code>:validate</code>
</h6><p><code>:validate</code> 옵션을 <code>false</code>로 설정하면, 이 객체를 저장할때 연관된 객체의 검증이 수행되지 않습니다. 기본값은 <code>true</code>이며 이 객체가 저장될때 검증이 수행됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you set the <code>:validate</code> option to <code>false</code>, then associated objects will not be validated whenever you save this object. By default, this is <code>true</code>: associated objects will be validated when this object is saved.</p><h5 id="scopes-for-has-and-belongs-to-many">4.4.3 Scopes for <code>has_and_belongs_to_many</code>
</h5><p>쿼리를 이용해 <code>has_and_belongs_to_many</code>를 커스터마이즈할때 scope block을 자주 사용합니다. 예를 들면 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">There may be times when you wish to customize the query used by <code>has_and_belongs_to_many</code>. Such customizations can be achieved via a scope block. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Parts &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies, -&gt; { where active: true }
end

</pre>
</div>
<p><a href="active_record_querying.html">querying methods</a> 를 scope block 내부에 사용할수 있습니다. 다음과 같은것들은 아래에 설명되어 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can use any of the standard <a href="active_record_querying.html">querying methods</a> inside the scope block. The following ones are discussed below:</p>
<ul>
<li><code>where</code></li>
<li><code>extending</code></li>
<li><code>group</code></li>
<li><code>includes</code></li>
<li><code>limit</code></li>
<li><code>offset</code></li>
<li><code>order</code></li>
<li><code>readonly</code></li>
<li><code>select</code></li>
<li><code>uniq</code></li>
</ul>
<h6 id="scopes-for-has-and-belongs-to-many-where">4.4.3.1 <code>where</code>
</h6><p><code>where</code> 메서드는 지정된 조건에 해당할때만 객체와 연관되도록 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>where</code> method lets you specify the conditions that the associated object must meet.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Parts &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies,
    -&gt; { where "factory = 'Seattle'" }
end

</pre>
</div>
<p>hash로 조건을 지정할수도 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can also set conditions via a hash:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Parts &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies,
    -&gt; { where factory: 'Seattle' }
end

</pre>
</div>
<p>hash-style로 <code>where</code> 옵션을 사용할때, 이 관계로 객체를 생성하는 함수들은 scope에 사용된 해쉬를 사용합니다. 위의 예시에서 <code>@parts.assemblies.create</code> 또는 <code>@parts.assemblies.build</code>는 <code>factory</code> 컬럼의 값은 "Seattle"로 설정된 객체가 생성됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you use a hash-style <code>where</code>, then record creation via this association will be automatically scoped using the hash. In this case, using <code>@parts.assemblies.create</code> or <code>@parts.assemblies.build</code> will create orders where the <code>factory</code> column has the value "Seattle".</p><h6 id="scopes-for-has-and-belongs-to-many-extending">4.4.3.2 <code>extending</code>
</h6><p><code>extending</code> 메서드는 지정된 모듈이름으로 관계를 확장한다. 관계확장에 대한 자세한 내용은 <a href="#association-extensions">본 가이드의 뒷부분에</a> 설명되어 있다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>extending</code> method specifies a named module to extend the association proxy. Association extensions are discussed in detail <a href="#association-extensions">later in this guide</a>.</p><h6 id="scopes-for-has-and-belongs-to-many-group">4.4.3.3 <code>group</code>
</h6><p><code>group</code> 메서드에 전달된 속성이름으로 SQL에서 <code>GROUP BY</code> 구문을 사용해 결과를 그룹화한다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>group</code> method supplies an attribute name to group the result set by, using a <code>GROUP BY</code> clause in the finder SQL.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Parts &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies, -&gt; { group "factory" }
end

</pre>
</div>
<h6 id="scopes-for-has-and-belongs-to-many-includes">4.4.3.4 <code>includes</code>
</h6><p>두번째 관계의 객체의 대해 eager-loaded를 사용하고자 할때 <code>includes</code> 메서드를 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can use the <code>includes</code> method to specify second-order associations that should be eager-loaded when this association is used.</p><h6 id="scopes-for-has-and-belongs-to-many-limit">4.4.3.5 <code>limit</code>
</h6><p><code>limit</code> 메서드는 관계를통해 조회되는 객체의 총 갯수를 제한합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>limit</code> method lets you restrict the total number of objects that will be fetched through an association.</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Parts &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies,
    -&gt; { order("created_at DESC").limit(50) }
end

</pre>
</div>
<h6 id="scopes-for-has-and-belongs-to-many-offset">4.4.3.6 <code>offset</code>
</h6><p>:offset 메서드는 관계를 통해 객체를 조회할때 시작지점을 명시할 수 있습니다. 예를 들어, <code>-&gt; { offset(11) }</code> 이라고 설정하면 처음 11개의 객체는 건너띕니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>offset</code> method lets you specify the starting offset for fetching objects via an association. For example, if you set <code>offset(11)</code>, it will skip the first 11 records.</p><h6 id="scopes-for-has-and-belongs-to-many-order">4.4.3.7 <code>order</code>
</h6><p><code>order</code> 메서드는 연관 객체를 조회할때 (SQL <code>ORDER BY</code> 구문에서 사용하는 것 처럼) 순서를 지정할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>order</code> method dictates the order in which associated objects will be received (in the syntax used by an SQL <code>ORDER BY</code> clause).</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Parts &lt; ActiveRecord::Base
  has_and_belongs_to_many :assemblies,
    -&gt; { order "assembly_name ASC" }
end

</pre>
</div>
<h6 id="scopes-for-has-and-belongs-to-many-readonly">4.4.3.8 <code>readonly</code>
</h6><p><code>readonly</code> 메서드는 연관된 객체를 관계메서드를 통해서 조회할때 읽기전용으로 동작하게 합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you use the <code>readonly</code> method, then the associated objects will be read-only when retrieved via the association.</p><h6 id="scopes-for-has-and-belongs-to-many-select">4.4.3.9 <code>select</code>
</h6><p><code>select</code> 메서드는 연관 객체를 조회할때 이용되는 SQL <code>SELECT</code> 구문을 재정의 합니다. 레일스는 기본설정으로 모든 컬럼을 불러옵니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">The <code>select</code> method lets you override the SQL <code>SELECT</code> clause that is used to retrieve data about the associated objects. By default, Rails retrieves all columns.</p><h6 id="uniq">4.4.3.10 <code>uniq</code>
</h6><p>컬렉션으로부터 중복을 제거하고자 할때 <code>uniq</code> 메소드를 사용합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Use the <code>uniq</code> method to remove duplicates from the collection.</p><h5 id="객체는-언제-저장되는가-questionmark-when-are-objects-saved-questionmark-원문·전체">4.4.4 객체는 언제 저장되는가?<span class="original-text-h">(When are Objects Saved?)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h5><p>객체를 <code>has_and_belongs_to_many</code> 관계로 할당할때, 해당 객체는 자동으로 저장됩니다.(조인테이블을 변경하기 위해서) 여러개의 객체를 하나의 구문으로 할당할때도 모든 객체는 저장됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">When you assign an object to a <code>has_and_belongs_to_many</code> association, that object is automatically saved (in order to update the join table). If you assign multiple objects in one statement, then they are all saved.</p><p>검증실행중에 에러로인해 저장이 실패하는경우, 할당 구문은 <code>false</code>를 반환하고 해당 할당은 취소됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If any of these saves fails due to validation errors, then the assignment statement returns <code>false</code> and the assignment itself is cancelled.</p><p>모객체(<code>has_and_belongs_to_many</code> 관계를 선언한)가 저장되지 않은상태(<code>new_record?</code>가 <code>true</code> 반환)일때 자식객체들은 모객체에 추가될때 저장되지 않은상태입니다. 모든 저장되지 않은 연관객체들은 모객체가 저장될때 자동으로 저장됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If the parent object (the one declaring the <code>has_and_belongs_to_many</code> association) is unsaved (that is, <code>new_record?</code> returns <code>true</code>) then the child objects are not saved when they are added. All unsaved members of the association will automatically be saved when the parent is saved.</p><p><code>has_many</code> 관계에서 객체를 할당할때 저장하지 않고 싶으면 <code>collection.build</code> 메서드를 사용하면됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you want to assign an object to a <code>has_and_belongs_to_many</code> association without saving the object, use the <code>collection.build</code> method.</p><h4 id="관계-콜백-association-callbacks-원문·전체">4.5 관계 콜백<span class="original-text-h">(Association Callbacks)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h4><p>일반적인 콜백은 Active Record의 생명주기에 따라 다양한 시점에 실행됩니다. 예를 들어, <code>:before_save</code> 콜백은 객체가 저장되기전에 실행됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Normal callbacks hook into the life cycle of Active Record objects, allowing you to work with those objects at various points. For example, you can use a <code>:before_save</code> callback to cause something to happen just before an object is saved.</p><p>관계 콜백도 일반적인 콜백과 유사하지만, 컬렉션의 생명주기에 따라 실행됩니다. 다음 4개의 관계 콜백을 사용할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Association callbacks are similar to normal callbacks, but they are triggered by events in the life cycle of a collection. There are four available association callbacks:</p>
<ul>
<li><code>before_add</code></li>
<li><code>after_add</code></li>
<li><code>before_remove</code></li>
<li><code>after_remove</code></li>
</ul>
<p>관계 콜백을 관계 선언시 옵션으로 추가해서 정의합니다. 예들 들면 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You define association callbacks by adding options to the association declaration. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders, before_add: :check_credit_limit

  def check_credit_limit(order)
    ...
  end
end

</pre>
</div>
<p>레일스는 추가되거나 삭제될 객체를 콜백으로 넘겨 주게 됩니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Rails passes the object being added or removed to the callback.</p><p>관계콜백을 배열형태로 넘겨 주어 단일 이벤트 발생시에 스택으로 실행할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You can stack callbacks on a single event by passing them as an array:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders,
    before_add: [:check_credit_limit, :calculate_shipping_charges]

  def check_credit_limit(order)
    ...
  end

  def calculate_shipping_charges(order)
    ...
  end
end

</pre>
</div>
<p><code>before_add</code> 콜백이 예외를 발생하는 경우, 객체는 컬렉션에 추가되지 않습니다. 이와 유사하게 <code>before_remove</code> 콜백도 예외를 발생하는 경우, 객체는 컬렉션에서 제거되지 않습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If a <code>before_add</code> callback throws an exception, the object does not get added to the collection. Similarly, if a <code>before_remove</code> callback throws an exception, the object does not get removed from the collection.</p><h4 id="관계-확장-association-extensions-원문·전체">4.6 관계 확장<span class="original-text-h">(Association Extensions)</span> <sup><a href="#" class="original-link" onclick="$(this).parent().prev().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text, .original-text-h').toggle();return false;">전체}</a></sup>
</h4><p>레일스가 자동으로 관계 중계 객체(모객체나 자객체)에 내장하는 기능외에 새로운 finders, creators, 기타 다른 메소드를 추가하여 익명의 모듈을 통해서 이러한 객체들의 기능을 확장할 수 있습니다. 예를 들면 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">You're not limited to the functionality that Rails automatically builds into association proxy objects. You can also extend these objects through anonymous modules, adding new finders, creators, or other methods. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
class Customer &lt; ActiveRecord::Base
  has_many :orders do
    def find_by_order_prefix(order_number)
      find_by_region_id(order_number[0..2])
    end
  end
end

</pre>
</div>
<p>다수의 관계설정시 이러한 관계를 공유하고자 할 경우에는 확장모듈에 이름을 붙여 사용할 수 있습니다. 예를 들면 <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">If you have an extension that should be shared by many associations, you can use a named extension module. For example:</p><div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">
module FindRecentExtension
  def find_recent
    where("created_at &gt; ?", 5.days.ago)
  end
end

class Customer &lt; ActiveRecord::Base
  has_many :orders, -&gt; { extending FindRecentExtension }
end

class Supplier &lt; ActiveRecord::Base
  has_many :deliveries, -&gt; { extending FindRecentExtension }
end

</pre>
</div>
<p>확장모듈에서는 proxy_association 접근자의 3가지 속성을 이용하여 association proxy의 내부를 참조할 수 있습니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p><p class="original-text">Extensions can refer to the internals of the association proxy using these three attributes of the <code>proxy_association</code> accessor:</p>
<ul>
<li>
<p>proxy_association.owner 는 관계설정시에 컬렉션을 소유하는 객체를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text"><code>proxy_association.owner</code> returns the object that the association is a part of.</p>
</li>
<li>
<p>proxy_association.reflection 은 관계를 기술하는 reflection 객체를 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text"><code>proxy_association.reflection</code> returns the reflection object that describes the association.</p>
</li>
<li>
<p>proxy_assoction.target 은 belongs_to 또는 has_one 에 대한 연관객체, 또는 has_many 또는 has_and_belongs_to_many 에 대한 연관객체들의 컬렉션을 반환합니다. <sup><a href="#" class="original-link" onclick="$(this).parent().parent().next().toggle();return false;">{원문</a><a href="#" class="original-link">·</a><a href="#" class="original-link" onclick="$('.original-text').toggle();return false;">전체}</a></sup></p>
<p class="original-text"><code>proxy_association.target</code> returns the associated object for <code>belongs_to</code> or <code>has_one</code>, or the collection of associated objects for <code>has_many</code> or <code>has_and_belongs_to_many</code>.</p>
</li>
</ul>


        <h3>피드백</h3>
        <p>
          이 가이드의 질을 향상시키기 위한 도움을 기다리고 있습니다.
        </p>
        <p>
          수정이 필요한 오타나 에러를 발견하면 <a href="https://github.com/lifo/docrails">docrails</a>을 클론한 후 직접 변경내용을 push하시기 바랍니다. 레일스의 해당 브랜치는 누구나가 write 권한이 있습니다. 커밋한 내용에 대해서는 검토작업이 이루어질 것이지만 변경내용을 서밋한 이후에 진행됩니다. <a href="https://github.com/lifo/docrails">docrails</a>은 정기적으로 master 브랜치와 클로스 머지됩니다. 
        </p>
        <p>
          미완성된 내용이나 업데이트되지 않은 내용이 있을 수 있습니다. 누락된 문서를 추가해 주시기 바랍니다. 문서작성시 참고해야할 스타일과 규칙은 <a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a>를 확인하시기 바랍니다. 
        </p>
        <p>
          어떤 이유에서든지, 수정이 필요한 부분을 직접 변경할 수 없는 경우에는 <a href="https://github.com/rails/rails/issues">open an issue</a>로 접속하여 문제점을 제출해 주시기 바랍니다. 
        </p>
        <p>
          마지막으로, 루비온레일스 문서화에 관련된 논의가 필요한 사항은 <a href="http://groups.google.com/group/rubyonrails-docs">rubyonrails-docs mailing list</a>에서 해 주시기 바랍니다. 
        </p>
        <h3>문서생성일</h3>
        <p>최종 생성일 : 2015-01-26 09:09:20 +0900 </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>이 작업은 <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0</a> License 특허권을 가지고 있습니다.</p>
<p>"Rails", "Ruby on Rails", 그리고 레일스 로고는 David Heinemeier Hansson의 등록상표이며, 저작권 보호를 받고 있습니다.</p>


    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all()
    $(guidesIndex.bind);
  </script>
</body>
</html>
